{
    "id": "python-ds-studio",
    "name": "Python Data Science Studio",
    "description": "A powerful Python environment for Data Science with Pyodide. Supports Numpy, Pandas, Matplotlib, Scikit-Learn, Scipy, Sympy, and Seaborn with Syntax Highlighting.",
    "author": "Infinition",
    "authorUrl": "https://github.com/infinition/obsidget",
    "tags": [
        "python",
        "data-science",
        "machine-learning",
        "matplotlib",
        "syntax-highlighting"
    ],
    "html": "<div class=\"ds-container\">\n  <div class=\"ds-header\">\n    <div class=\"ds-title-wrap\">\n      <div class=\"ds-logo\">\n        <svg viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" stroke=\"currentColor\" stroke-width=\"2.5\" fill=\"none\"><path d=\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\"></path></svg>\n      </div>\n      <div class=\"ds-title-text\">\n        <span class=\"ds-main-title\">PYTHON DATA SCIENCE</span>\n        <span class=\"ds-sub-title\">STUDIO PRO</span>\n      </div>\n    </div>\n    <div class=\"ds-top-actions\">\n      <button id=\"btn-clear\" class=\"ds-btn-tool\">\n        <svg viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><polyline points=\"3 6 5 6 21 6\"></polyline><path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path></svg>\n        Clear\n      </button>\n      <button id=\"btn-copy\" class=\"ds-btn-tool\">\n        <svg viewBox=\"0 0 24 24\" width=\"12\" height=\"12\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\"></path><rect x=\"8\" y=\"2\" width=\"8\" height=\"4\" rx=\"1\" ry=\"1\"></rect></svg>\n        Copy\n      </button>\n    </div>\n  </div>\n\n  <div class=\"ds-editor-card\">\n    <div class=\"ds-editor-wrapper\">\n      <pre id=\"highlighting\" aria-hidden=\"true\"><code class=\"language-python\" id=\"highlighting-content\"></code></pre>\n      <textarea id=\"code-editor\" spellcheck=\"false\">import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.ensemble import IsolationForest\n\n# Aesthetic configuration\nsns.set_theme(style=\"whitegrid\")\n\n# 1. Generate synthetic data\nnp.random.seed(42)\nX_normal = 0.3 * np.random.randn(100, 2)\nX_normal = np.r_[X_normal + 2, X_normal - 2]\n\n# Add outliers\nX_outliers = np.random.uniform(low=-4, high=4, size=(20, 2))\nX = np.r_[X_normal, X_outliers]\n\n# 2. Train Isolation Forest model\nclf = IsolationForest(contamination=0.1, random_state=42)\npreds = clf.fit_predict(X)\n\n# 3. Prepare results\ndf = pd.DataFrame(X, columns=['Feature 1', 'Feature 2'])\ndf['Result'] = np.where(preds == 1, 'Normal', 'Anomaly')\n\nprint(f\"Total points: {len(df)}\")\nprint(f\"Anomalies detected: {len(df[df['Result'] == 'Anomaly'])}\")\n\n# 4. Visualization with Seaborn\nplt.figure(figsize=(10, 6))\nsns.scatterplot(data=df, x='Feature 1', y='Feature 2', \n                hue='Result', style='Result', \n                palette={'Normal': 'skyblue', 'Anomaly': 'red'},\n                s=100, edgecolor='black')\n\nplt.title(\"Anomaly Detection (Isolation Forest + Seaborn)\")\nplt.show()</textarea>\n    </div>\n    <div class=\"ds-editor-footer\">\n      <span>Press Ctrl+Enter to run</span>\n    </div>\n  </div>\n\n  <button id=\"btn-execute\" class=\"ds-btn-execute\">\n    <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"currentColor\"><polygon points=\"5 3 19 12 5 21 5 3\"></polygon></svg>\n    Execute\n  </button>\n\n  <div id=\"results-section\" class=\"ds-results-container\" style=\"display: none;\">\n    <div class=\"ds-results-header\">\n      <div class=\"ds-results-icon\">\n        <div style=\"background: #4285f4;\"></div>\n        <div style=\"background: #ea4335;\"></div>\n        <div style=\"background: #fbbc05;\"></div>\n        <div style=\"background: #34a853;\"></div>\n      </div>\n      RESULTS\n    </div>\n    <div class=\"ds-results-content\">\n      <div id=\"output-text\" class=\"ds-output-text\"></div>\n      <div id=\"output-plot\" class=\"ds-output-plot\"></div>\n    </div>\n  </div>\n\n  <div id=\"loader\" class=\"ds-loader\" style=\"display: none;\">\n    <div class=\"ds-spinner\"></div>\n    <span id=\"loader-text\">Loading Python...</span>\n  </div>\n</div>",
    "css": ":host {\n  --ds-bg: #1a1a1a;\n  --ds-card-bg: #242424;\n  --ds-accent: #2ecc71;\n  --ds-text: #888888;\n  --ds-text-bright: #dddddd;\n  --ds-border: #333333;\n  --ds-font-code: 'Fira Code', 'Cascadia Code', Consolas, monospace;\n}\n\n.ds-container {\n  font-family: var(--font-interface);\n  background: var(--ds-bg);\n  border-radius: 8px;\n  padding: 16px;\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  color: var(--ds-text-bright);\n}\n\n.ds-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 4px;\n}\n\n.ds-title-wrap {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.ds-logo {\n  color: var(--ds-accent);\n  display: flex;\n  align-items: center;\n}\n\n.ds-title-text {\n  display: flex;\n  flex-direction: column;\n  line-height: 1.1;\n}\n\n.ds-main-title {\n  font-size: 12px;\n  font-weight: 700;\n  letter-spacing: 0.5px;\n  color: #aaa;\n}\n\n.ds-sub-title {\n  font-size: 9px;\n  font-weight: 600;\n  color: #666;\n}\n\n.ds-top-actions {\n  display: flex;\n  gap: 8px;\n}\n\n.ds-btn-tool {\n  background: #333;\n  border: none;\n  color: #aaa;\n  padding: 4px 10px;\n  border-radius: 4px;\n  font-size: 11px;\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  cursor: pointer;\n  transition: all 0.2s;\n}\n\n.ds-btn-tool:hover {\n  background: #444;\n  color: #fff;\n}\n\n.ds-editor-card {\n  background: var(--ds-card-bg);\n  border: 1px solid var(--ds-border);\n  border-radius: 6px;\n  padding: 12px;\n  display: flex;\n  flex-direction: column;\n}\n\n.ds-editor-wrapper {\n  position: relative;\n  width: 100%;\n  height: 250px;\n  min-height: 100px;\n  resize: vertical;\n  overflow: hidden;\n  background: #1e1e1e;\n  border-radius: 4px;\n}\n\n#code-editor, #highlighting {\n  margin: 0;\n  padding: 10px;\n  padding-bottom: 30px; /* Space for footer and last line */\n  border: 0;\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n  font-family: var(--ds-font-code);\n  font-size: 13px;\n  line-height: 1.5;\n  tab-size: 4;\n  white-space: pre;\n  word-wrap: normal;\n  overflow: auto;\n  box-sizing: border-box;\n}\n\n#code-editor {\n  z-index: 1;\n  white-space: pre;\n  color: transparent;\n  background: transparent;\n  caret-color: white;\n  resize: none;\n  outline: none;\n}\n\n#highlighting {\n  z-index: 0;\n  pointer-events: none;\n}\n\n.ds-editor-footer {\n  display: flex;\n  justify-content: flex-end;\n  padding-top: 6px;\n  font-size: 10px;\n  color: #555;\n}\n\n/* Prism Theme Overrides */\n.token.comment { color: #6a9955; }\n.token.keyword { color: #569cd6; }\n.token.string { color: #ce9178; }\n.token.function { color: #dcdcaa; }\n.token.number { color: #b5cea8; }\n.token.operator { color: #d4d4d4; }\n.token.class-name { color: #4ec9b0; }\n.token.builtin { color: #4fc1ff; }\n.token.property { color: #9cdcfe; }\n\n.ds-btn-execute {\n  background: #333;\n  border: none;\n  color: #eee;\n  padding: 8px;\n  border-radius: 6px;\n  font-size: 13px;\n  font-weight: 600;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  cursor: pointer;\n  transition: background 0.2s;\n}\n\n.ds-btn-execute:hover {\n  background: #444;\n}\n\n.ds-results-container {\n  background: #000;\n  border-left: 3px solid var(--ds-accent);\n  border-radius: 2px;\n  margin-top: 4px;\n  transition: opacity 0.3s;\n}\n\n.ds-results-container.ds-loading {\n  opacity: 0.4;\n  pointer-events: none;\n}\n\n.ds-results-header {\n  padding: 8px 12px;\n  font-size: 10px;\n  font-weight: 700;\n  color: #888;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  border-bottom: 1px solid #111;\n}\n\n.ds-results-icon {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 1px;\n  width: 10px;\n  height: 10px;\n}\n\n.ds-results-icon div {\n  width: 4px;\n  height: 4px;\n}\n\n.ds-results-content {\n  padding: 12px;\n  min-height: 40px;\n}\n\n.ds-output-text {\n  font-family: var(--ds-font-code);\n  font-size: 12px;\n  color: #aaa;\n  white-space: pre-wrap;\n}\n\n.ds-output-plot {\n  display: flex;\n  justify-content: center;\n  background: white;\n  padding: 10px;\n  border-radius: 4px;\n  margin-top: 10px;\n}\n\n.ds-output-plot img {\n  max-width: 100%;\n  height: auto;\n}\n\n.ds-loader {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12px;\n  padding: 10px;\n}\n\n.ds-spinner {\n  width: 16px;\n  height: 16px;\n  border: 2px solid var(--ds-accent);\n  border-top-color: transparent;\n  border-radius: 50%;\n  animation: spin 0.8s linear infinite;\n}\n\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n#loader-text {\n  font-size: 11px;\n  color: #666;\n}",
    "js": "let pyodide = null;\nconst PYODIDE_VERSION = 'v0.23.4';\nconst PYODIDE_BASE = `https://cdn.jsdelivr.net/pyodide/${PYODIDE_VERSION}/full/`;\nconst PRISM_JS = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js';\nconst PRISM_PYTHON = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js';\n\nasync function init() {\n  const editor = api.root.querySelector('#code-editor');\n  const highlightContent = api.root.querySelector('#highlighting-content');\n  const highlightPre = api.root.querySelector('#highlighting');\n  const btnExecute = api.root.querySelector('#btn-execute');\n  const btnClear = api.root.querySelector('#btn-clear');\n  const btnCopy = api.root.querySelector('#btn-copy');\n  const resultsSection = api.root.querySelector('#results-section');\n  const outputText = api.root.querySelector('#output-text');\n  const outputPlot = api.root.querySelector('#output-plot');\n  const loader = api.root.querySelector('#loader');\n  const loaderText = api.root.querySelector('#loader-text');\n\n  // Load Prism\n  await loadScriptOnce(PRISM_JS);\n  await loadScriptOnce(PRISM_PYTHON);\n\n  const updateHighlighting = () => {\n    let code = editor.value;\n    if (code[code.length-1] === \"\\n\") code += \" \";\n    highlightContent.textContent = code;\n    if (window.Prism) window.Prism.highlightElement(highlightContent);\n  };\n\n  // Sync scrolling\n  editor.onscroll = () => {\n    highlightPre.scrollTop = editor.scrollTop;\n    highlightPre.scrollLeft = editor.scrollLeft;\n  };\n\n  editor.oninput = () => {\n    updateHighlighting();\n  };\n\n  // Handle Keys\n  editor.onkeydown = (e) => {\n    if (e.key === 'Tab') {\n      e.preventDefault();\n      const start = editor.selectionStart;\n      const end = editor.selectionEnd;\n      editor.value = editor.value.substring(0, start) + \"    \" + editor.value.substring(end);\n      editor.selectionStart = editor.selectionEnd = start + 4;\n      updateHighlighting();\n    }\n    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\n      e.preventDefault();\n      btnExecute.click();\n    }\n  };\n\n  const state = await api.getState?.();\n  if (state?.code) {\n    editor.value = state.code;\n    updateHighlighting();\n  }\n  \n  if (state?.lastOutput || state?.lastPlot) {\n    if (state.lastOutput) {\n      outputText.innerText = state.lastOutput;\n      outputText.style.display = 'block';\n    }\n    if (state.lastPlot) {\n      const img = document.createElement('img');\n      img.src = state.lastPlot;\n      outputPlot.innerHTML = '';\n      outputPlot.appendChild(img);\n      outputPlot.style.display = 'flex';\n    }\n    resultsSection.style.display = 'block';\n  }\n\n  btnExecute.onclick = async () => {\n    if (btnExecute.disabled) return;\n\n    btnExecute.disabled = true;\n    loader.style.display = 'flex';\n    resultsSection.classList.add('ds-loading');\n\n    try {\n      if (!pyodide) {\n        loaderText.innerText = 'Loading Python & DS Libraries...';\n        await ensureBrowserPyodideLoader();\n        pyodide = await createPyodideInstance();\n      }\n\n      loaderText.innerText = 'Executing...';\n\n      let stdout = '';\n      let stderr = '';\n      pyodide.setStdout({ batched: (str) => { stdout += str + '\\n'; } });\n      pyodide.setStderr({ batched: (str) => { stderr += str + '\\n'; } });\n\n      const code = editor.value;\n\n      const runCode = \"import io, base64, sys\\nimport matplotlib\\nmatplotlib.use('Agg')\\nimport matplotlib.pyplot as plt\\nimport numpy as np\\nimport pandas as pd\\nimport micropip\\n\\ndef custom_show():\\n    fig = plt.gcf()\\n    if fig.get_axes():\\n        buf = io.BytesIO()\\n        plt.savefig(buf, format='png', dpi=100, bbox_inches='tight', facecolor='white')\\n        buf.seek(0)\\n        img_base64 = base64.b64encode(buf.read()).decode('UTF-8')\\n        print(f'__PLOT_DATA__:{img_base64}')\\n    plt.close('all')\\n\\nplt.show = custom_show\\nplt.close('all')\\n\\n\" + code + \"\\n\\ncustom_show()\";\n\n      await pyodide.runPythonAsync(runCode);\n\n      const plotMatch = stdout.match(/__PLOT_DATA__:([A-Za-z0-9+/=]+)/);\n      const cleanStdout = stdout.replace(/__PLOT_DATA__:[A-Za-z0-9+/=]+\\n?/, '').trim();\n      \n      let lastPlot = null;\n      if (plotMatch) {\n        lastPlot = 'data:image/png;base64,' + plotMatch[1];\n        const img = document.createElement('img');\n        img.src = lastPlot;\n        outputPlot.innerHTML = '';\n        outputPlot.appendChild(img);\n        outputPlot.style.display = 'flex';\n      } else {\n        outputPlot.innerHTML = '';\n        outputPlot.style.display = 'none';\n      }\n\n      const lastOutput = cleanStdout + (stderr ? '\\n[stderr]\\n' + stderr : '');\n      if (lastOutput) {\n        outputText.innerText = lastOutput;\n        outputText.style.display = 'block';\n      } else {\n        outputText.innerText = '';\n        outputText.style.display = 'none';\n      }\n\n      resultsSection.style.display = 'block';\n      resultsSection.classList.remove('ds-loading');\n\n      api.saveState?.({ \n        code, \n        lastOutput, \n        lastPlot \n      });\n\n    } catch (err) {\n      console.error('Pyodide Error:', err);\n      outputText.innerHTML = `<span style=\"color: #e74c3c\">Error: ${err?.message || String(err)}</span>`;\n      outputText.style.display = 'block';\n      resultsSection.style.display = 'block';\n      resultsSection.classList.remove('ds-loading');\n    } finally {\n      loader.style.display = 'none';\n      btnExecute.disabled = false;\n    }\n  };\n\n  btnClear.onclick = async () => {\n    editor.value = '';\n    updateHighlighting();\n    resultsSection.style.display = 'none';\n    await api.saveState?.({ code: '', lastOutput: null, lastPlot: null });\n  };\n\n  btnCopy.onclick = () => {\n    navigator.clipboard.writeText(editor.value);\n    try { new Notice('Code copied!'); } catch (e) {}\n  };\n\n  updateHighlighting();\n}\n\nfunction loadScriptOnce(url) {\n  return new Promise((resolve, reject) => {\n    const existing = document.querySelector(\"script[data-src='\" + url + \"']\");\n    if (existing) return resolve();\n    const script = document.createElement('script');\n    script.src = url;\n    script.async = true;\n    script.dataset.src = url;\n    script.onload = resolve;\n    script.onerror = () => reject(new Error('Failed to load script: ' + url));\n    document.head.appendChild(script);\n  });\n}\n\nasync function withNodeGlobalsHidden(fn) {\n  const g = globalThis;\n  const keys = ['process', 'require', 'module', 'exports', 'Buffer', 'global'];\n  const saved = {};\n  for (const k of keys) {\n    if (k in g) saved[k] = g[k];\n    try { g[k] = undefined; delete g[k]; } catch (e) {}\n  }\n  try { return await fn(); } finally {\n    for (const k of keys) { if (k in saved) g[k] = saved[k]; }\n  }\n}\n\nasync function ensureBrowserPyodideLoader() {\n  if (window.__PYODIDE_BROWSER_LOADER_READY__) return;\n  try { delete window.loadPyodide; } catch (e) {}\n  await withNodeGlobalsHidden(async () => {\n    await loadScriptOnce(PYODIDE_BASE + 'pyodide.js');\n    if (typeof window.loadPyodide !== 'function') throw new Error('Pyodide loader not found.');\n    window.__PYODIDE_BROWSER_LOADER_READY__ = true;\n  });\n}\n\nasync function createPyodideInstance() {\n  return await withNodeGlobalsHidden(async () => {\n    const instance = await window.loadPyodide({ indexURL: PYODIDE_BASE });\n    await instance.loadPackage(['numpy', 'matplotlib', 'pandas', 'scikit-learn', 'scipy', 'sympy', 'micropip']);\n    await instance.runPythonAsync('import micropip; await micropip.install(\"seaborn\")');\n    return instance;\n  });\n}\n\ninit();"
}