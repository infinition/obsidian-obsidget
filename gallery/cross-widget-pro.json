{
    "id": "cross-widget-pro",
    "name": "Cross-Widget Controller Pro",
    "description": "The ultimate command center for your vault. This widget can remotely read and write data to any other widget in any note. Perfect for building centralized dashboards and multi-note workflows.",
    "author": "Infinition",
    "authorUrl": "https://github.com/infinition",
    "html": "<div class=\"test-container\">\n  <h4>üîó Cross-Widget Controller Pro</h4>\n  \n  <div class=\"selector-row\">\n    <label>Target Note:</label>\n    <div class=\"search-wrapper\">\n      <input type=\"text\" id=\"note-search\" list=\"note-list\" placeholder=\"Search or select a note...\" onchange=\"handleTargetChange()\">\n      <datalist id=\"note-list\"></datalist>\n      <button onclick=\"refreshNotes()\" class=\"mini-btn\" title=\"Refresh note list\">üîÑ</button>\n    </div>\n  </div>\n\n  <div class=\"selector-row\">\n    <label>Target Widget ID:</label>\n    <div class=\"search-wrapper\">\n      <input type=\"text\" id=\"widget-id\" list=\"widget-ids-list\" placeholder=\"e.g. my-widget-id\" oninput=\"saveLocalState()\">\n      <datalist id=\"widget-ids-list\"></datalist>\n      <button onclick=\"scanWidgets()\" class=\"mini-btn\" title=\"Scan note for widget IDs\">üîç Scan</button>\n    </div>\n  </div>\n\n  <div class=\"editor-section\">\n    <div class=\"label-row\">\n      <label>Remote State (JSON):</label>\n      <div class=\"mini-actions\">\n        <button onclick=\"fetchRemoteState()\" class=\"mini-btn\">üì• Fetch</button>\n        <button onclick=\"clearEditor()\" class=\"mini-btn\">üóëÔ∏è</button>\n      </div>\n    </div>\n    <textarea id=\"state-editor\" placeholder=\"Fetch a widget to see its data...\"></textarea>\n  </div>\n  \n  <div class=\"actions\">\n    <button onclick=\"pushRemoteState()\" class=\"save-btn\">üì§ Push Update to Remote</button>\n  </div>\n\n  <div class=\"quick-add\">\n    <label>Quick Remote Increment:</label>\n    <div class=\"search-wrapper\">\n      <input type=\"text\" id=\"prop-key\" placeholder=\"Property key (e.g. count)\" oninput=\"saveLocalState()\">\n      <button onclick=\"remoteIncrement()\" class=\"accent-btn\">+1</button>\n    </div>\n  </div>\n\n  <div id=\"status-bar\" class=\"status\">Ready</div>\n</div>",
    "css": ".test-container {\n    background: var(--background-secondary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    padding: 15px;\n    color: var(--text-normal);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.1);\n}\n.selector-row, .editor-section, .quick-add {\n    margin-bottom: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n}\n.label-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 5px;\n}\n.mini-actions {\n    display: flex;\n    gap: 4px;\n}\nlabel {\n    font-size: 0.7rem;\n    font-weight: 700;\n    text-transform: uppercase;\n    color: var(--text-muted);\n    letter-spacing: 0.5px;\n}\n.search-wrapper {\n    display: flex;\n    gap: 8px;\n    width: 100%;\n}\n#note-search, #widget-id, #prop-key, #state-editor {\n    width: 100%;\n    background: var(--background-primary);\n    color: var(--text-normal);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    padding: 8px;\n    font-size: 0.8rem;\n    outline: none;\n    transition: border-color 0.2s;\n}\n#state-editor {\n    height: 140px;\n    font-family: var(--font-monospace);\n    resize: vertical;\n    color: var(--text-accent);\n    line-height: 1.4;\n}\n#note-search:focus, #widget-id:focus, #state-editor:focus {\n    border-color: var(--interactive-accent);\n}\n.actions { display: flex; gap: 8px; margin-bottom: 15px; }\nbutton {\n    background: var(--interactive-accent);\n    color: var(--text-on-accent);\n    border: none;\n    padding: 8px 12px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.8rem;\n    font-weight: 600;\n    transition: filter 0.2s;\n}\nbutton:hover { filter: brightness(1.1); }\nbutton.save-btn {\n    background: var(--background-modifier-success);\n    color: white;\n    flex: 1;\n}\nbutton.accent-btn {\n    background: var(--interactive-accent);\n    min-width: 50px;\n}\n.mini-btn {\n    padding: 4px 8px;\n    background: var(--background-primary);\n    color: var(--text-normal);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.7rem;\n}\n.mini-btn:hover {\n    background: var(--background-secondary-alt);\n}\n.status {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    margin-top: 10px;\n    font-style: italic;\n    border-top: 1px solid var(--background-modifier-border);\n    padding-top: 8px;\n    display: flex;\n    justify-content: space-between;\n}",
    "js": "async function saveLocalState() {\n    const path = root.getElementById('note-search').value;\n    const id = root.getElementById('widget-id').value;\n    const key = root.getElementById('prop-key').value;\n    await api.saveState({ targetPath: path, targetId: id, propKey: key });\n}\n\nasync function handleTargetChange() {\n    await saveLocalState();\n    await scanWidgets();\n    await fetchRemoteState();\n}\n\nasync function refreshNotes() {\n    const datalist = root.getElementById('note-list');\n    const files = api.getFiles('md');\n    \n    datalist.innerHTML = '<option value=\"\">Current Note</option>';\n    files.forEach(file => {\n        const option = document.createElement('option');\n        option.value = file;\n        datalist.appendChild(option);\n    });\n    setStatus(\"Note list updated\");\n}\n\nasync function scanWidgets() {\n    const path = root.getElementById('note-search').value;\n    const datalist = root.getElementById('widget-ids-list');\n    setStatus(\"Scanning note...\");\n    \n    const content = await api.readFile(path);\n    if (!content) {\n        setStatus(\"Note not found\");\n        return;\n    }\n\n    const regex = /ID:\\s*([a-zA-Z0-9_-]+)/g;\n    const ids = new Set();\n    let match;\n    while ((match = regex.exec(content)) !== null) {\n        ids.add(match[1]);\n    }\n\n    datalist.innerHTML = '';\n    ids.forEach(id => {\n        const option = document.createElement('option');\n        option.value = id;\n        datalist.appendChild(option);\n    });\n\n    if (ids.size > 0) {\n        setStatus(`Found ${ids.size} widgets`);\n    } else {\n        setStatus(\"No widgets found\");\n    }\n}\n\nasync function fetchRemoteState() {\n    const path = root.getElementById('note-search').value;\n    const id = root.getElementById('widget-id').value;\n    const editor = root.getElementById('state-editor');\n\n    if (!id) {\n        setStatus(\"Enter a Widget ID\");\n        return;\n    }\n\n    setStatus(\"Fetching...\");\n    const state = await api.getWidgetState(id, path);\n    \n    if (state === null) {\n        setStatus(\"No data found\");\n        editor.value = \"\";\n    } else {\n        editor.value = JSON.stringify(state, null, 2);\n        setStatus(\"State fetched\");\n    }\n}\n\nasync function pushRemoteState() {\n    const path = root.getElementById('note-search').value;\n    const id = root.getElementById('widget-id').value;\n    const content = root.getElementById('state-editor').value;\n\n    if (!id || !content) {\n        new Notice(\"ID and Data required\");\n        return;\n    }\n\n    try {\n        const data = JSON.parse(content);\n        setStatus(\"Pushing...\");\n        await api.updateWidgetState(id, data, path);\n        new Notice(\"Remote widget updated!\");\n        setStatus(\"Push successful\");\n    } catch (e) {\n        new Notice(\"Invalid JSON format\");\n        setStatus(\"Error: Invalid JSON\");\n    }\n}\n\nasync function remoteIncrement() {\n    const path = root.getElementById('note-search').value;\n    const id = root.getElementById('widget-id').value;\n    const key = root.getElementById('prop-key').value || \"count\";\n\n    if (!id) {\n        new Notice(\"Widget ID required\");\n        return;\n    }\n\n    setStatus(\"Incrementing...\");\n    const state = await api.getWidgetState(id, path) || {};\n    const currentVal = Number(state[key]) || 0;\n    state[key] = currentVal + 1;\n    \n    await api.updateWidgetState(id, state, path);\n    new Notice(`Remote ${key} is now ${state[key]}`);\n    await fetchRemoteState();\n}\n\nfunction clearEditor() {\n    root.getElementById('state-editor').value = \"\";\n    setStatus(\"Editor cleared\");\n}\n\nfunction setStatus(msg) {\n    root.getElementById('status-bar').innerText = msg;\n}\n\nasync function init() {\n    refreshNotes();\n    \n    const saved = await api.getState();\n    if (saved) {\n        if (saved.targetPath) root.getElementById('note-search').value = saved.targetPath;\n        if (saved.targetId) root.getElementById('widget-id').value = saved.targetId;\n        if (saved.propKey) root.getElementById('prop-key').value = saved.propKey;\n    }\n    \n    if (root.getElementById('widget-id').value) {\n        await scanWidgets();\n        await fetchRemoteState();\n    }\n}\n\ninit();",
    "tags": [
        "test",
        "api",
        "cross-widget",
        "dashboard",
        "remote",
        "pro"
    ]
}