{
  "id": "sleep-studio",
  "name": "Sleep Studio",
  "description": "Track your sleep patterns and improve your sleep quality.",
  "author": "Infinition",
  "authorUrl": "https://github.com/infinition",
  "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h4 class=\"widget-title\">üåô Sleep Studio Pro</h4>\n    <div class=\"header-actions\">\n      <button id=\"btn-view-toggle\" class=\"btn-icon-small\" title=\"Toggle Graph/List\">üìä</button>\n      <button id=\"btn-reset\" class=\"btn-icon-small\" title=\"Clear All Data\">üóëÔ∏è</button>\n    </div>\n  </div>\n\n  <div class=\"hero-stats\">\n    <div class=\"main-stat\">\n      <div id=\"avg-hours\" class=\"stat-value\">0.0</div>\n      <div class=\"stat-label\">Avg Hours</div>\n    </div>\n    <div class=\"stat-divider\"></div>\n    <div class=\"main-stat\">\n      <div id=\"avg-quality\" class=\"stat-value\">0</div>\n      <div class=\"stat-label\">Avg Quality</div>\n    </div>\n  </div>\n\n  <div class=\"input-card\">\n    <div class=\"slider-group\">\n      <div class=\"slider-header\">\n        <label>Hours Slept</label>\n        <span id=\"val-hours\" class=\"slider-val\">8.0h</span>\n      </div>\n      <input type=\"range\" id=\"sleep-hours\" min=\"0\" max=\"15\" step=\"0.5\" value=\"8.0\" class=\"modern-slider\">\n    </div>\n    \n    <div class=\"slider-group\">\n      <div class=\"slider-header\">\n        <label>Sleep Quality</label>\n        <span id=\"val-quality\" class=\"slider-val\">7/10</span>\n      </div>\n      <input type=\"range\" id=\"sleep-quality\" min=\"1\" max=\"10\" step=\"1\" value=\"7\" class=\"modern-slider quality-slider\">\n    </div>\n    \n    <button class=\"btn-log\" id=\"btn-log\">Log Night ‚ú®</button>\n  </div>\n\n  <div id=\"view-list\" class=\"view-container active\">\n    <div class=\"section-label\">Recent History (Drag to scroll, click to edit)</div>\n    <div class=\"history-list\" id=\"sleep-history\"></div>\n  </div>\n\n  <div id=\"view-graph\" class=\"view-container\">\n    <div class=\"section-label\">Sleep Trends</div>\n    <div class=\"graph-wrapper\">\n      <svg id=\"sleep-graph\" viewBox=\"0 0 300 120\" preserveAspectRatio=\"none\"></svg>\n      <div class=\"graph-labels\">\n        <button id=\"btn-graph-range\" class=\"btn-range-toggle\">30 days</button>\n        <span>Today</span>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
  "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); color: var(--text-normal); border-radius: 28px; padding: 1.5rem; box-shadow: var(--shadow-s); border: 1px solid var(--background-modifier-border); max-width: 360px; margin: 0 auto; position: relative; overflow: hidden; } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; } .widget-title { margin: 0; font-size: 0.85rem; font-weight: 800; color: var(--text-accent); text-transform: uppercase; letter-spacing: 1.5px; } .header-actions { display: flex; gap: 8px; } .btn-icon-small { background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-muted); width: 32px; height: 32px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; } .btn-icon-small:hover { background: var(--background-modifier-hover); color: var(--text-normal); } .hero-stats { display: flex; justify-content: space-around; align-items: center; background: var(--background-primary-alt); border-radius: 20px; padding: 1rem; margin-bottom: 1.25rem; border: 1px solid var(--background-modifier-border); } .stat-value { font-size: 1.8rem; font-weight: 800; color: var(--interactive-accent); line-height: 1; margin-bottom: 4px; } .stat-label { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); letter-spacing: 0.5px; } .stat-divider { width: 1px; height: 30px; background: var(--background-modifier-border); } .input-card { background: var(--background-primary); border-radius: 20px; padding: 1.25rem; margin-bottom: 1.25rem; border: 1px solid var(--background-modifier-border); } .slider-group { margin-bottom: 1.25rem; } .slider-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; } .slider-header label { font-size: 0.7rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; } .slider-val { font-size: 0.9rem; font-weight: 800; color: var(--interactive-accent); } .modern-slider { -webkit-appearance: none; width: 100%; height: 6px; background: var(--background-secondary-alt); border-radius: 10px; outline: none; } .modern-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: var(--interactive-accent); border-radius: 50%; cursor: pointer; box-shadow: 0 0 10px rgba(var(--interactive-accent-rgb), 0.3); transition: transform 0.2s; } .modern-slider::-webkit-slider-thumb:hover { transform: scale(1.2); } .quality-slider::-webkit-slider-thumb { background: var(--text-accent); } .btn-log { width: 100%; background: var(--interactive-accent); color: var(--text-on-accent); border: none; padding: 12px; border-radius: 12px; font-weight: 700; cursor: pointer; transition: all 0.3s; } .btn-log:hover { opacity: 0.9; transform: translateY(-2px); } .view-container { display: none; } .view-container.active { display: block; } .section-label { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; color: var(--text-faint); margin-bottom: 10px; letter-spacing: 1px; } .history-list { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px; scrollbar-width: none; cursor: grab; user-select: none; } .history-list:active { cursor: grabbing; } .history-list::-webkit-scrollbar { display: none; } .history-item { background: var(--background-primary-alt); padding: 10px; border-radius: 14px; min-width: 70px; text-align: center; border: 1px solid var(--background-modifier-border); transition: transform 0.2s, background 0.2s; } .history-item:hover { background: var(--background-modifier-hover); transform: translateY(-2px); } .h-val { display: block; font-weight: 800; font-size: 1rem; color: var(--interactive-accent); pointer-events: none; } .h-date { font-size: 0.55rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; pointer-events: none; } .graph-wrapper { background: var(--background-primary-alt); border-radius: 16px; padding: 12px; border: 1px solid var(--background-modifier-border); } #sleep-graph { width: 100%; height: 100px; stroke-linecap: round; stroke-linejoin: round; } .graph-labels { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 0.6rem; color: var(--text-faint); font-weight: 700; text-transform: uppercase; } .btn-range-toggle { background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-accent); padding: 2px 8px; border-radius: 4px; cursor: pointer; font-size: 0.6rem; font-weight: 800; text-transform: uppercase; transition: all 0.2s; } .btn-range-toggle:hover { background: var(--background-modifier-hover); color: var(--text-normal); } .toast-msg { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--interactive-accent); color: var(--text-on-accent); padding: 8px 16px; border-radius: 100px; font-size: 0.75rem; font-weight: 700; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 100; }",
  "js": "const { root, saveState, getState } = api;\n\nconst RANGES = [\n    { label: '7 days', val: 7 },\n    { label: '30 days', val: 30 },\n    { label: '3 months', val: 90 },\n    { label: '6 months', val: 180 },\n    { label: '1 year', val: 365 }\n];\n\nlet state = {\n    history: [],\n    view: 'list',\n    rangeIdx: 1,\n    editingDate: null\n};\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (!toast) return;\n    toast.innerText = msg; toast.style.opacity = '1';\n    setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n}\n\nfunction render() {\n    const list = root.querySelector('#sleep-history');\n    if (!list) return;\n    \n    let totalH = 0, totalQ = 0;\n    state.history.forEach(item => {\n        totalH += parseFloat(item.hours);\n        totalQ += parseInt(item.quality);\n    });\n    \n    const avgH = state.history.length > 0 ? (totalH / state.history.length).toFixed(1) : '0.0';\n    const avgQ = state.history.length > 0 ? Math.round(totalQ / state.history.length) : '0';\n    \n    root.querySelector('#avg-hours').innerText = avgH;\n    root.querySelector('#avg-quality').innerText = avgQ;\n\n    list.innerHTML = '';\n    state.history.forEach((item, idx) => {\n        const el = document.createElement('div');\n        el.className = 'history-item';\n        el.innerHTML = `\n            <span class=\"h-val\">${item.hours}h</span>\n            <span class=\"h-date\">${item.date}</span>\n        `;\n        el.onclick = () => editEntry(idx);\n        list.appendChild(el);\n    });\n\n    renderGraph();\n\n    root.querySelector('#view-list').className = 'view-container' + (state.view === 'list' ? ' active' : '');\n    root.querySelector('#view-graph').className = 'view-container' + (state.view === 'graph' ? ' active' : '');\n    root.querySelector('#btn-view-toggle').innerText = state.view === 'list' ? 'üìä' : 'üìú';\n    root.querySelector('#btn-graph-range').innerText = RANGES[state.rangeIdx].label;\n    \n    const logBtn = root.querySelector('#btn-log');\n    logBtn.innerText = state.editingDate ? `Update ${state.editingDate} ‚ú®` : 'Log Night ‚ú®';\n}\n\nfunction editEntry(idx) {\n    const item = state.history[idx];\n    state.editingDate = item.date;\n    \n    const hSlider = root.querySelector('#sleep-hours');\n    const qSlider = root.querySelector('#sleep-quality');\n    \n    hSlider.value = item.hours;\n    qSlider.value = item.quality;\n    \n    root.querySelector('#val-hours').innerText = item.hours + 'h';\n    root.querySelector('#val-quality').innerText = item.quality + '/10';\n    \n    showToast(`Editing log from ${item.date} ‚úèÔ∏è`);\n    render();\n}\n\nfunction renderGraph() {\n    const svg = root.querySelector('#sleep-graph');\n    if (!svg) return;\n    if (state.history.length < 2) {\n        svg.innerHTML = '<text x=\"50%\" y=\"50%\" text-anchor=\"middle\" fill=\"var(--text-faint)\" font-size=\"10\">Need more data...</text>';\n        return;\n    }\n    const range = RANGES[state.rangeIdx].val;\n    const data = state.history.slice(0, range).reverse();\n    const maxH = 15, width = 300, height = 120, padding = 10;\n    let points = '';\n    data.forEach((item, i) => {\n        const x = (i / (data.length - 1)) * (width - padding * 2) + padding;\n        const y = height - ((parseFloat(item.hours) / maxH) * (height - padding * 2)) - padding;\n        points += `${x},${y} `;\n    });\n    \n    // Get accent color from CSS variable or fallback\n    const accentColor = getComputedStyle(root).getPropertyValue('--interactive-accent').trim() || '#818cf8';\n    \n    svg.innerHTML = `\n        <defs>\n            <linearGradient id=\"grad\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\n                <stop offset=\"0%\" style=\"stop-color:${accentColor};stop-opacity:0.3\" />\n                <stop offset=\"100%\" style=\"stop-color:${accentColor};stop-opacity:0\" />\n            </linearGradient>\n        </defs>\n        <polyline points=\"${points}\" fill=\"none\" stroke=\"${accentColor}\" stroke-width=\"${range > 100 ? 1 : 2}\" />\n        <path d=\"M ${padding},${height} L ${points} L ${width-padding},${height} Z\" fill=\"url(#grad)\" />\n    `;\n}\n\nfunction logSleep() {\n    const hours = root.querySelector('#sleep-hours').value;\n    const quality = root.querySelector('#sleep-quality').value;\n    const date = state.editingDate || new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n\n    const existingIdx = state.history.findIndex(h => h.date === date);\n    if (existingIdx !== -1) {\n        state.history[existingIdx] = { hours, quality, date };\n    } else {\n        state.history.unshift({ hours, quality, date });\n    }\n\n    state.editingDate = null;\n    saveState(state);\n    render();\n    showToast('Night saved! üåô');\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) {\n        if (Array.isArray(saved)) state.history = saved;\n        else state = Object.assign(state, saved);\n    }\n\n    const hSlider = root.querySelector('#sleep-hours');\n    const qSlider = root.querySelector('#sleep-quality');\n    hSlider.oninput = (e) => root.querySelector('#val-hours').innerText = e.target.value + 'h';\n    qSlider.oninput = (e) => root.querySelector('#val-quality').innerText = e.target.value + '/10';\n\n    root.querySelector('#btn-log').onclick = logSleep;\n    root.querySelector('#btn-view-toggle').onclick = () => {\n        state.view = state.view === 'list' ? 'graph' : 'list';\n        render();\n        saveState(state);\n    };\n    root.querySelector('#btn-graph-range').onclick = () => {\n        state.rangeIdx = (state.rangeIdx + 1) % RANGES.length;\n        render();\n        saveState(state);\n    };\n    root.querySelector('#btn-reset').onclick = () => {\n        if (confirm('Clear all data?')) {\n            state.history = [];\n            render();\n            saveState(state);\n            showToast('Data cleared üóëÔ∏è');\n        }\n    };\n\n    const list = root.querySelector('#sleep-history');\n    let isDown = false, startX, scrollLeft;\n    list.onmousedown = (e) => {\n        isDown = true;\n        startX = e.pageX - list.offsetLeft;\n        scrollLeft = list.scrollLeft;\n    };\n    list.onmouseleave = () => isDown = false;\n    list.onmouseup = () => isDown = false;\n    list.onmousemove = (e) => {\n        if (!isDown) return;\n        e.preventDefault();\n        const x = e.pageX - list.offsetLeft;\n        const walk = (x - startX) * 2;\n        list.scrollLeft = scrollLeft - walk;\n    };\n\n    render();\n}\n\ninit();",
  "tags": [
    "health",
    "sleep",
    "tracker",
    "pro",
    "graph"
  ]
}