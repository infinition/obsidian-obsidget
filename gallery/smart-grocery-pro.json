{
  "id": "smart-grocery-pro",
  "name": "Smart Grocery Pro",
  "html": "<div id=\"widget-anchor\"></div>\n<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h3 class=\"widget-title\">ğŸ›’ Smart Grocery Pro</h3>\n    <div class=\"header-actions\">\n      <button id=\"btn-sort\" class=\"btn-icon\">ğŸª„ Sort</button>\n      <button id=\"btn-clear-all\" class=\"btn-icon\">ğŸ—‘ï¸ All</button>\n      <button id=\"btn-clear\" class=\"btn-icon\">ğŸ§¹ Done</button>\n      <button id=\"btn-edit-dict\" class=\"btn-icon\">âš™ï¸ Dict</button>\n    </div>\n  </div>\n\n  <div class=\"input-container\">\n    <div class=\"input-wrapper\">\n      <input type=\"text\" id=\"item-input\" placeholder=\"Add item...\" autocomplete=\"off\" />\n      <div id=\"autocomplete-list\" class=\"autocomplete-dropdown\"></div>\n    </div>\n    <button id=\"btn-add\" class=\"btn-add\">+</button>\n  </div>\n\n  <div id=\"grocery-list\" class=\"grocery-list\"></div>\n\n  <div class=\"footer\">\n    <div class=\"stats\">\n      <div id=\"item-count\">0 items</div>\n      <div id=\"learned-count\">0 learned</div>\n    </div>\n    <button id=\"btn-learn\" class=\"btn-icon\">Learn this order</button>\n  </div>\n\n  <div id=\"dict-modal\" class=\"modal-overlay\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h3>Manage Known Items</h3>\n        <button id=\"btn-close-dict\" class=\"btn-icon\">Ã—</button>\n      </div>\n      <div id=\"dict-list\"></div>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
  "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n.widget-card {\n    background: #1e293b;\n    color: #f8fafc;\n    border-radius: 24px;\n    padding: 1.5rem;\n    box-shadow: 0 20px 50px rgba(0,0,0,0.4);\n    border: 1px solid #334155;\n    min-width: 320px;\n    position: relative;\n    scroll-margin-top: 20px;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n.widget-title { margin: 0; font-size: 1.1rem; font-weight: 800; color: #38bdf8; text-transform: uppercase; letter-spacing: 1px; }\n\n.header-actions { display: flex; gap: 6px; }\n.btn-icon {\n    background: #334155; border: none; color: #94a3b8;\n    padding: 6px 10px; border-radius: 8px; font-size: 0.7rem;\n    font-weight: 700; cursor: pointer;\n}\n\n.input-container {\n    display: flex; gap: 10px; margin-bottom: 1.5rem; position: relative;\n}\n\n.input-wrapper { flex: 1; position: relative; }\n\ninput[type=\"text\"] {\n    width: 100%;\n    background: #0f172a;\n    border: 1px solid #334155;\n    color: white;\n    padding: 12px 16px;\n    border-radius: 12px;\n    font-size: 16px;\n    outline: none;\n    box-sizing: border-box;\n}\ninput[type=\"text\"]:focus { border-color: #38bdf8; }\n\n.autocomplete-dropdown {\n    position: absolute;\n    top: 100%; left: 0; right: 0;\n    background: #1e293b;\n    border: 1px solid #334155;\n    border-radius: 12px;\n    margin-top: 4px;\n    max-height: 200px;\n    overflow-y: auto;\n    z-index: 1000;\n    box-shadow: 0 10px 25px rgba(0,0,0,0.5);\n    display: none;\n}\n.autocomplete-item {\n    padding: 14px 16px;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255,255,255,0.05);\n}\n.autocomplete-item:hover { background: #334155; color: #38bdf8; }\n\n.btn-add {\n    background: #38bdf8; color: #0f172a; border: none;\n    width: 46px; height: 46px; border-radius: 12px;\n    font-size: 1.5rem; font-weight: 800; cursor: pointer;\n}\n\n.grocery-list {\n    display: grid; gap: 10px; margin-bottom: 1.5rem;\n}\n\n.list-item {\n    display: flex; align-items: center; gap: 12px;\n    padding: 12px 16px; background: rgba(255,255,255,0.03);\n    border-radius: 14px; border: 1px solid rgba(255,255,255,0.05);\n    transition: all 0.2s ease;\n    position: relative;\n}\n\n.list-item.dragging {\n    opacity: 0.4;\n    transform: scale(1.05);\n    box-shadow: 0 8px 16px rgba(0,0,0,0.3);\n    background: rgba(56, 189, 248, 0.1);\n    border-color: #38bdf8;\n}\n\n.list-item.drag-over {\n    border-top: 3px solid #38bdf8;\n    padding-top: 15px;\n}\n\n.drag-handle {\n    color: #475569;\n    font-size: 1.2rem;\n    cursor: grab;\n    padding: 8px;\n    margin: -8px;\n    display: flex;\n    align-items: center;\n    touch-action: none;\n}\n\n.drag-handle:active {\n    cursor: grabbing;\n}\n\n.checkbox {\n    width: 22px; height: 22px; border: 2px solid #38bdf8;\n    border-radius: 6px; flex-shrink: 0;\n    display: flex; align-items: center; justify-content: center;\n    cursor: pointer;\n    touch-action: manipulation;\n}\n.checkbox.checked { background: #38bdf8; }\n.checkbox.checked::after { content: \"âœ“\"; color: #0f172a; font-size: 14px; font-weight: 900; }\n\n.item-text { flex: 1; font-weight: 600; font-size: 0.95rem; pointer-events: none; }\n.btn-del { \n    background: none; border: none; color: #ef4444; \n    cursor: pointer; font-size: 1.2rem; padding: 8px;\n    touch-action: manipulation;\n}\n\n.footer {\n    display: flex; justify-content: space-between; align-items: center;\n    border-top: 1px solid #334155; padding-top: 1.25rem;\n}\n\n.modal-overlay {\n    position: absolute; top: 0; left: 0; right: 0; bottom: 0;\n    background: rgba(15, 23, 42, 0.9);\n    display: none; align-items: center; justify-content: center;\n    z-index: 2000; border-radius: 24px; backdrop-filter: blur(4px);\n}\n.modal-content {\n    background: #1e293b; width: 90%; max-height: 80%;\n    border-radius: 16px; display: flex; flex-direction: column; padding: 1rem;\n}\n\n.toast-msg {\n    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);\n    background: #0ea5e9; color: white; padding: 8px 16px; border-radius: 100px;\n    font-size: 0.8rem; font-weight: 700; opacity: 0; transition: opacity 0.3s;\n    pointer-events: none; z-index: 3000;\n}",
  "js": "var state = { items: [], learnedOrder: [], dictionary: [] };\nvar dragState = {\n    draggedIndex: null,\n    startY: 0,\n    currentY: 0,\n    isDragging: false,\n    draggedElement: null,\n    threshold: 10\n};\n\nfunction keepFocusAndPosition() {\n    const input = api.root.querySelector('#item-input');\n    const anchor = api.root.querySelector('#widget-anchor');\n    \n    if (input) {\n        input.focus();\n        setTimeout(() => input.focus(), 100);\n    }\n    \n    if (anchor) {\n        setTimeout(() => {\n            anchor.scrollIntoView({ behavior: 'smooth', block: 'start' });\n        }, 300);\n    }\n}\n\nfunction showToast(msg) {\n    const toast = api.root.querySelector('#toast-msg');\n    if (!toast) return;\n    toast.innerText = msg; toast.style.opacity = '1';\n    setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n}\n\nasync function addItem() {\n    const input = api.root.querySelector('#item-input');\n    const name = input.value.trim();\n    if (name) {\n        state.items.push({ name: name, checked: false });\n        if (state.dictionary.indexOf(name) === -1) state.dictionary.push(name);\n        input.value = '';\n        \n        const dropdown = api.root.querySelector('#autocomplete-list');\n        if (dropdown) dropdown.style.display = 'none';\n        \n        render();\n        await api.saveState(state);\n        keepFocusAndPosition();\n    }\n}\n\nasync function toggleItem(idx) {\n    state.items[idx].checked = !state.items[idx].checked;\n    if (state.items[idx].checked && state.learnedOrder.indexOf(state.items[idx].name) === -1) {\n        state.learnedOrder.push(state.items[idx].name);\n    }\n    render();\n    await api.saveState(state);\n}\n\nasync function deleteItem(idx) {\n    state.items.splice(idx, 1);\n    render();\n    await api.saveState(state);\n}\n\nfunction handleInput(e) {\n    const input = e.target;\n    const val = input.value.trim().toLowerCase();\n    const dropdown = api.root.querySelector('#autocomplete-list');\n    if (!dropdown) return;\n    \n    const availableItems = state.dictionary.filter(item => \n        !state.items.some(i => i.name.toLowerCase() === item.toLowerCase())\n    ).sort();\n    \n    const matches = val ? availableItems.filter(item => item.toLowerCase().indexOf(val) !== -1).slice(0, 8) : availableItems.slice(0, 5);\n    \n    dropdown.innerHTML = '';\n    if (matches.length > 0) {\n        matches.forEach(m => {\n            const div = document.createElement('div');\n            div.className = 'autocomplete-item';\n            div.innerText = m;\n            div.addEventListener('mousedown', (ev) => {\n                ev.preventDefault();\n                const inputField = api.root.querySelector('#item-input');\n                inputField.value = m;\n                addItem();\n            });\n            dropdown.appendChild(div);\n        });\n        dropdown.style.display = 'block';\n    } else {\n        dropdown.style.display = 'none';\n    }\n}\n\nasync function reorderList() {\n    if (state.learnedOrder.length === 0) return;\n    state.items.sort((a, b) => {\n        const idxA = state.learnedOrder.indexOf(a.name);\n        const idxB = state.learnedOrder.indexOf(b.name);\n        if (idxA !== -1 && idxB !== -1) return idxA - idxB;\n        return idxA !== -1 ? -1 : (idxB !== -1 ? 1 : 0);\n    });\n    render();\n    await api.saveState(state);\n    showToast('Sorted! âœ¨');\n}\n\nfunction handleDragStart(e, idx, handle) {\n    if (e.target !== handle) return;\n    \n    e.preventDefault();\n    \n    const touch = e.touches[0];\n    dragState.startY = touch.clientY;\n    dragState.currentY = touch.clientY;\n    dragState.draggedIndex = idx;\n    dragState.isDragging = false;\n    dragState.draggedElement = handle.closest('.list-item');\n}\n\nfunction handleDragMove(e) {\n    if (dragState.draggedIndex === null) return;\n    \n    const touch = e.touches[0];\n    dragState.currentY = touch.clientY;\n    const deltaY = Math.abs(dragState.currentY - dragState.startY);\n    \n    if (!dragState.isDragging && deltaY > dragState.threshold) {\n        dragState.isDragging = true;\n        if (dragState.draggedElement) {\n            dragState.draggedElement.classList.add('dragging');\n        }\n    }\n    \n    if (dragState.isDragging) {\n        e.preventDefault();\n        \n        const items = Array.from(api.root.querySelectorAll('.list-item'));\n        items.forEach(item => item.classList.remove('drag-over'));\n        \n        const elements = document.elementsFromPoint(touch.clientX, touch.clientY);\n        const targetItem = elements.find(el => \n            el.classList && \n            el.classList.contains('list-item') && \n            el !== dragState.draggedElement\n        );\n        \n        if (targetItem) {\n            targetItem.classList.add('drag-over');\n        }\n    }\n}\n\nasync function handleDragEnd(e) {\n    if (dragState.draggedIndex === null) return;\n    \n    if (dragState.isDragging) {\n        const touch = e.changedTouches[0];\n        const elements = document.elementsFromPoint(touch.clientX, touch.clientY);\n        const targetItem = elements.find(el => \n            el.classList && \n            el.classList.contains('list-item') && \n            el !== dragState.draggedElement\n        );\n        \n        if (targetItem) {\n            const items = Array.from(api.root.querySelectorAll('.list-item'));\n            const targetIdx = items.indexOf(targetItem);\n            \n            if (targetIdx !== -1 && targetIdx !== dragState.draggedIndex) {\n                const draggedItem = state.items[dragState.draggedIndex];\n                state.items.splice(dragState.draggedIndex, 1);\n                state.items.splice(targetIdx, 0, draggedItem);\n                \n                await api.saveState(state);\n                showToast('Reordered! ğŸ“‹');\n                render();\n            }\n        }\n    }\n    \n    const items = Array.from(api.root.querySelectorAll('.list-item'));\n    items.forEach(item => {\n        item.classList.remove('dragging');\n        item.classList.remove('drag-over');\n    });\n    \n    dragState.draggedIndex = null;\n    dragState.isDragging = false;\n    dragState.draggedElement = null;\n    dragState.startY = 0;\n    dragState.currentY = 0;\n}\n\nfunction render() {\n    const list = api.root.querySelector('#grocery-list');\n    if (!list) return;\n    list.innerHTML = '';\n    \n    state.items.forEach((item, idx) => {\n        const div = document.createElement('div');\n        div.className = 'list-item' + (item.checked ? ' checked' : '');\n        div.innerHTML = `\n            <span class=\"drag-handle\">â˜°</span>\n            <div class=\"checkbox\"></div>\n            <span class=\"item-text\">${item.name}</span>\n            <button class=\"btn-del\">ğŸ—‘ï¸</button>\n        `;\n        \n        const checkbox = div.querySelector('.checkbox');\n        checkbox.addEventListener('click', (e) => {\n            e.stopPropagation();\n            toggleItem(idx);\n        });\n        \n        const delBtn = div.querySelector('.btn-del');\n        delBtn.addEventListener('click', (e) => {\n            e.stopPropagation();\n            deleteItem(idx);\n        });\n        \n        const handle = div.querySelector('.drag-handle');\n        handle.addEventListener('touchstart', (e) => handleDragStart(e, idx, handle), { passive: false });\n        handle.addEventListener('touchmove', handleDragMove, { passive: false });\n        handle.addEventListener('touchend', handleDragEnd, { passive: false });\n        handle.addEventListener('touchcancel', handleDragEnd, { passive: false });\n        \n        list.appendChild(div);\n    });\n    \n    api.root.querySelector('#item-count').innerText = state.items.length + ' items';\n    api.root.querySelector('#learned-count').innerText = state.learnedOrder.length + ' learned';\n}\n\nasync function init() {\n    try {\n        const saved = await api.getState();\n        if (saved) state = Object.assign(state, saved);\n    } catch (e) {}\n    \n    api.root.querySelector('#btn-add').onclick = addItem;\n    api.root.querySelector('#btn-sort').onclick = reorderList;\n    api.root.querySelector('#btn-clear').onclick = async () => {\n        state.items = state.items.filter(i => !i.checked);\n        render(); await api.saveState(state);\n    };\n    api.root.querySelector('#btn-clear-all').onclick = async () => {\n        if (confirm('Clear all?')) { state.items = []; render(); await api.saveState(state); }\n    };\n    api.root.querySelector('#btn-learn').onclick = async () => {\n        const names = state.items.map(i => i.name);\n        state.learnedOrder = [...new Set([...names, ...state.learnedOrder])];\n        showToast('Order learned! ğŸ§ ');\n        render(); await api.saveState(state);\n    };\n    api.root.querySelector('#btn-edit-dict').onclick = () => { api.root.querySelector('#dict-modal').style.display = 'flex'; };\n    api.root.querySelector('#btn-close-dict').onclick = () => { api.root.querySelector('#dict-modal').style.display = 'none'; };\n\n    const input = api.root.querySelector('#item-input');\n    if (input) {\n        input.oninput = handleInput;\n        input.onfocus = keepFocusAndPosition;\n        input.onclick = keepFocusAndPosition;\n        input.onkeydown = (e) => { if (e.key === 'Enter') addItem(); };\n    }\n\n    api.root.addEventListener('click', (e) => {\n        const container = api.root.querySelector('.input-container');\n        if (container && !container.contains(e.target)) {\n            api.root.querySelector('#autocomplete-list').style.display = 'none';\n        }\n    });\n    \n    render();\n}\ninit();",
  "tags": [
    "grocery",
    "list",
    "organization"
  ]
}