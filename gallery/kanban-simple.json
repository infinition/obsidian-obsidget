{
  "id": "kanban-simple",
  "name": "Kanban Studio Pro",
  "html": "<div class=\"kanban-wrapper\" id=\"kanban-root\">\n  <div class=\"kanban-board\">\n    <div class=\"kanban-column\" data-state=\"todo\">\n      <div class=\"kanban-column-header\">\n        <span class=\"kanban-column-title\">To Do</span>\n        <span class=\"kanban-column-count\">0</span>\n      </div>\n      <div class=\"kanban-column-items\" data-state=\"todo\"></div>\n      <div class=\"kanban-add-btn\">+</div>\n    </div>\n    <div class=\"kanban-column\" data-state=\"in-progress\">\n      <div class=\"kanban-column-header\">\n        <span class=\"kanban-column-title\">In Progress</span>\n        <span class=\"kanban-column-count\">0</span>\n      </div>\n      <div class=\"kanban-column-items\" data-state=\"in-progress\"></div>\n      <div class=\"kanban-add-btn\">+</div>\n    </div>\n    <div class=\"kanban-column\" data-state=\"done\">\n      <div class=\"kanban-column-header\">\n        <span class=\"kanban-column-title\">Done</span>\n        <span class=\"kanban-column-count\">0</span>\n      </div>\n      <div class=\"kanban-column-items\" data-state=\"done\"></div>\n      <div class=\"kanban-add-btn\">+</div>\n    </div>\n  </div>\n</div>",
  "css": ".kanban-wrapper {\n    width: 100%;\n    padding: 10px;\n    font-family: var(--font-interface);\n}\n\n.kanban-board {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 12px;\n    align-items: flex-start;\n}\n\n.kanban-column {\n    background: var(--background-secondary);\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n    max-height: 100%;\n    border: 1px solid var(--background-modifier-border);\n    min-width: 0; /* Allow columns to shrink */\n}\n\n.kanban-column-header {\n    padding: 12px 16px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: 600;\n}\n\n.kanban-column-title {\n    font-size: 0.9rem;\n    color: var(--text-normal);\n}\n\n.kanban-column-count {\n    font-size: 0.75rem;\n    color: var(--text-muted);\n    background: var(--background-primary);\n    padding: 2px 8px;\n    border-radius: 12px;\n}\n\n.kanban-column-items {\n    padding: 8px;\n    min-height: 50px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.kanban-card {\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    padding: 10px;\n    cursor: grab;\n    font-size: 0.85rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    transition: transform 0.1s, box-shadow 0.1s;\n}\n\n.kanban-card:hover {\n    border-color: var(--interactive-accent);\n}\n\n.kanban-card.kanban-card-dragging {\n    opacity: 0.4;\n    cursor: grabbing;\n}\n\n.kanban-card.kanban-card-done {\n    opacity: 0.6;\n}\n\n.kanban-card.kanban-card-done .kanban-card-text {\n    text-decoration: line-through;\n}\n\n.kanban-card-badge {\n    font-size: 0.7rem;\n    color: var(--text-muted);\n    background: var(--background-secondary);\n    padding: 1px 4px;\n    border-radius: 4px;\n    margin-left: 6px;\n}\n\n.kanban-add-btn {\n    padding: 8px;\n    text-align: center;\n    color: var(--text-muted);\n    cursor: pointer;\n    font-size: 1.2rem;\n    border-top: 1px solid var(--background-modifier-border);\n    transition: background 0.2s, color 0.2s;\n}\n\n.kanban-add-btn:hover {\n    background: var(--background-modifier-hover);\n    color: var(--text-normal);\n}\n\n.kanban-drag-over {\n    background: var(--background-modifier-hover);\n}\n\n.kanban-drop-indicator {\n    height: 2px;\n    background: var(--interactive-accent);\n    margin: 4px 0;\n    border-radius: 1px;\n}\n\n.kanban-card-delete-zone {\n    border: 2px dashed var(--text-error) !important;\n    background: rgba(var(--text-error-rgb), 0.1) !important;\n}\n\n.kanban-edit-input {\n    width: 100%;\n    background: var(--background-primary);\n    border: 1px solid var(--interactive-accent);\n    color: var(--text-normal);\n    padding: 8px;\n    border-radius: 4px;\n    font-size: 0.85rem;\n    font-family: inherit;\n    resize: none;\n    outline: none;\n}\n\n.internal-link {\n    color: var(--link-color);\n    cursor: pointer;\n    text-decoration: var(--link-decoration);\n}\n.internal-link:hover { text-decoration: underline; }\n\n.tag {\n    background-color: var(--tag-background);\n    border: var(--tag-border-width) solid var(--tag-border-color);\n    border-radius: var(--tag-radius);\n    color: var(--tag-color);\n    font-size: var(--tag-size);\n    font-weight: var(--tag-weight);\n    padding: 0 4px;\n    text-decoration: none;\n    cursor: pointer;\n}\n.tag:hover { background-color: var(--tag-background-hover); }\n\n.kanban-suggest-menu {\n    position: fixed;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 6px;\n    box-shadow: var(--shadow-l);\n    z-index: 1000;\n    min-width: 200px;\n    max-height: 200px;\n    overflow-y: auto;\n    padding: 4px;\n}\n\n.kanban-suggest-item {\n    padding: 6px 12px;\n    font-size: 0.8rem;\n    cursor: pointer;\n    border-radius: 4px;\n    color: var(--text-normal);\n}\n\n.kanban-suggest-item:hover, .kanban-suggest-item.is-selected {\n    background: var(--background-modifier-hover);\n    color: var(--text-accent);\n}",
  "js": "const { root, saveState, getState, app } = api;\n\nclass KanbanSuggest {\n    constructor(app, inputEl, root) {\n        this.app = app;\n        this.inputEl = inputEl;\n        this.root = root;\n        this.suggestions = [];\n        this.selectedIndex = 0;\n        this.menuEl = null;\n\n        this.inputEl.addEventListener('input', () => this.onInput());\n        this.inputEl.addEventListener('keydown', (e) => this.onKeyDown(e));\n        // Close on click outside\n        document.addEventListener('click', (e) => {\n            if (this.menuEl && !this.menuEl.contains(e.target) && e.target !== this.inputEl) {\n                this.close();\n            }\n        });\n    }\n\n    onInput() {\n        const cursor = this.inputEl.selectionStart;\n        const text = this.inputEl.value.substring(0, cursor);\n        \n        const tagMatch = text.match(/#([^\\s#\\[\\]]*)$/);\n        if (tagMatch) {\n            this.showSuggestions('tag', tagMatch[1].toLowerCase());\n            return;\n        }\n\n        const linkMatch = text.match(/\\[\\[([^\\]]*)$/);\n        if (linkMatch) {\n            this.showSuggestions('link', linkMatch[1].toLowerCase());\n            return;\n        }\n\n        this.close();\n    }\n\n    showSuggestions(type, query) {\n        if (!this.app) return;\n\n        let items = [];\n        if (type === 'tag') {\n            const tags = new Set();\n            this.app.vault.getMarkdownFiles().forEach(f => {\n                const cache = this.app.metadataCache.getFileCache(f);\n                if (cache?.tags) cache.tags.forEach(t => tags.add(t.tag));\n            });\n            items = Array.from(tags).filter(t => t.toLowerCase().includes(query));\n        } else {\n            items = this.app.vault.getMarkdownFiles()\n                .filter(f => f.basename.toLowerCase().includes(query))\n                .map(f => f.basename);\n        }\n\n        if (items.length === 0) {\n            this.close();\n            return;\n        }\n\n        this.suggestions = items.slice(0, 10);\n        this.selectedIndex = 0;\n        this.renderMenu();\n    }\n\n    renderMenu() {\n        if (!this.menuEl) {\n            this.menuEl = document.createElement('div');\n            this.menuEl.className = 'kanban-suggest-menu';\n            this.root.appendChild(this.menuEl);\n        }\n\n        this.menuEl.innerHTML = '';\n        this.suggestions.forEach((item, i) => {\n            const div = document.createElement('div');\n            div.className = `kanban-suggest-item ${i === this.selectedIndex ? 'is-selected' : ''}`;\n            div.innerText = item;\n            div.onclick = () => this.selectItem(item);\n            this.menuEl.appendChild(div);\n        });\n\n        const rect = this.inputEl.getBoundingClientRect();\n        this.menuEl.style.top = `${rect.bottom + 5}px`;\n        this.menuEl.style.left = `${rect.left}px`;\n        this.menuEl.style.display = 'block';\n    }\n\n    onKeyDown(e) {\n        if (!this.menuEl || this.menuEl.style.display === 'none') return;\n\n        if (e.key === 'ArrowDown') {\n            e.preventDefault();\n            this.selectedIndex = (this.selectedIndex + 1) % this.suggestions.length;\n            this.renderMenu();\n        } else if (e.key === 'ArrowUp') {\n            e.preventDefault();\n            this.selectedIndex = (this.selectedIndex - 1 + this.suggestions.length) % this.suggestions.length;\n            this.renderMenu();\n        } else if (e.key === 'Enter' || e.key === 'Tab') {\n            e.preventDefault();\n            this.selectItem(this.suggestions[this.selectedIndex]);\n        } else if (e.key === 'Escape') {\n            this.close();\n        }\n    }\n\n    selectItem(item) {\n        const cursor = this.inputEl.selectionStart;\n        const text = this.inputEl.value;\n        const before = text.substring(0, cursor);\n        const after = text.substring(cursor);\n\n        let newBefore = '';\n        if (before.match(/#([^\\s#\\[\\]]*)$/)) {\n            newBefore = before.replace(/#([^\\s#\\[\\]]*)$/, item.startsWith('#') ? item : '#' + item);\n        } else if (before.match(/\\[\\[([^\\]]*)$/)) {\n            newBefore = before.replace(/\\[\\[([^\\]]*)$/, '[[' + item + ']]');\n        }\n\n        this.inputEl.value = newBefore + after;\n        this.inputEl.selectionStart = this.inputEl.selectionEnd = newBefore.length;\n        this.close();\n        this.inputEl.focus();\n    }\n\n    close() {\n        if (this.menuEl) this.menuEl.style.display = 'none';\n        this.selectedIndex = 0;\n    }\n}\n\nlet state = {\n    items: [\n        { id: '1', text: 'Task 1', state: 'todo', children: [] },\n        { id: '2', text: 'Task 2', state: 'in-progress', children: [] },\n        { id: '3', text: 'Task 3', state: 'done', children: [] }\n    ],\n    ignoredLines: []\n};\n\nlet draggedItem = null;\nlet draggedElement = null;\nlet deleteDelay = 0.75;\nlet dragOutsideStartTime = null;\n\nfunction render() {\n    const board = root.querySelector('.kanban-board');\n    if (!board) return;\n\n    const columns = ['todo', 'in-progress', 'done'];\n    columns.forEach(colState => {\n        const colItems = state.items.filter(item => item.state === colState);\n        const colEl = board.querySelector(`[data-state=\"${colState}\"]`);\n        const listEl = colEl.querySelector('.kanban-column-items');\n        const countEl = colEl.querySelector('.kanban-column-count');\n\n        listEl.innerHTML = '';\n        countEl.innerText = colItems.length;\n\n        colItems.forEach(item => {\n            const card = document.createElement('div');\n            card.className = 'kanban-card';\n            if (item.state === 'done') card.classList.add('kanban-card-done');\n            card.dataset.id = item.id;\n            card.draggable = true;\n\n            // Simple markdown-like rendering for links and tags\n            let renderedText = item.text\n                .replace(/\\[\\[([^\\]|]+)(?:\\|([^\\]]+))?\\]\\]/g, (m, p1, p2) => `<span class=\"internal-link\">${p2 || p1}</span>`)\n                .replace(/#([^\\s#\\[\\]]+)/g, '<span class=\"tag\">#$1</span>');\n\n            card.innerHTML = `<div class=\"kanban-card-text\">${renderedText}</div>`;\n            if (item.children && item.children.length > 0) {\n                const badge = document.createElement('span');\n                badge.className = 'kanban-card-badge';\n                badge.innerText = `+${item.children.length}`;\n                card.appendChild(badge);\n            }\n\n            card.addEventListener('dragstart', (e) => handleDragStart(e, item, card));\n            card.addEventListener('dragend', (e) => handleDragEnd(e));\n            card.addEventListener('dblclick', (e) => {\n                e.preventDefault();\n                startEditing(card, item);\n            });\n\n            listEl.appendChild(card);\n        });\n\n        setupDropZone(listEl, colState);\n    });\n\n    root.querySelectorAll('.kanban-add-btn').forEach(btn => {\n        btn.onclick = () => addNewItem(btn.closest('.kanban-column').dataset.state);\n    });\n}\n\nfunction handleDragStart(e, item, el) {\n    draggedItem = item;\n    draggedElement = el;\n    dragOutsideStartTime = Date.now();\n    el.classList.add('kanban-card-dragging');\n    e.dataTransfer.effectAllowed = 'move';\n    e.dataTransfer.setData('text/plain', item.id);\n}\n\nfunction handleDragEnd(e) {\n    if (draggedElement) {\n        draggedElement.classList.remove('kanban-card-dragging');\n        draggedElement.classList.remove('kanban-card-delete-zone');\n    }\n\n    if (e.dataTransfer.dropEffect === 'none' && draggedItem && dragOutsideStartTime) {\n        if ((Date.now() - dragOutsideStartTime) / 1000 >= deleteDelay) {\n            deleteItem(draggedItem);\n        }\n    }\n\n    draggedItem = null;\n    draggedElement = null;\n    dragOutsideStartTime = null;\n    root.querySelectorAll('.kanban-drag-over').forEach(el => el.classList.remove('kanban-drag-over'));\n    root.querySelectorAll('.kanban-drop-indicator').forEach(el => el.remove());\n}\n\nfunction deleteItem(item) {\n    const idx = state.items.findIndex(i => i.id === item.id);\n    if (idx > -1) {\n        state.items.splice(idx, 1);\n        render();\n        save();\n    }\n}\n\nfunction setupDropZone(el, colState) {\n    el.addEventListener('dragover', (e) => {\n        e.preventDefault();\n        dragOutsideStartTime = Date.now();\n        el.classList.add('kanban-drag-over');\n        \n        const afterElement = getDragAfterElement(el, e.clientY);\n        let indicator = el.querySelector('.kanban-drop-indicator');\n        if (!indicator) {\n            indicator = document.createElement('div');\n            indicator.className = 'kanban-drop-indicator';\n        }\n        \n        if (afterElement) afterElement.before(indicator);\n        else el.appendChild(indicator);\n    });\n\n    el.addEventListener('dragleave', (e) => {\n        if (!el.contains(e.relatedTarget)) {\n            el.classList.remove('kanban-drag-over');\n            el.querySelector('.kanban-drop-indicator')?.remove();\n        }\n    });\n\n    el.addEventListener('drop', (e) => {\n        e.preventDefault();\n        el.classList.remove('kanban-drag-over');\n        el.querySelector('.kanban-drop-indicator')?.remove();\n\n        const afterElement = getDragAfterElement(el, e.clientY);\n        const afterId = afterElement?.dataset.id;\n        \n        if (draggedItem) {\n            moveItem(draggedItem, colState, afterId);\n        }\n    });\n}\n\nfunction getDragAfterElement(container, y) {\n    const cards = [...container.querySelectorAll('.kanban-card:not(.kanban-card-dragging)')];\n    return cards.reduce((closest, child) => {\n        const box = child.getBoundingClientRect();\n        const offset = y - box.top - box.height / 2;\n        if (offset < 0 && offset > closest.offset) {\n            return { offset: offset, element: child };\n        } else {\n            return closest;\n        }\n    }, { offset: Number.NEGATIVE_INFINITY }).element;\n}\n\nfunction moveItem(item, newState, afterId) {\n    item.state = newState;\n    const oldIdx = state.items.findIndex(i => i.id === item.id);\n    if (oldIdx > -1) state.items.splice(oldIdx, 1);\n\n    if (afterId) {\n        const newIdx = state.items.findIndex(i => i.id === afterId);\n        state.items.splice(newIdx, 0, item);\n    } else {\n        state.items.push(item);\n    }\n\n    render();\n    save();\n}\n\nfunction addNewItem(colState) {\n    const id = crypto.randomUUID();\n    const newItem = { id, text: '', state: colState, children: [] };\n    state.items.push(newItem);\n    \n    render();\n    const card = root.querySelector(`[data-id=\"${id}\"]`);\n    startEditing(card, newItem, true);\n}\n\nfunction startEditing(card, item, isNew = false) {\n    card.draggable = false;\n    const textEl = card.querySelector('.kanban-card-text');\n    const textarea = document.createElement('textarea');\n    textarea.className = 'kanban-edit-input';\n    textarea.value = item.text;\n    textEl.replaceWith(textarea);\n    \n    // Add suggestions\n    if (app) {\n        new KanbanSuggest(app, textarea, root);\n    }\n    \n    textarea.focus();\n\n    const finish = () => {\n        const val = textarea.value.trim();\n        if (val === '') {\n            if (isNew) deleteItem(item);\n            else render();\n        } else {\n            item.text = val;\n            render();\n            save();\n        }\n    };\n\n    textarea.addEventListener('blur', finish);\n    textarea.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter' && !e.shiftKey) {\n            e.preventDefault();\n            textarea.blur();\n        } else if (e.key === 'Escape') {\n            textarea.removeEventListener('blur', finish);\n            render();\n        }\n    });\n}\n\nfunction save() {\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) state = saved;\n    \n    // Global dragover to detect dragging outside\n    document.addEventListener('dragover', (e) => {\n        if (!draggedElement) return;\n        const board = root.querySelector('.kanban-board');\n        const rect = board.getBoundingClientRect();\n        if (e.clientX < rect.left || e.clientX > rect.right || e.clientY < rect.top || e.clientY > rect.bottom) {\n            draggedElement.classList.add('kanban-card-delete-zone');\n        } else {\n            draggedElement.classList.remove('kanban-card-delete-zone');\n        }\n    });\n\n    render();\n}\n\ninit();",
  "tags": [
    "productivity",
    "tasks",
    "organization",
    "kanban"
  ]
}