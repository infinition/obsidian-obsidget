{
    "id": "stock-watchlist",
    "name": "Stock Watchlist",
    "description": "Monitor your favorite stocks and portfolio performance.",
    "author": "Infinition",
    "authorUrl": "https://github.com/infinition",
    "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"title-group\">\n      <h4 class=\"widget-title\">üìà Stock Studio Pro</h4>\n      <div id=\"market-status\" class=\"market-status\">Market Open</div>\n    </div>\n    <div class=\"header-actions\">\n      <button id=\"btn-auto-refresh\" class=\"btn-icon-small\" title=\"Toggle Auto-Refresh\">‚è±Ô∏è</button>\n      <button id=\"btn-refresh\" class=\"btn-icon-small\" title=\"Refresh Prices\">üîÑ</button>\n      <button id=\"btn-portfolio-toggle\" class=\"btn-icon-small\" title=\"Toggle Portfolio Mode\">üíº</button>\n    </div>\n  </div>\n\n  <div id=\"portfolio-summary\" class=\"portfolio-summary hidden\">\n    <div class=\"summary-item\">\n      <label>Total Value</label>\n      <div id=\"total-value\" class=\"summary-val\">$0.00</div>\n    </div>\n    <div class=\"summary-item\">\n      <label>24h Change</label>\n      <div id=\"total-change\" class=\"summary-val\">+0.00%</div>\n    </div>\n  </div>\n\n  <div class=\"stock-list\" id=\"stock-list\"></div>\n\n  <div class=\"input-card\">\n    <div class=\"input-group\">\n      <input type=\"text\" id=\"stock-symbol\" placeholder=\"Symbol (ex: AAPL)\" maxlength=\"6\">\n      <button id=\"btn-add\">Ajouter ‚ú®</button>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
    "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: var(--background-secondary);\n    color: var(--text-normal);\n    border-radius: 24px;\n    padding: 1.5rem;\n    box-shadow: var(--shadow-l);\n    border: 1px solid var(--background-modifier-border);\n    max-width: 400px;\n    margin: 0 auto;\n    position: relative;\n    overflow: hidden;\n}\n\n.widget-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem; }\n.widget-title { margin: 0; font-size: 0.85rem; font-weight: 800; color: var(--text-accent); text-transform: uppercase; letter-spacing: 1.5px; }\n\n.market-status { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--text-success); margin-top: 4px; display: flex; align-items: center; gap: 4px; }\n.market-status::before { content: ''; width: 6px; height: 6px; background: currentColor; border-radius: 50%; display: inline-block; box-shadow: 0 0 8px currentColor; }\n\n.header-actions { display: flex; gap: 6px; }\n.btn-icon-small {\n    background: var(--background-modifier-hover); border: none; color: var(--text-muted); width: 32px; height: 32px;\n    border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;\n}\n.btn-icon-small:hover { background: var(--background-modifier-border-hover); color: var(--text-normal); }\n.btn-icon-small.active { background: var(--interactive-accent); color: var(--text-on-accent); }\n\n.portfolio-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; background: var(--background-primary-alt); padding: 1rem; border-radius: 16px; margin-bottom: 1.5rem; border: 1px solid var(--background-modifier-border); }\n.portfolio-summary.hidden { display: none; }\n\n.summary-item label { display: block; font-size: 0.6rem; font-weight: 700; text-transform: uppercase; color: var(--text-muted); margin-bottom: 4px; }\n.summary-val { font-size: 1.1rem; font-weight: 800; color: var(--text-normal); }\n\n.stock-list { display: grid; gap: 12px; margin-bottom: 1.5rem; }\n.stock-item {\n    background: var(--background-primary); border-radius: 16px; padding: 12px 16px;\n    border: 1px solid var(--background-modifier-border); display: grid; grid-template-columns: 1fr 80px 1fr; align-items: center; gap: 12px;\n    transition: transform 0.2s;\n}\n.stock-item:hover { transform: translateY(-2px); border-color: var(--interactive-accent); }\n\n.symbol { font-weight: 900; font-size: 1.1rem; color: var(--text-normal); display: block; }\n.company { font-size: 0.6rem; color: var(--text-muted); font-weight: 700; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\n\n.sparkline-box { height: 30px; width: 100%; }\n.sparkline { width: 100%; height: 100%; overflow: visible; }\n\n.stock-price-box { text-align: right; display: flex; flex-direction: column; align-items: flex-end; }\n.price { font-weight: 800; font-size: 1rem; color: var(--text-normal); font-family: var(--font-monospace); }\n.change { font-size: 0.65rem; font-weight: 800; padding: 2px 6px; border-radius: 6px; margin-top: 4px; }\n.change.up { background: rgba(var(--mono-rgb-100), 0.1); color: var(--text-success); }\n.change.down { background: rgba(var(--mono-rgb-100), 0.1); color: var(--text-error); }\n\n.portfolio-controls { grid-column: 1 / -1; display: flex; justify-content: space-between; align-items: center; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--background-modifier-border); }\n.portfolio-controls.hidden { display: none; }\n\n.qty-input {\n    background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-normal);\n    width: 80px; padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: 700; outline: none;\n}\n.qty-input:focus { border-color: var(--interactive-accent); }\n\n.btn-del { background: none; border: none; color: var(--text-error); cursor: pointer; opacity: 0.6; font-size: 1rem; transition: opacity 0.2s; }\n.btn-del:hover { opacity: 1; }\n\n.input-card { background: var(--background-primary-alt); border-radius: 16px; padding: 1rem; border: 1px solid var(--background-modifier-border); }\n.input-group { display: flex; gap: 8px; }\n.input-group input { flex: 1; background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-normal); border-radius: 10px; padding: 10px 14px; font-size: 0.85rem; outline: none; font-weight: 700; }\n.input-group input:focus { border-color: var(--interactive-accent); }\n.input-group button { background: var(--interactive-accent); color: var(--text-on-accent); border: none; padding: 0 16px; border-radius: 10px; font-weight: 800; cursor: pointer; transition: filter 0.2s; }\n.input-group button:hover { filter: brightness(1.1); }\n\n.toast-msg { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--interactive-accent); color: var(--text-on-accent); padding: 8px 16px; border-radius: 100px; font-size: 0.75rem; font-weight: 700; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 100; }",
    "js": "const { root, saveState, getState } = api;\n\nvar state = {\n    stocks: [],\n    showPortfolio: false,\n    autoRefresh: true\n};\n\nvar refreshInterval = null;\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (toast) {\n        toast.innerText = msg;\n        toast.style.opacity = '1';\n        setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n    }\n}\n\nfunction generateHistory(base) {\n    let h = [], curr = base;\n    for(let i=0; i<20; i++) {\n        curr *= (1 + (Math.random() * 0.04 - 0.02));\n        h.push(curr);\n    }\n    return h;\n}\n\nfunction updateUI() {\n    const list = root.querySelector('#stock-list');\n    if (!list) return;\n\n    // Update Header Buttons\n    root.querySelector('#btn-auto-refresh').classList.toggle('active', state.autoRefresh);\n    root.querySelector('#btn-portfolio-toggle').classList.toggle('active', state.showPortfolio);\n\n    // Update Market Status\n    const now = new Date(), h = now.getHours(), d = now.getDay();\n    const isOpen = d >= 1 && d <= 5 && h >= 9 && h < 17;\n    const statusEl = root.querySelector('#market-status');\n    statusEl.innerText = isOpen ? 'Market Open' : 'Market Closed';\n    statusEl.style.color = isOpen ? 'var(--text-success)' : 'var(--text-error)';\n\n    // Update Portfolio Summary\n    const summary = root.querySelector('#portfolio-summary');\n    summary.classList.toggle('hidden', !state.showPortfolio);\n    \n    if (state.showPortfolio) {\n        let total = 0;\n        state.stocks.forEach(s => {\n            total += (s.price || 0) * (s.qty || 0);\n        });\n        root.querySelector('#total-value').innerText = '$' + total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});\n    }\n\n    // Render List\n    list.innerHTML = '';\n    state.stocks.forEach((s, idx) => {\n        const item = document.createElement('div');\n        item.className = 'stock-item';\n        \n        const isUp = s.change >= 0;\n        const history = s.history || generateHistory(s.price);\n        const min = Math.min(...history);\n        const max = Math.max(...history);\n        const range = max - min || 1;\n        const points = history.map((p, i) => `${i * 5},${30 - ((p - min) / range * 25)}`).join(' ');\n\n        item.innerHTML = `\n            <div class=\"stock-main\">\n                <span class=\"symbol\">${s.symbol}</span>\n                <span class=\"company\">${s.name || s.symbol}</span>\n            </div>\n            <div class=\"sparkline-box\">\n                <svg class=\"sparkline\" viewBox=\"0 0 100 30\">\n                    <polyline fill=\"none\" stroke=\"${isUp ? 'var(--text-success)' : 'var(--text-error)'}\" stroke-width=\"2\" points=\"${points}\" />\n                </svg>\n            </div>\n            <div class=\"stock-price-box\">\n                <div class=\"price\">$${(s.price || 0).toFixed(2)}</div>\n                <div class=\"change ${isUp ? 'up' : 'down'}\">${isUp ? '+' : ''}${s.change.toFixed(2)}%</div>\n            </div>\n            <div class=\"portfolio-controls ${state.showPortfolio ? '' : 'hidden'}\">\n                <input type=\"number\" class=\"qty-input\" value=\"${s.qty || 0}\" min=\"0\" placeholder=\"Qty\">\n                <button class=\"btn-del\">üóëÔ∏è</button>\n            </div>\n        `;\n\n        // Attach events to the new elements\n        const qtyInput = item.querySelector('.qty-input');\n        qtyInput.onchange = (e) => {\n            state.stocks[idx].qty = parseFloat(e.target.value) || 0;\n            saveState(state);\n            updateUI();\n        };\n\n        const delBtn = item.querySelector('.btn-del');\n        delBtn.onclick = () => {\n            state.stocks.splice(idx, 1);\n            saveState(state);\n            updateUI();\n            showToast(s.symbol + ' removed');\n        };\n\n        list.appendChild(item);\n    });\n}\n\nasync function fetchPrices() {\n    // Mock fetching prices\n    state.stocks = state.stocks.map(s => {\n        const change = (Math.random() * 4 - 2);\n        const newPrice = s.price * (1 + change / 100);\n        const history = s.history || generateHistory(s.price);\n        history.shift();\n        history.push(newPrice);\n        return { ...s, price: newPrice, change: change, history: history };\n    });\n    updateUI();\n}\n\nfunction addStock() {\n    const input = root.querySelector('#stock-symbol');\n    const symbol = input.value.toUpperCase().trim();\n    if (!symbol) return;\n    \n    if (state.stocks.some(s => s.symbol === symbol)) {\n        showToast('Already in list');\n        return;\n    }\n\n    const newStock = {\n        symbol: symbol,\n        name: symbol,\n        price: 100 + Math.random() * 400,\n        change: Math.random() * 2 - 1,\n        qty: 0,\n        history: generateHistory(100 + Math.random() * 400)\n    };\n\n    state.stocks.push(newStock);\n    input.value = '';\n    saveState(state);\n    updateUI();\n    showToast(symbol + ' added');\n}\n\nfunction togglePortfolio() {\n    state.showPortfolio = !state.showPortfolio;\n    saveState(state);\n    updateUI();\n}\n\nfunction toggleAutoRefresh() {\n    state.autoRefresh = !state.autoRefresh;\n    if (state.autoRefresh) {\n        startAutoRefresh();\n    } else {\n        stopAutoRefresh();\n    }\n    saveState(state);\n    updateUI();\n}\n\nfunction startAutoRefresh() {\n    stopAutoRefresh();\n    refreshInterval = setInterval(fetchPrices, 5000);\n}\n\nfunction stopAutoRefresh() {\n    if (refreshInterval) clearInterval(refreshInterval);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved && saved.stocks) {\n        state = saved;\n    } else {\n        // Default stocks\n        state.stocks = [\n            { symbol: 'AAPL', name: 'Apple Inc.', price: 185.92, change: 1.2, qty: 5, history: generateHistory(185) },\n            { symbol: 'TSLA', name: 'Tesla, Inc.', price: 238.45, change: -2.4, qty: 10, history: generateHistory(238) },\n            { symbol: 'BTC', name: 'Bitcoin', price: 42500, change: 0.5, qty: 0.1, history: generateHistory(42500) }\n        ];\n    }\n\n    // Attach static events\n    root.getElementById('btn-add').onclick = addStock;\n    root.getElementById('btn-refresh').onclick = fetchPrices;\n    root.getElementById('btn-portfolio-toggle').onclick = togglePortfolio;\n    root.getElementById('btn-auto-refresh').onclick = toggleAutoRefresh;\n    root.getElementById('stock-symbol').onkeypress = (e) => { if(e.key === 'Enter') addStock(); };\n\n    if (state.autoRefresh) startAutoRefresh();\n    \n    updateUI();\n}\n\ninit();"
}