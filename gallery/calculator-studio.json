{
  "id": "calculator-studio",
  "name": "Calculator Studio",
  "description": "A powerful calculator with history and advanced functions.",
  "author": "Infinition",
  "authorUrl": "https://github.com/infinition",
  "html": "<div class=\"widget-card\">\n  <div class=\"calc-header\">\n    <h4 class=\"widget-title\">ðŸ§® Calculator Studio Pro</h4>\n    <div class=\"header-actions\">\n      <button id=\"btn-history-toggle\" class=\"btn-icon-small\" title=\"Toggle History\">ðŸ“œ</button>\n      <button id=\"btn-copy\" class=\"btn-icon-small\" title=\"Copy Result\">ðŸ“‹</button>\n    </div>\n  </div>\n\n  <div class=\"display-container\">\n    <div id=\"calc-expression\" class=\"expression-display\"></div>\n    <div id=\"calc-display\" class=\"main-display\">0</div>\n  </div>\n\n  <div class=\"calc-layout\">\n    <div id=\"history-panel\" class=\"history-panel\">\n      <div class=\"history-header\">\n        <span>History</span>\n        <button id=\"btn-clear-history\" class=\"btn-text\">Clear</button>\n      </div>\n      <div id=\"history-list\" class=\"history-list\"></div>\n    </div>\n\n    <div class=\"calc-main\">\n      <div class=\"calc-grid\">\n        <!-- Scientific Row 1 -->\n        <button class=\"btn-sci\" data-val=\"Math.sqrt(\">âˆš</button>\n        <button class=\"btn-sci\" data-val=\"Math.pow(\">xÊ¸</button>\n        <button class=\"btn-sci\" data-val=\"Math.PI\">Ï€</button>\n        <button class=\"btn-sci\" data-val=\"Math.E\">e</button>\n\n        <!-- Row 1 -->\n        <button class=\"btn-op btn-clear\" id=\"btn-clear\">AC</button>\n        <button class=\"btn-op\" id=\"btn-back\">âŒ«</button>\n        <button class=\"btn-op\" data-val=\"%\">%</button>\n        <button class=\"btn-op highlight\" data-val=\"/\">Ã·</button>\n\n        <!-- Row 2 -->\n        <button class=\"btn-num\" data-val=\"7\">7</button>\n        <button class=\"btn-num\" data-val=\"8\">8</button>\n        <button class=\"btn-num\" data-val=\"9\">9</button>\n        <button class=\"btn-op highlight\" data-val=\"*\">Ã—</button>\n\n        <!-- Row 3 -->\n        <button class=\"btn-num\" data-val=\"4\">4</button>\n        <button class=\"btn-num\" data-val=\"5\">5</button>\n        <button class=\"btn-num\" data-val=\"6\">6</button>\n        <button class=\"btn-op highlight\" data-val=\"-\">âˆ’</button>\n\n        <!-- Row 4 -->\n        <button class=\"btn-num\" data-val=\"1\">1</button>\n        <button class=\"btn-num\" data-val=\"2\">2</button>\n        <button class=\"btn-num\" data-val=\"3\">3</button>\n        <button class=\"btn-op highlight\" data-val=\"+\">+</button>\n\n        <!-- Row 5 -->\n        <button class=\"btn-num btn-zero\" data-val=\"0\">0</button>\n        <button class=\"btn-num\" data-val=\".\">.</button>\n        <button class=\"btn-eq\" id=\"btn-eq\">=</button>\n      </div>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
  "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); color: var(--text-normal); border-radius: 24px; padding: 1.25rem; box-shadow: var(--shadow-s); border: 1px solid var(--background-modifier-border); max-width: 340px; margin: 0 auto; position: relative; overflow: hidden; } .calc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; } .widget-title { margin: 0; font-size: 0.85rem; font-weight: 800; color: var(--text-accent); text-transform: uppercase; letter-spacing: 1px; } .header-actions { display: flex; gap: 8px; } .btn-icon-small { background: var(--background-primary); border: 1px solid var(--background-modifier-border); color: var(--text-muted); width: 32px; height: 32px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; } .btn-icon-small:hover { background: var(--background-modifier-hover); color: var(--text-normal); } .display-container { background: var(--background-primary-alt); border-radius: 16px; padding: 1rem; margin-bottom: 1.25rem; border: 1px solid var(--background-modifier-border); text-align: right; min-height: 100px; display: flex; flex-direction: column; justify-content: flex-end; } .expression-display { color: var(--text-faint); font-size: 0.9rem; font-family: var(--font-monospace); min-height: 1.2rem; margin-bottom: 0.25rem; word-break: break-all; } .main-display { color: var(--interactive-accent); font-size: 2.2rem; font-weight: 700; font-family: var(--font-monospace); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; } .calc-layout { display: flex; flex-direction: column; gap: 1rem; } .history-panel { display: none; background: var(--background-primary); border-radius: 16px; padding: 1rem; max-height: 200px; overflow-y: auto; border: 1px solid var(--background-modifier-border); } .history-panel.active { display: block; } .history-header { display: flex; justify-content: space-between; align-items: center; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); margin-bottom: 0.75rem; text-transform: uppercase; } .btn-text { background: none; border: none; color: var(--text-error); font-size: 0.7rem; cursor: pointer; padding: 2px 6px; } .btn-text:hover { text-decoration: underline; } .history-list { display: flex; flex-direction: column; gap: 8px; } .history-item { padding: 8px; background: var(--background-secondary-alt); border-radius: 8px; font-size: 0.8rem; cursor: pointer; transition: background 0.2s; border: 1px solid var(--background-modifier-border); } .history-item:hover { background: var(--background-modifier-hover); } .history-item .h-expr { color: var(--text-muted); display: block; font-size: 0.7rem; } .history-item .h-res { color: var(--interactive-accent); font-weight: 700; } .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; } .calc-grid button { border: none; padding: 16px 0; font-size: 1.1rem; font-weight: 700; border-radius: 14px; cursor: pointer; transition: all 0.2s; background: var(--background-primary); color: var(--text-normal); border: 1px solid var(--background-modifier-border); } .calc-grid button:hover { background: var(--background-modifier-hover); transform: translateY(-2px); } .calc-grid button:active { transform: scale(0.95); } .btn-op { background: var(--background-secondary-alt); color: var(--text-accent); } .btn-op.highlight { background: var(--interactive-accent); color: var(--text-on-accent); border: none; } .btn-op.highlight:hover { opacity: 0.9; } .btn-sci { background: var(--background-secondary-alt) !important; color: var(--text-muted) !important; font-size: 0.9rem !important; } .btn-sci:hover { color: var(--text-accent) !important; border-color: var(--interactive-accent) !important; } .btn-clear { color: var(--text-error) !important; } .btn-eq { background: var(--interactive-accent) !important; color: var(--text-on-accent) !important; grid-column: span 2; border: none !important; } .btn-eq:hover { opacity: 0.9; } .btn-zero { grid-column: span 1; } .toast-msg { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--interactive-accent); color: var(--text-on-accent); padding: 6px 16px; border-radius: 100px; font-size: 0.75rem; font-weight: 800; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 100; }",
  "js": "const { root, saveState, getState } = api;\n\nlet state = {\n    current: '0',\n    expression: '',\n    history: [],\n    showHistory: false\n};\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (!toast) return;\n    toast.innerText = msg;\n    toast.style.opacity = '1';\n    setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n}\n\nfunction updateDisplay() {\n    root.querySelector('#calc-display').innerText = state.current;\n    root.querySelector('#calc-expression').innerText = state.expression;\n    \n    const historyPanel = root.querySelector('#history-panel');\n    if (state.showHistory) historyPanel.classList.add('active');\n    else historyPanel.classList.remove('active');\n    \n    renderHistory();\n}\n\nfunction renderHistory() {\n    const list = root.querySelector('#history-list');\n    if (!list) return;\n    list.innerHTML = '';\n    \n    state.history.slice().reverse().forEach((item, idx) => {\n        const div = document.createElement('div');\n        div.className = 'history-item';\n        div.innerHTML = `\n            <span class=\"h-expr\">${item.expr} =</span>\n            <span class=\"h-res\">${item.res}</span>\n        `;\n        div.onclick = () => {\n            state.current = item.res;\n            state.expression = '';\n            updateDisplay();\n        };\n        list.appendChild(div);\n    });\n}\n\nfunction handleInput(val) {\n    if (state.current === 'Error') clearAll();\n    \n    if (val === 'AC') {\n        clearAll();\n    } else if (val === 'âŒ«') {\n        if (state.current.length > 1) state.current = state.current.slice(0, -1);\n        else state.current = '0';\n    } else if (val === '=') {\n        calculate();\n    } else if (['+', '-', '*', '/', '%'].includes(val)) {\n        if (state.current !== '0' || state.expression !== '') {\n            state.expression += state.current + ' ' + val + ' ';\n            state.current = '0';\n        }\n    } else if (val.startsWith('Math.')) {\n        // Scientific functions\n        state.current = val + state.current + ')';\n        calculate();\n    } else {\n        // Numbers and dot\n        if (state.current === '0' && val !== '.') state.current = val;\n        else if (val === '.' && state.current.includes('.')) return;\n        else state.current += val;\n    }\n    \n    updateDisplay();\n    saveState(state);\n}\n\nfunction clearAll() {\n    state.current = '0';\n    state.expression = '';\n    updateDisplay();\n    saveState(state);\n}\n\nfunction calculate() {\n    try {\n        let fullExpr = state.expression + state.current;\n        // Basic sanitization and evaluation\n        // Replace visual operators with JS ones if needed (already done in data-val)\n        let result = eval(fullExpr);\n        \n        // Format result\n        let formattedResult = Number.isInteger(result) ? result.toString() : result.toFixed(8).replace(/\\.0+$|(\\.[0-9]*[1-9])0+$/, '$1');\n        \n        // Add to history\n        state.history.push({ expr: fullExpr, res: formattedResult });\n        if (state.history.length > 20) state.history.shift();\n        \n        state.current = formattedResult;\n        state.expression = '';\n        \n        showToast('Calculated! âœ¨');\n    } catch (e) {\n        state.current = 'Error';\n    }\n    updateDisplay();\n    saveState(state);\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) state = Object.assign(state, saved);\n    \n    // Attach listeners\n    root.querySelectorAll('button[data-val]').forEach(btn => {\n        btn.onclick = () => handleInput(btn.dataset.val);\n    });\n    \n    root.querySelector('#btn-clear').onclick = () => handleInput('AC');\n    root.querySelector('#btn-back').onclick = () => handleInput('âŒ«');\n    root.querySelector('#btn-eq').onclick = () => handleInput('=');\n    \n    root.querySelector('#btn-history-toggle').onclick = () => {\n        state.showHistory = !state.showHistory;\n        updateDisplay();\n        saveState(state);\n    };\n    \n    root.querySelector('#btn-clear-history').onclick = () => {\n        state.history = [];\n        renderHistory();\n        saveState(state);\n    };\n    \n    root.querySelector('#btn-copy').onclick = () => {\n        navigator.clipboard.writeText(state.current);\n        showToast('Copied to clipboard! ðŸ“‹');\n    };\n\n    // Keyboard support\n    window.addEventListener('keydown', (e) => {\n        if (e.key >= '0' && e.key <= '9') handleInput(e.key);\n        if (e.key === '.') handleInput('.');\n        if (e.key === '+') handleInput('+');\n        if (e.key === '-') handleInput('-');\n        if (e.key === '*') handleInput('*');\n        if (e.key === '/') handleInput('/');\n        if (e.key === 'Enter' || e.key === '=') handleInput('=');\n        if (e.key === 'Backspace') handleInput('âŒ«');\n        if (e.key === 'Escape') handleInput('AC');\n    });\n    \n    updateDisplay();\n}\n\ninit();",
  "tags": [
    "calculator",
    "mathematics",
    "tools",
    "pro"
  ]
}