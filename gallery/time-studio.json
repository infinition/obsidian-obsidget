{
  "id": "time-studio",
  "name": "Time Studio Pro",
  "description": "Visualize the progress of the day, week, month, and year.",
  "author": "Infinition",
  "authorUrl": "https://github.com/infinition",
  "html": "<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <div class=\"header-left\">\n      <h4 class=\"widget-title\">‚è≥ Time Studio</h4>\n    </div>\n    <div class=\"header-right\">\n      <button id=\"btn-pip\" class=\"icon-btn\" title=\"Picture in Picture\">üì∫</button>\n      <div class=\"time-group\">\n        <span id=\"current-time\">--:--</span>\n        <span class=\"sep\">|</span>\n        <span id=\"header-date\">--</span>\n      </div>\n      <button id=\"btn-settings\" class=\"icon-btn\" title=\"Settings\">‚öôÔ∏è</button>\n    </div>\n  </div>\n\n  <div id=\"settings-panel\" class=\"settings-overlay hidden\">\n    <div class=\"settings-content\">\n      <h5>Widget Settings</h5>\n      \n      <div class=\"setting-row\">\n        <label>Format</label>\n        <select id=\"set-fmt\">\n          <option value=\"12\">12h (US Date)</option>\n          <option value=\"24\">24h (EU Date)</option>\n        </select>\n      </div>\n\n      <div class=\"setting-row\">\n        <label>PiP Content</label>\n        <select id=\"set-pip-source\">\n          <option value=\"work\">Work Progress</option>\n          <option value=\"day\">Day Progress</option>\n          <option value=\"week\">Week Progress</option>\n          <option value=\"month\">Month Progress</option>\n          <option value=\"year\">Year Progress</option>\n          <option value=\"clock\">Clock Only</option>\n        </select>\n      </div>\n\n      <div class=\"setting-row\">\n        <label>Show Work Bar</label>\n        <div class=\"toggle-container\">\n             <input type=\"checkbox\" id=\"set-show-work\">\n        </div>\n      </div>\n\n      <div class=\"setting-row\">\n        <label>Start</label>\n        <input type=\"time\" id=\"set-start\">\n      </div>\n      \n      <div class=\"setting-row\">\n        <label>End</label>\n        <input type=\"time\" id=\"set-end\">\n      </div>\n\n      <div class=\"settings-actions\">\n        <button id=\"btn-cancel\" class=\"btn-sec\">Cancel</button>\n        <button id=\"btn-save\" class=\"btn-pri\">Save</button>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"progress-grid\">\n    <div class=\"progress-item\" id=\"work-container\" data-type=\"work\">\n      <div class=\"item-header\">\n        <span class=\"label\">üíº Work Day</span>\n        <span class=\"value\" id=\"work-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"work-bar\" class=\"bar-fill work-gradient\"></div>\n        <div class=\"bar-glow work-glow\"></div>\n      </div>\n      <div class=\"sub-label\" id=\"work-range\">--:-- - --:--</div>\n    </div>\n\n    <div class=\"progress-item\">\n      <div class=\"item-header\">\n        <span class=\"label\">Day</span>\n        <span class=\"value\" id=\"day-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"day-bar\" class=\"bar-fill day-gradient\"></div>\n      </div>\n    </div>\n\n    <div class=\"progress-item\">\n      <div class=\"item-header\">\n        <span class=\"label\">Week</span>\n        <span class=\"value\" id=\"week-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"week-bar\" class=\"bar-fill week-gradient\"></div>\n      </div>\n    </div>\n\n    <div class=\"progress-item\">\n      <div class=\"item-header\">\n        <span class=\"label\">Month</span>\n        <span class=\"value\" id=\"month-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"month-bar\" class=\"bar-fill month-gradient\"></div>\n      </div>\n    </div>\n    \n    <div class=\"progress-item\">\n      <div class=\"item-header\">\n        <span class=\"label\">Year</span>\n        <span class=\"value\" id=\"year-val\">0%</span>\n      </div>\n      <div class=\"bar-container\">\n        <div id=\"year-bar\" class=\"bar-fill year-gradient\"></div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"footer-info\">\n    <div id=\"date-display\" class=\"date-display\">Loading...</div>\n  </div>\n\n  <div class=\"pip-active-area\">\n    <canvas id=\"pip-canvas\" width=\"300\" height=\"150\"></canvas>\n    <video id=\"pip-video\" autoplay muted loop playsinline></video>\n    <audio id=\"silent-audio\" loop>\n      <source src=\"data:audio/wav;base64,UklGRigAAABXQVZFRm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==\" type=\"audio/wav\">\n    </audio>\n  </div>\n</div>",
  "css": ":host { display: block; margin: 1rem 0; font-family: var(--font-interface); } * { box-sizing: border-box; } .widget-card { background: var(--background-secondary); border: 1px solid var(--background-modifier-border); border-radius: 16px; padding: 1.5rem; box-shadow: var(--shadow-s); max-width: 360px; margin: 0 auto; position: relative; overflow: hidden; } .widget-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; } .header-right { display: flex; align-items: center; gap: 8px; } .widget-title { margin: 0; font-size: 0.85rem; font-weight: 800; color: var(--text-accent); text-transform: uppercase; letter-spacing: 1px; } .time-group { font-family: var(--font-monospace); font-size: 0.8rem; font-weight: 700; color: var(--text-normal); background: var(--background-primary-alt); padding: 4px 10px; border-radius: 6px; border: 1px solid var(--background-modifier-border); display: flex; align-items: center; gap: 8px; } .sep { color: var(--text-faint); font-weight: 400; font-size: 0.7rem; } #header-date { color: var(--text-muted); font-size: 0.75rem; } .icon-btn { background: transparent; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; border-radius: 4px; font-size: 1rem; line-height: 1; } .icon-btn:hover { color: var(--text-normal); background: var(--background-modifier-hover); } .settings-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 10; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; } .settings-overlay:not(.hidden) { opacity: 1; pointer-events: all; } .settings-content { background: var(--background-primary); padding: 1.5rem; border-radius: 12px; width: 90%; border: 1px solid var(--background-modifier-border); } .settings-content h5 { margin: 0 0 1rem 0; text-align: center; } .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; font-size: 0.9rem; } .setting-row input[type=\"time\"], .setting-row select { background: var(--background-secondary); border: 1px solid var(--background-modifier-border); color: var(--text-normal); padding: 4px; border-radius: 4px; } .setting-row input[type=\"checkbox\"] { accent-color: var(--interactive-accent); width: 1.2rem; height: 1.2rem; cursor: pointer; } .settings-actions { display: flex; gap: 10px; margin-top: 1.5rem; } .settings-actions button { flex: 1; padding: 8px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; font-size: 0.8rem; } .btn-sec { background: var(--background-modifier-error); color: white; } .btn-pri { background: var(--interactive-accent); color: var(--text-on-accent); } .progress-grid { display: grid; gap: 1rem; } .progress-item { display: flex; flex-direction: column; gap: 6px; } .item-header { display: flex; justify-content: space-between; align-items: flex-end; } .label { font-size: 0.7rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; } .sub-label { font-size: 0.65rem; color: var(--text-faint); margin-top: 2px; text-align: right; } .value { font-size: 0.8rem; font-weight: 800; font-family: var(--font-monospace); color: var(--text-normal); } .bar-container { height: 8px; background: var(--background-primary); border-radius: 100px; position: relative; overflow: hidden; border: 1px solid var(--background-modifier-border); } .bar-fill { height: 100%; width: 0%; border-radius: 100px; transition: width 0.5s ease; position: relative; z-index: 2; } .bar-glow { position: absolute; top:0; left:0; width:100%; height:100%; filter: blur(6px); opacity: 0.4; z-index: 1; } .day-gradient { background: linear-gradient(90deg, #3b82f6, #60a5fa); } .week-gradient { background: linear-gradient(90deg, #8b5cf6, #a78bfa); } .month-gradient { background: linear-gradient(90deg, #f59e0b, #fbbf24); } .year-gradient { background: linear-gradient(90deg, #10b981, #34d399); } .work-gradient { background: linear-gradient(90deg, #ec4899, #f472b6); } .work-glow { background: #ec4899; } .footer-info { margin-top: 1.5rem; padding-top: 0.75rem; border-top: 1px solid var(--background-modifier-border); text-align: center; } .date-display { font-size: 0.75rem; font-weight: 600; color: var(--text-muted); } .pip-active-area { position: fixed; top: -10000px; left: -10000px; width: 300px; height: 150px; opacity: 1; visibility: visible; pointer-events: none; } .error-shake { animation: shake 0.5s; background: rgba(255, 0, 0, 0.2); } @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }",
  "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\nvar config = {\n  start: '09:00',\n  end: '17:40',\n  fmt: '12',\n  showWork: true,\n  pipSource: 'work'\n};\n\nvar pipCanvas, pipVideo, silentAudio;\n\nvar COLORS = {\n  work: '#ec4899', day: '#3b82f6', week: '#8b5cf6', \n  month: '#f59e0b', year: '#10b981', clock: '#ffffff'\n};\n\nfunction formatTime(t) {\n  if (config.fmt === '24') return t;\n  var parts = t.split(':');\n  var h = parseInt(parts[0]);\n  var m = parts[1];\n  var ampm = h >= 12 ? 'PM' : 'AM';\n  h = h % 12;\n  h = h ? h : 12;\n  return h + ':' + m + ' ' + ampm;\n}\n\nasync function togglePiP() {\n    var btn = root.getElementById('btn-pip');\n    if (document.pictureInPictureElement) {\n        try { await document.exitPictureInPicture(); } catch(e) {}\n    } else {\n        try {\n            drawPiP(new Date());\n            if (pipVideo.readyState === 0) await pipVideo.play();\n            await pipVideo.requestPictureInPicture();\n            if(silentAudio) silentAudio.play();\n        } catch(e) {\n             console.error('PiP Failed:', e);\n             if(btn) {\n                 btn.classList.add('error-shake');\n                 setTimeout(function(){ btn.classList.remove('error-shake'); }, 500);\n             }\n        }\n    }\n}\n\nfunction drawPiP(now) {\n    if (!pipCanvas) return;\n    var ctx = pipCanvas.getContext('2d');\n    ctx.fillStyle = '#111';\n    ctx.fillRect(0, 0, 300, 150);\n\n    if (config.pipSource === 'clock') {\n        var is12 = config.fmt === '12';\n        var timeStr = now.toLocaleTimeString([], { hour12: is12, hour: '2-digit', minute:'2-digit', second:'2-digit' });\n        ctx.fillStyle = '#fff';\n        ctx.font = 'bold 50px monospace';\n        ctx.textAlign = 'center';\n        ctx.textBaseline = 'middle';\n        ctx.fillText(timeStr, 150, 75);\n        return;\n    }\n\n    var pct = 0; \n    if (config.pipSource === 'work') {\n        var sParts = config.start.split(':');\n        var eParts = config.end.split(':');\n        var sDate = new Date(now); sDate.setHours(parseInt(sParts[0]), parseInt(sParts[1]), 0, 0);\n        var eDate = new Date(now); eDate.setHours(parseInt(eParts[0]), parseInt(eParts[1]), 0, 0);\n        if (now > eDate) pct = 100;\n        else if (now > sDate) pct = ((now - sDate) / (eDate - sDate)) * 100;\n    } else if (config.pipSource === 'day') {\n        var dStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n        pct = ((now - dStart) / 86400000) * 100;\n    } else if (config.pipSource === 'week') {\n        var d = new Date(now); var day = d.getDay(); var diff = d.getDate() - day + (day === 0 ? -6 : 1);\n        var wStart = new Date(d.setDate(diff)); wStart.setHours(0,0,0,0);\n        pct = ((now - wStart) / (86400000 * 7)) * 100;\n    } else if (config.pipSource === 'month') {\n        var mStart = new Date(now.getFullYear(), now.getMonth(), 1);\n        var mEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);\n        pct = ((now - mStart) / (mEnd - mStart)) * 100;\n    } else if (config.pipSource === 'year') {\n        var yStart = new Date(now.getFullYear(), 0, 1);\n        var yEnd = new Date(now.getFullYear(), 11, 31, 23, 59, 59);\n        pct = ((now - yStart) / (yEnd - yStart)) * 100;\n    }\n\n    pct = Math.max(0, Math.min(100, pct));\n    \n    ctx.fillStyle = '#aaa';\n    ctx.font = 'bold 18px sans-serif';\n    ctx.textAlign = 'left';\n    ctx.fillText(config.pipSource.toUpperCase(), 20, 45);\n    ctx.fillStyle = '#fff';\n    ctx.textAlign = 'right';\n    ctx.fillText(pct.toFixed(1) + '%', 280, 45);\n    ctx.fillStyle = '#333';\n    ctx.fillRect(20, 60, 260, 20);\n    ctx.fillStyle = COLORS[config.pipSource] || '#fff';\n    var w = (pct / 100) * 260;\n    ctx.fillRect(20, 60, w, 20);\n    var tShort = now.toLocaleTimeString([], { hour12: config.fmt==='12', hour: '2-digit', minute:'2-digit' });\n    ctx.fillStyle = '#666';\n    ctx.font = '16px monospace';\n    ctx.textAlign = 'center';\n    ctx.fillText(tShort, 150, 110);\n}\n\nfunction update() {\n  var now = new Date();\n  drawPiP(now);\n\n  var workContainer = root.getElementById('work-container');\n  if (workContainer) workContainer.style.display = config.showWork ? 'flex' : 'none';\n\n  var clockEl = root.getElementById('current-time');\n  if (clockEl) {\n    var is12 = config.fmt === '12';\n    clockEl.innerText = now.toLocaleTimeString([], { hour12: is12, hour: '2-digit', minute: '2-digit', second: '2-digit' });\n  }\n\n  // Header Date Logic\n  var headDate = root.getElementById('header-date');\n  if (headDate) {\n    var locale = config.fmt === '12' ? 'en-US' : 'en-GB';\n    // 12h = Jan 16 | 24h = 16 Jan\n    headDate.innerText = now.toLocaleDateString(locale, { day: 'numeric', month: 'short' });\n  }\n\n  var dateEl = root.getElementById('date-display');\n  if (dateEl) dateEl.innerText = now.toLocaleDateString(undefined, { weekday: 'long', day: 'numeric', month: 'long' });\n\n  var set = function(id, pct, txt) {\n    var bar = root.getElementById(id + '-bar');\n    var text = root.getElementById(id + '-val');\n    var safePct = Math.max(0, Math.min(100, pct));\n    if (bar) bar.style.width = safePct.toFixed(2) + '%';\n    if (text) text.innerText = txt || (safePct.toFixed(1) + '%');\n  };\n\n  if (config.showWork) {\n      var sParts = config.start.split(':');\n      var eParts = config.end.split(':');\n      var sDate = new Date(now); sDate.setHours(parseInt(sParts[0]), parseInt(sParts[1]), 0, 0);\n      var eDate = new Date(now); eDate.setHours(parseInt(eParts[0]), parseInt(eParts[1]), 0, 0);\n      var workPct = 0; var workText = '';\n      if (now < sDate) { workPct = 0; workText = 'Not Started'; }\n      else if (now > eDate) { workPct = 100; workText = 'Done'; }\n      else { workPct = ((now - sDate) / (eDate - sDate)) * 100; }\n      set('work', workPct, (workPct > 0 && workPct < 100) ? null : workText);\n      var rangeEl = root.getElementById('work-range');\n      if(rangeEl) rangeEl.innerText = formatTime(config.start) + ' - ' + formatTime(config.end);\n  }\n\n  var dStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  set('day', ((now - dStart) / 86400000) * 100);\n\n  var d = new Date(now); var day = d.getDay(); var diff = d.getDate() - day + (day === 0 ? -6 : 1);\n  var wStart = new Date(d.setDate(diff)); wStart.setHours(0,0,0,0);\n  set('week', ((now - wStart) / (86400000 * 7)) * 100);\n\n  var mStart = new Date(now.getFullYear(), now.getMonth(), 1);\n  var mEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0, 23, 59, 59);\n  set('month', ((now - mStart) / (mEnd - mStart)) * 100);\n\n  var yStart = new Date(now.getFullYear(), 0, 1);\n  var yEnd = new Date(now.getFullYear(), 11, 31, 23, 59, 59);\n  set('year', ((now - yStart) / (yEnd - yStart)) * 100);\n}\n\nfunction toggleSettings(show) {\n  var el = root.getElementById('settings-panel');\n  if (el) el.classList.toggle('hidden', !show);\n}\n\nfunction loadUI() {\n  var iS = root.getElementById('set-start');\n  var iE = root.getElementById('set-end');\n  var iF = root.getElementById('set-fmt');\n  var iShow = root.getElementById('set-show-work');\n  var iPip = root.getElementById('set-pip-source');\n  \n  if(iS) iS.value = config.start;\n  if(iE) iE.value = config.end;\n  if(iF) iF.value = config.fmt;\n  if(iShow) iShow.checked = config.showWork;\n  if(iPip) iPip.value = config.pipSource;\n}\n\nfunction saveUI() {\n  var iS = root.getElementById('set-start');\n  var iE = root.getElementById('set-end');\n  var iF = root.getElementById('set-fmt');\n  var iShow = root.getElementById('set-show-work');\n  var iPip = root.getElementById('set-pip-source');\n  \n  if(iS) config.start = iS.value;\n  if(iE) config.end = iE.value;\n  if(iF) config.fmt = iF.value;\n  if(iShow) config.showWork = iShow.checked;\n  if(iPip) config.pipSource = iPip.value;\n  \n  saveState(config).then(function() {\n    toggleSettings(false);\n    update();\n  });\n}\n\nasync function init() {\n  pipCanvas = root.getElementById('pip-canvas');\n  pipVideo = root.getElementById('pip-video');\n  silentAudio = root.getElementById('silent-audio');\n\n  var saved = await getState();\n  if (saved) Object.assign(config, saved);\n\n  var btnSet = root.getElementById('btn-settings');\n  var btnCan = root.getElementById('btn-cancel');\n  var btnSav = root.getElementById('btn-save');\n  var btnPip = root.getElementById('btn-pip');\n\n  if(btnSet) btnSet.onclick = function() { loadUI(); toggleSettings(true); };\n  if(btnCan) btnCan.onclick = function() { toggleSettings(false); };\n  if(btnSav) btnSav.onclick = saveUI;\n  if(btnPip) btnPip.onclick = togglePiP;\n\n  if(pipVideo && pipCanvas) {\n     pipVideo.srcObject = pipCanvas.captureStream(10);\n     pipVideo.play().catch(function(e){});\n  }\n\n  update();\n  setInterval(update, 1000);\n}\n\ninit();",
  "tags": [
    "time",
    "progress",
    "work",
    "pip",
    "date"
  ]
}