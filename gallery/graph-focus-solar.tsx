export default {
    "id": "graph-focus-solar",
    "name": "Solar Graph Focus",
    "description": "Visualisation radiale de la note active. Affiche les liens sortants (orbite interne) et les backlinks (orbite externe). Navigation en un clic.",
    "author": "Infinition",
    "defaultSizePx": { "width": 400, "height": 450 },
    "html": "<div class=\"solar-wrapper\" id=\"solar-root\">\n  \n  <svg class=\"orbit-system\" viewBox=\"0 0 400 400\">\n    <circle cx=\"200\" cy=\"200\" r=\"80\" class=\"orbit-ring inner\" />\n    <circle cx=\"200\" cy=\"200\" r=\"140\" class=\"orbit-ring outer\" />\n    \n    <g id=\"lines-layer\"></g>\n  </svg>\n\n  \n  <div id=\"nodes-layer\" class=\"nodes-layer\">\n    \n    <div id=\"sun-node\" class=\"node sun\">\n      <div class=\"node-icon\">\n        <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\"></path><polyline points=\"14 2 14 8 20 8\"></polyline></svg>\n      </div>\n      <span class=\"node-label\" id=\"sun-label\">...</span>\n    </div>\n  </div>\n\n  \n  <div class=\"solar-hud\">\n    <div class=\"hud-item\"><span class=\"dot out\"></span> <span id=\"count-out\">0</span> Sortants</div>\n    <div class=\"hud-item\"><span class=\"dot in\"></span> <span id=\"count-in\">0</span> Entrants</div>\n  </div>\n  \n  <div id=\"empty-msg\" class=\"empty-state\" style=\"display:none\">Aucune note active</div>\n</div>",
    "css": ":host { display: flex; flex-direction: column; width: 100%; height: 100%; min-width: 0; min-height: 0; overflow: hidden; box-sizing: border-box; font-family: var(--font-interface); --solar-bg: var(--background-primary); --solar-sun: var(--interactive-accent); --solar-planet: #4ade80; --solar-moon: #60a5fa; --solar-orbit: var(--background-modifier-border); }\n\n.solar-wrapper { flex: 1; position: relative; width: 100%; height: 100%; background: var(--solar-bg); overflow: hidden; display: flex; align-items: center; justify-content: center; user-select: none; }\n\n/* SVG LAYERS */\n.orbit-system { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100%; height: 100%; pointer-events: none; z-index: 0; }\n.orbit-ring { fill: none; stroke: var(--solar-orbit); stroke-width: 1px; stroke-dasharray: 4 4; opacity: 0.6; }\n.link-line { stroke: var(--background-modifier-border); stroke-width: 1px; opacity: 0.3; transition: opacity 0.3s; }\n\n/* NODES */\n.nodes-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }\n\n.node { position: absolute; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: auto; cursor: pointer; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }\n\n/* SUN (Center) */\n.node.sun { top: 50%; left: 50%; width: 60px; height: 60px; margin-left: -30px; margin-top: -30px; z-index: 10; }\n.node.sun .node-icon { width: 50px; height: 50px; background: var(--solar-sun); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-on-accent); box-shadow: 0 0 20px rgba(var(--interactive-accent-rgb), 0.4); animation: pulseSun 3s infinite alternate; }\n.node.sun .node-label { font-weight: 800; font-size: 0.85rem; margin-top: 6px; max-width: 120px; }\n\n/* PLANETS (Outlinks - Inner Ring) */\n.node.planet { width: 30px; height: 30px; margin-left: -15px; margin-top: -15px; z-index: 5; }\n.node.planet .node-orb { width: 12px; height: 12px; background: var(--text-normal); border-radius: 50%; box-shadow: 0 0 0 4px var(--background-primary); transition: transform 0.2s; }\n.node.planet:hover .node-orb { transform: scale(1.5); background: var(--interactive-accent); }\n.node.planet .node-label { opacity: 0.7; font-size: 0.7rem; transition: opacity 0.2s; }\n.node.planet:hover .node-label { opacity: 1; font-weight: 700; color: var(--text-normal); }\n\n/* MOONS (Backlinks - Outer Ring) */\n.node.moon { width: 30px; height: 30px; margin-left: -15px; margin-top: -15px; z-index: 4; }\n.node.moon .node-orb { width: 10px; height: 10px; background: var(--text-muted); border: 2px solid var(--background-primary); border-radius: 50%; transition: transform 0.2s; }\n.node.moon:hover .node-orb { transform: scale(1.5); background: var(--interactive-accent); border-color: var(--interactive-accent); }\n.node.moon .node-label { opacity: 0.5; font-size: 0.65rem; }\n.node.moon:hover .node-label { opacity: 1; font-weight: 700; color: var(--text-normal); }\n\n/* LABELS shared */\n.node-label { color: var(--text-normal); text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100px; text-shadow: 0 1px 4px var(--background-primary); margin-top: 4px; pointer-events: none; }\n\n/* HUD */\n.solar-hud { position: absolute; bottom: 10px; left: 10px; display: flex; gap: 12px; font-size: 0.7rem; color: var(--text-muted); background: var(--background-primary-alt); padding: 4px 8px; border-radius: 12px; border: 1px solid var(--background-modifier-border); z-index: 20; }\n.hud-item { display: flex; align-items: center; gap: 4px; }\n.dot { width: 6px; height: 6px; border-radius: 50%; }\n.dot.out { background: var(--text-normal); }\n.dot.in { background: var(--text-muted); border: 1px solid var(--text-normal); }\n\n.empty-state { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--text-muted); }\n\n@keyframes pulseSun { 0% { box-shadow: 0 0 15px rgba(var(--interactive-accent-rgb), 0.3); } 100% { box-shadow: 0 0 30px rgba(var(--interactive-accent-rgb), 0.6); } }",
    "js": "var root = api.root;\nvar app = window.app || api.app;\n\n// --- Config ---\nconst RADIUS_INNER = 80;  // Outlinks\nconst RADIUS_OUTER = 140; // Backlinks\nconst MAX_NODES = 12;     // Max nodes per ring to prevent lag/clutter\n\n// --- State ---\nlet currentFile = null;\n\n// --- DOM Elements ---\nfunction qs(sel) { return root.querySelector(sel); }\nconst el = {\n  lines: qs('#lines-layer'),\n  nodes: qs('#nodes-layer'),\n  sunLabel: qs('#sun-label'),\n  countOut: qs('#count-out'),\n  countIn: qs('#count-in'),\n  empty: qs('#empty-msg')\n};\n\n// --- Helpers ---\nfunction truncate(str, len = 15) {\n  if (str.length <= len) return str;\n  return str.substring(0, len) + '...';\n}\n\nfunction clearGraph() {\n  // Keep the Sun, remove everything else\n  const sun = qs('#sun-node');\n  el.nodes.innerHTML = '';\n  el.nodes.appendChild(sun);\n  el.lines.innerHTML = '';\n}\n\nfunction createNode(path, type, index, total) {\n  const file = app.metadataCache.getFirstLinkpathDest(path, \"\");\n  const name = file ? file.basename : path.split('/').pop().replace('.md', '');\n  \n  const node = document.createElement('div');\n  node.className = `node ${type}`;\n  node.title = path;\n  \n  // Visual orb\n  const orb = document.createElement('div');\n  orb.className = 'node-orb';\n  node.appendChild(orb);\n\n  // Label\n  const label = document.createElement('span');\n  label.className = 'node-label';\n  label.textContent = truncate(name);\n  node.appendChild(label);\n\n  // Position Math\n  const radius = type === 'planet' ? RADIUS_INNER : RADIUS_OUTER;\n  // Distribute equally along the circle\n  const angle = (index / total) * 2 * Math.PI - (Math.PI / 2); // Start at top\n  \n  // Center of widget is 50%, 50%. We use margin offsets in CSS, so we calc translation\n  // But wait, using absolute top/left relative to 50% center is easier for JS\n  // Let's assume the container is 400x400 (viewbox logic) mapped to 100%\n  // Actually, simplest is calculating offsets from center (200,200 in SVG space)\n  // We need to map SVG coords to CSS %. \n  // Center is 50%. X offset = cos(a)*r. \n  \n  const x = Math.cos(angle) * radius;\n  const y = Math.sin(angle) * radius;\n\n  node.style.transform = `translate(${x}px, ${y}px)`;\n  node.style.top = '50%';\n  node.style.left = '50%';\n\n  // Interaction\n  node.onclick = () => {\n    app.workspace.openLinkText(path, currentFile ? currentFile.path : '', false);\n  };\n\n  // Draw Connecting Line (SVG)\n  const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n  line.setAttribute('x1', 200);\n  line.setAttribute('y1', 200);\n  line.setAttribute('x2', 200 + x);\n  line.setAttribute('y2', 200 + y);\n  line.setAttribute('class', 'link-line');\n  el.lines.appendChild(line);\n\n  el.nodes.appendChild(node);\n}\n\n// --- Core Logic ---\nfunction renderGraph() {\n  currentFile = app.workspace.getActiveFile();\n  if (!currentFile) {\n    el.empty.style.display = 'block';\n    return;\n  }\n  el.empty.style.display = 'none';\n  \n  // 1. Setup Sun\n  el.sunLabel.textContent = truncate(currentFile.basename, 20);\n  clearGraph();\n\n  // 2. Get Outlinks (Forward links)\n  // resolvedLinks is an object: { [sourcePath]: { [targetPath]: count } }\n  const allLinks = app.metadataCache.resolvedLinks;\n  const outlinksObj = allLinks[currentFile.path] || {};\n  const outlinks = Object.keys(outlinksObj);\n\n  // 3. Get Backlinks (Reverse links)\n  const backlinks = [];\n  for (const sourcePath in allLinks) {\n    if (allLinks[sourcePath][currentFile.path]) {\n      backlinks.push(sourcePath);\n    }\n  }\n\n  // Update HUD\n  el.countOut.textContent = outlinks.length;\n  el.countIn.textContent = backlinks.length;\n\n  // Render Rings (Limit to MAX_NODES to keep it aesthetic)\n  const renderOut = outlinks.slice(0, MAX_NODES);\n  renderOut.forEach((path, i) => createNode(path, 'planet', i, renderOut.length));\n\n  const renderIn = backlinks.slice(0, MAX_NODES);\n  renderIn.forEach((path, i) => createNode(path, 'moon', i, renderIn.length));\n}\n\n// --- Initialization ---\nfunction init() {\n  // Initial render\n  setTimeout(renderGraph, 100); // Wait for metadata cache\n\n  // Listen for file changes (The key to making it \"Alive\")\n  if (app && app.workspace) {\n    app.workspace.on('file-open', () => {\n        // Small delay to ensure active leaf is set\n        setTimeout(renderGraph, 50);\n    });\n    \n    // Also update if metadata changes (e.g. you add a link while typing)\n    app.metadataCache.on('changed', (file) => {\n        if (currentFile && file.path === currentFile.path) {\n            renderGraph();\n        }\n    });\n  }\n  \n  // Center interaction\n  const sun = qs('#sun-node');\n  if(sun) {\n      sun.onclick = () => {\n          // Maybe show stats or reveal file in navigation\n          if(currentFile) app.internalPlugins.getPluginById('file-explorer').instance.revealInFolder(currentFile);\n      };\n  }\n}\n\ninit();",
    "tags": [
      "visualization",
      "graph",
      "navigation",
      "system",
      "space"
    ],
    "lastModifiedDate": 1769807046016,
    "createdDate": 1769807046016
  };