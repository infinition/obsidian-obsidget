export default {
    "id": "vault-tamagotchi-garden",
    "name": "Code Garden",
    "description": "Une plante numérique qui grandit organiquement à mesure que vous travaillez dans votre coffre. Elle s'anime et évolue de manière procédurale.",
    "author": "Infinition",
    "cols": 7,
    "rows": 14,
    "html": "<div class=\"garden-wrapper\" id=\"garden-root\">\n  <div class=\"sky-container\">\n    <div class=\"sun\"></div>\n    <div class=\"cloud cloud-1\"></div>\n    <div class=\"cloud cloud-2\"></div>\n  </div>\n  \n  <div class=\"plant-container\">\n    <svg class=\"living-plant\" viewBox=\"0 0 200 300\" xmlns=\"http://www.w3.org/2000/svg\">\n      \n      <defs>\n        <linearGradient id=\"potGrad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n          <stop offset=\"0%\" style=\"stop-color:#8B4513;stop-opacity:1\" />\n          <stop offset=\"100%\" style=\"stop-color:#A0522D;stop-opacity:1\" />\n        </linearGradient>\n        <linearGradient id=\"stemGrad\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\n          <stop offset=\"0%\" style=\"stop-color:#228B22\" />\n          <stop offset=\"100%\" style=\"stop-color:#32CD32\" />\n        </linearGradient>\n        <filter id=\"glow\" x=\"-50%\" y=\"-50%\" width=\"200%\" height=\"200%\">\n          <feGaussianBlur stdDeviation=\"4\" result=\"coloredBlur\"/>\n          <feMerge>\n            <feMergeNode in=\"coloredBlur\"/>\n            <feMergeNode in=\"SourceGraphic\"/>\n          </feMerge>\n        </filter>\n      </defs>\n\n      \n      <g id=\"pot-group\" transform=\"translate(100, 280)\">\n        <path d=\"M-40,0 L40,0 L30,20 L-30,20 Z\" fill=\"#634236\" />\n        <path d=\"M-35,-10 L35,-10 L40,0 L-40,0 Z\" fill=\"url(#potGrad)\" />\n        <ellipse cx=\"0\" cy=\"-10\" rx=\"35\" ry=\"5\" fill=\"#3E2723\" />\n      </g>\n\n      \n      <g id=\"plant-sway-group\" transform=\"translate(100, 270)\">\n        \n        \n        <path id=\"main-stem\" class=\"stem-path\"\n              d=\"M0,0 C0,-50 -10,-100 5,-150 C20,-200 -5,-230 0,-250\"\n              fill=\"none\" stroke=\"url(#stemGrad)\" stroke-width=\"8\" stroke-linecap=\"round\" />\n\n        \n        <g class=\"leaf-group lvl-1\" transform=\"translate(0, -50)\">\n          <path class=\"leaf left pop-in\" d=\"M0,0 Q-30,-10 -40,-30 Q-10,-30 0,0\" fill=\"#4CAF50\" transform=\"scale(0)\" />\n          <path class=\"leaf right pop-in\" d=\"M0,0 Q30,-20 40,-40 Q10,-40 0,0\" fill=\"#66BB6A\" transform=\"scale(0)\" />\n        </g>\n\n        \n        <g class=\"leaf-group lvl-2\" transform=\"translate(5, -130) rotate(-10)\">\n           <path class=\"leaf left pop-in\" d=\"M0,0 Q-25,-15 -35,-40 Q-5,-35 0,0\" fill=\"#4CAF50\" transform=\"scale(0)\" />\n           <path class=\"leaf right pop-in\" d=\"M0,0 Q25,-25 35,-50 Q5,-45 0,0\" fill=\"#81C784\" transform=\"scale(0)\" />\n        </g>\n\n        \n        <g class=\"leaf-group lvl-3\" transform=\"translate(0, -220) rotate(5)\">\n           <path class=\"leaf left pop-in\" d=\"M0,0 Q-20,-20 -30,-50 Q0,-40 0,0\" fill=\"#66BB6A\" transform=\"scale(0)\" />\n           <path class=\"leaf right pop-in\" d=\"M0,0 Q20,-20 30,-50 Q0,-40 0,0\" fill=\"#A5D6A7\" transform=\"scale(0)\" />\n        </g>\n\n        \n        <g id=\"flower-bud\" class=\"flower-group pop-in\" transform=\"translate(0, -250) scale(0)\">\n           <circle cx=\"0\" cy=\"0\" r=\"15\" fill=\"#FFD54F\" filter=\"url(#glow)\" />\n           <circle cx=\"0\" cy=\"0\" r=\"8\" fill=\"#FFF9C4\" />\n           <path d=\"M0,-15 Q-10,-25 0,-35 Q10,-25 0,-15\" fill=\"#FFA726\" />\n           <path d=\"M0,15 Q-10,25 0,35 Q10,25 0,15\" fill=\"#FFA726\" transform=\"rotate(180)\"/>\n           <path d=\"M-15,0 Q-25,-10 -35,0 Q-25,10 -15,0\" fill=\"#FFA726\" />\n           <path d=\"M15,0 Q25,-10 35,0 Q25,10 15,0\" fill=\"#FFA726\" transform=\"rotate(180)\"/>\n        </g>\n      </g>\n    </svg>\n  </div>\n\n  <div class=\"hud-container\">\n    <div class=\"status-text\">Plant Status: <span id=\"status-label\">Seedling</span></div>\n    <div class=\"xp-bar-wrap\">\n      <div class=\"xp-bar-fill\" id=\"xp-fill\" style=\"width: 0%\"></div>\n      <div class=\"xp-text\" id=\"xp-text\">0 / 100 XP</div>\n    </div>\n    <div class=\"daily-counter\">Modifications today: <span id=\"mod-count\">0</span></div>\n  </div>\n</div>",
    "css": ":host { --garden-bg-h: 200; --garden-bg-s: 60%; --garden-bg-l: 90%; --garden-accent: #4CAF50; --garden-text: #37474F; display: flex; flex-direction: column; width: 100%; height: 100%; min-width: 0; min-height: 0; overflow: hidden; box-sizing: border-box; font-family: var(--font-interface); }\n\n.garden-wrapper { flex: 1; display: flex; flex-direction: column; width: 100%; height: 100%; background: linear-gradient(to bottom, hsl(var(--garden-bg-h), var(--garden-bg-s), var(--garden-bg-l)), #E0F7FA); border-radius: 12px; overflow: hidden; position: relative; box-shadow: var(--shadow-m); }\n\n/* AMBIANCE */\n.sky-container { position: absolute; top: 0; left: 0; width: 100%; height: 100px; pointer-events: none; }\n.sun { position: absolute; top: 20px; right: 20px; width: 40px; height: 40px; background: #FFD54F; border-radius: 50%; box-shadow: 0 0 20px #FFD54F, 0 0 60px #FFF9C4; animation: pulseSun 4s infinite alternate ease-in-out; }\n.cloud { position: absolute; background: #FFFFFF; border-radius: 20px; opacity: 0.8; }\n.cloud-1 { width: 60px; height: 20px; top: 30px; left: -60px; animation: floatCloud 25s linear infinite; }\n.cloud-2 { width: 40px; height: 15px; top: 50px; left: -40px; animation: floatCloud 35s linear infinite 2s; }\n\n/* PLANT VISUALS */\n.plant-container { flex: 1; display: flex; align-items: flex-end; justify-content: center; position: relative; z-index: 1; padding-bottom: 20px; }\n.living-plant { width: 100%; height: 100%; max-height: 350px; pointer-events: none; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.1)); }\n\n/* ANIMATIONS */\n/* Idle sway for the whole plant */\n#plant-sway-group { transform-origin: 100px 270px; animation: gentleSway 6s ease-in-out infinite alternate; }\n\n/* Procedural Growth - Stem */\n.stem-path { transition: stroke-dashoffset 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94); }\n\n/* Procedural Growth - Leaves popping in */\n.pop-in { transform-box: fill-box; transform-origin: center bottom; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Elastic bounce */ }\n.leaf.grown { transform: scale(1) !important; }\n.flower-group.grown { transform: translate(0, -250) scale(1) !important; }\n\n/* Individual leaf sway */\n.leaf-group.lvl-1 { animation: leafSway 4s ease-in-out infinite alternate -1s; }\n.leaf-group.lvl-2 { animation: leafSway 5s ease-in-out infinite alternate -2s; }\n.leaf-group.lvl-3 { animation: leafSway 4.5s ease-in-out infinite alternate -0.5s; }\n\n/* HUD */\n.hud-container { flex-shrink: 0; background: rgba(255,255,255,0.6); backdrop-filter: blur(5px); padding: 12px; border-top: 1px solid rgba(0,0,0,0.05); color: var(--garden-text); }\n.status-text { font-weight: 700; font-size: 0.8rem; margin-bottom: 6px; }\n#status-label { color: var(--garden-accent); text-transform: uppercase; }\n.xp-bar-wrap { width: 100%; height: 14px; background: rgba(0,0,0,0.1); border-radius: 7px; overflow: hidden; position: relative; margin-bottom: 6px; }\n.xp-bar-fill { height: 100%; background: linear-gradient(90deg, var(--garden-accent), #81C784); width: 0%; transition: width 0.5s ease; border-radius: 7px; }\n.xp-text { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; font-weight: 800; color: rgba(0,0,0,0.5); text-shadow: 0 1px 1px rgba(255,255,255,0.5); }\n.daily-counter { font-size: 0.7rem; opacity: 0.8; text-align: right; }\n\n/* Keyframes */\n@keyframes gentleSway { 0% { transform: translate(100px, 270px) rotate(-1deg); } 100% { transform: translate(100px, 270px) rotate(1.5deg); } }\n@keyframes leafSway { 0% { transform: rotate(-2deg); } 100% { transform: rotate(2deg); } }\n@keyframes pulseSun { 0% { transform: scale(1); opacity: 0.9; } 100% { transform: scale(1.1); opacity: 1; } }\n@keyframes floatCloud { 0% { transform: translateX(0); } 100% { transform: translateX(400px); } }\n\n/* Dark mode adjustment */\n@media (prefers-color-scheme: dark) { :host { --garden-bg-h: 220; --garden-bg-s: 40%; --garden-bg-l: 20%; --garden-text: #E0E0E0; } .garden-wrapper { background: linear-gradient(to bottom, #1a237e, #311b92); } .hud-container { background: rgba(0,0,0,0.4); } .sun { background: #FDB813; box-shadow: 0 0 20px #FDB813; } .cloud { background: #455A64; opacity: 0.5; } }",
    "js": "var root = api.root;\nvar app = window.app || api.app;\nvar saveState = api.saveState;\nvar getState = api.getState;\n\n// --- Configuration ---\n// Define XP milestones for growth stages\nconst LEVELS = {\n  SEED: { xp: 0, label: 'Seed', bloomPct: 0 },\n  SPROUT: { xp: 10, label: 'Sprout', bloomPct: 0.2 },\n  SAPLING: { xp: 30, label: 'Sapling', bloomPct: 0.5 },\n  YOUNG: { xp: 60, label: 'Young Plant', bloomPct: 0.8 },\n  BLOOM: { xp: 100, label: 'In Bloom', bloomPct: 1.0 },\n  MAX: 100 // Max XP for the day\n};\n\n// --- State ---\nlet state = {\n  currentXP: 0,\n  modsToday: 0,\n  lastDate: new Date().toDateString()\n};\nlet stemLength = 0;\n\n// --- DOM Elements ---\nfunction qs(sel) { return root.querySelector(sel); }\nconst el = {\n  stem: qs('#main-stem'),\n  leavesL1: qs('.lvl-1').querySelectorAll('.pop-in'),\n  leavesL2: qs('.lvl-2').querySelectorAll('.pop-in'),\n  leavesL3: qs('.lvl-3').querySelectorAll('.pop-in'),\n  flower: qs('#flower-bud'),\n  statusLabel: qs('#status-label'),\n  xpFill: qs('#xp-fill'),\n  xpText: qs('#xp-text'),\n  modCount: qs('#mod-count')\n};\n\n// --- Core Logic ---\n\n// 1. Initialize the procedural stem path\nfunction initStem() {\n  if (!el.stem) return;\n  // Calculate the total length of the bezier path\n  stemLength = el.stem.getTotalLength();\n  // Set up the dash array so the line can be \"hidden\" by offset\n  el.stem.style.strokeDasharray = stemLength;\n  // Initially hide it completely\n  el.stem.style.strokeDashoffset = stemLength;\n  // Force a browser reflow to ensure the starting position is set before animating\n  el.stem.getBoundingClientRect(); \n}\n\n// 2. Determine current level based on XP\nfunction getCurrentStage(xp) {\n  if (xp >= LEVELS.BLOOM.xp) return LEVELS.BLOOM;\n  if (xp >= LEVELS.YOUNG.xp) return LEVELS.YOUNG;\n  if (xp >= LEVELS.SAPLING.xp) return LEVELS.SAPLING;\n  if (xp >= LEVELS.SPROUT.xp) return LEVELS.SPROUT;\n  return LEVELS.SEED;\n}\n\n// 3. Update visuals procedurally based on state\nfunction updatePlantVisuals() {\n  const stage = getCurrentStage(state.currentXP);\n  const xpRatio = Math.min(state.currentXP / LEVELS.MAX, 1);\n\n  // A. Grow Stem (Procedural draw)\n  // Calculate new offset based on bloom percentage. 0 offset means fully drawn.\n  const targetOffset = stemLength * (1 - stage.bloomPct);\n  el.stem.style.strokeDashoffset = targetOffset;\n\n  // B. Pop Leaves (CSS Class based)\n  // Helper to toggle 'grown' class on NodeList\n  const toggleGrown = (elements, shouldGrow) => {\n    elements.forEach(el => {\n        if (shouldGrow) el.classList.add('grown');\n        else el.classList.remove('grown');\n    });\n  };\n\n  toggleGrown(el.leavesL1, state.currentXP >= LEVELS.SPROUT.xp);\n  toggleGrown(el.leavesL2, state.currentXP >= LEVELS.SAPLING.xp);\n  toggleGrown(el.leavesL3, state.currentXP >= LEVELS.YOUNG.xp);\n  toggleGrown([el.flower], state.currentXP >= LEVELS.BLOOM.xp);\n\n  // C. Update HUD\n  el.statusLabel.textContent = stage.label;\n  el.xpFill.style.width = `${xpRatio * 100}%`;\n  el.xpText.textContent = `${state.currentXP} / ${LEVELS.MAX} XP`;\n  el.modCount.textContent = state.modsToday;\n}\n\n// 4. Event Handler for Vault Changes\nfunction onVaultModify() {\n  // Check if it's a new day to reset\n  const today = new Date().toDateString();\n  if (today !== state.lastDate) {\n    state.currentXP = 0;\n    state.modsToday = 0;\n    state.lastDate = today;\n  }\n\n  // Increment XP/Mods (cap at MAX)\n  if (state.currentXP < LEVELS.MAX) {\n      state.currentXP++;\n  }\n  state.modsToday++;\n  \n  saveState(state);\n  updatePlantVisuals();\n}\n\n// --- Init ---\nasync function init() {\n  initStem();\n  \n  // Load saved state\n  const saved = await getState();\n  if (saved) {\n      // Reset if day changed between reloads\n      if(saved.lastDate !== new Date().toDateString()) {\n         state.currentXP = 0;\n         state.modsToday = 0;\n         state.lastDate = new Date().toDateString();\n      } else {\n         state = { ...state, ...saved };\n      }\n  }\n  \n  // Initial render\n  // Small delay to ensure CSS transitions trigger correctly after initStem\n  setTimeout(updatePlantVisuals, 100); \n\n  // Listen to vault modifications\n  if (app && app.vault) {\n    // Using 'on' with a named function allows clean removal later if needed\n    // We bind to 'this' context just in case, though not strictly needed here\n    app.vault.on('modify', onVaultModify.bind(this));\n  }\n}\n\ninit();",
    "tags": [
      "gamification",
      "visualizer",
      "tamagotchi",
      "plant",
      "cozy",
      "tracking"
    ]
  }