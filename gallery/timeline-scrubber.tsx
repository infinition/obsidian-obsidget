export default {
    "id": "timeline-scrubber",
    "name": "Timeline Scrubber",
    "description": "Historique visuel de votre flux de travail. Les fichiers modifiés sont groupés par sessions temporelles.",
    "author": "Infinition",
    "defaultSizePx": { "width": 300, "height": 500 },
    "html": "<div class=\"timeline-wrapper\" id=\"timeline-root\">\n  <div class=\"timeline-header\">\n    <div class=\"header-title\">RECENT ACTIVITY</div>\n    <div class=\"header-subtitle\">Last 7 days</div>\n  </div>\n  <div class=\"timeline-content\" id=\"timeline-list\">\n    \n    <div class=\"loading\">Chargement du flux...</div>\n  </div>\n</div>",
    "css": ":host { --tl-bg: var(--background-primary); --tl-line: var(--background-modifier-border); --tl-accent: var(--interactive-accent); --tl-text: var(--text-normal); --tl-muted: var(--text-muted); display: flex; flex-direction: column; width: 100%; height: 100%; overflow: hidden; font-family: var(--font-interface); }\n\n.timeline-wrapper { flex: 1; display: flex; flex-direction: column; background: var(--tl-bg); }\n\n.timeline-header { flex-shrink: 0; padding: 16px 20px; border-bottom: 1px solid var(--tl-line); background: var(--background-secondary); }\n.header-title { font-weight: 800; font-size: 0.8rem; letter-spacing: 1px; color: var(--tl-text); text-transform: uppercase; }\n.header-subtitle { font-size: 0.7rem; color: var(--tl-muted); margin-top: 2px; }\n\n.timeline-content { flex: 1; overflow-y: auto; padding: 20px 20px 40px 30px; position: relative; }\n/* Vertical Line */\n.timeline-content::before { content: ''; position: absolute; top: 0; bottom: 0; left: 14px; width: 2px; background: var(--tl-line); z-index: 0; }\n\n/* Session Group */\n.session-group { margin-bottom: 24px; position: relative; }\n.session-label { font-size: 0.7rem; font-weight: 700; color: var(--tl-muted); margin-bottom: 8px; margin-left: 24px; text-transform: uppercase; opacity: 0.8; }\n\n/* Items */\n.tl-item { position: relative; display: flex; align-items: center; margin-bottom: 12px; cursor: pointer; padding: 6px 10px; border-radius: 6px; transition: background 0.2s; }\n.tl-item:hover { background: var(--background-modifier-hover); }\n.tl-item:last-child { margin-bottom: 0; }\n\n/* Dot on the line */\n.tl-dot { position: absolute; left: -20px; width: 10px; height: 10px; border-radius: 50%; background: var(--background-secondary); border: 2px solid var(--tl-muted); z-index: 1; transition: all 0.3s; }\n.tl-item:hover .tl-dot { background: var(--tl-accent); border-color: var(--tl-accent); transform: scale(1.2); }\n.tl-item.fresh .tl-dot { border-color: var(--tl-accent); background: var(--tl-accent); box-shadow: 0 0 0 4px rgba(var(--interactive-accent-rgb), 0.2); }\n\n.file-info { display: flex; flex-direction: column; min-width: 0; }\n.file-name { font-size: 0.85rem; font-weight: 600; color: var(--tl-text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\n.file-path { font-size: 0.7rem; color: var(--tl-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\n.file-time { font-size: 0.65rem; color: var(--tl-muted); margin-left: auto; padding-left: 8px; font-variant-numeric: tabular-nums; }\n\n.loading { text-align: center; color: var(--tl-muted); margin-top: 40px; font-style: italic; }",
    "js": "var root = api.root;\nvar app = window.app || api.app;\n\nfunction qs(sel) { return root.querySelector(sel); }\n\nfunction formatTime(date) {\n  return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\n}\n\nfunction formatDate(date) {\n  var today = new Date();\n  if (date.toDateString() === today.toDateString()) return \"Today\";\n  var yesterday = new Date(); yesterday.setDate(today.getDate() - 1);\n  if (date.toDateString() === yesterday.toDateString()) return \"Yesterday\";\n  return date.toLocaleDateString([], { weekday: 'short', month: 'short', day: 'numeric' });\n}\n\nfunction refreshTimeline() {\n  var files = app.vault.getFiles();\n  // Filter last 7 days\n  var now = Date.now();\n  var sevenDaysAgo = now - (7 * 24 * 60 * 60 * 1000);\n  \n  var recent = files.filter(f => f.stat.mtime > sevenDaysAgo);\n  // Sort desc\n  recent.sort((a, b) => b.stat.mtime - a.stat.mtime);\n\n  var container = qs('#timeline-list');\n  container.innerHTML = '';\n\n  if (recent.length === 0) {\n    container.innerHTML = '<div style=\"text-align:center; padding:20px; color:var(--tl-muted)\">Rien à signaler capitaine.</div>';\n    return;\n  }\n\n  var lastTime = null;\n  var currentGroup = null;\n\n  recent.forEach(f => {\n    var mtime = new Date(f.stat.mtime);\n    \n    // Group logic: New group if date changes OR gap > 2 hours\n    var isNewGroup = false;\n    if (!lastTime) isNewGroup = true;\n    else {\n       var diffHours = (lastTime - mtime) / (1000 * 60 * 60);\n       if (mtime.toDateString() !== lastTime.toDateString() || diffHours > 2) isNewGroup = true;\n    }\n\n    if (isNewGroup) {\n      lastTime = mtime;\n      currentGroup = document.createElement('div');\n      currentGroup.className = 'session-group';\n      currentGroup.innerHTML = `<div class=\"session-label\">${formatDate(mtime)} • ${formatTime(mtime)}</div>`;\n      container.appendChild(currentGroup);\n    }\n\n    var item = document.createElement('div');\n    var isFresh = (now - f.stat.mtime) < (30 * 60 * 1000); // 30 mins\n    item.className = 'tl-item' + (isFresh ? ' fresh' : '');\n    item.innerHTML = `\n      <div class=\"tl-dot\"></div>\n      <div class=\"file-info\">\n        <span class=\"file-name\">${f.basename}</span>\n        <span class=\"file-path\">${f.parent.path === '/' ? '' : f.parent.path}</span>\n      </div>\n      <span class=\"file-time\">${formatTime(mtime)}</span>\n    `;\n    item.onclick = () => app.workspace.openLinkText(f.path, '', false);\n    currentGroup.appendChild(item);\n  });\n}\n\nfunction init() {\n  setTimeout(refreshTimeline, 100);\n  // Auto-refresh when file is saved\n  if (app && app.vault) {\n      app.vault.on('modify', () => setTimeout(refreshTimeline, 500));\n  }\n}\n\ninit();",
    "tags": ["history", "timeline", "tracking", "workflow", "git-style"]
  };