{
  "id": "smart-grocery",
  "name": "Smart Grocery",
  "description": "Manage your grocery list with smart suggestions and categories. It learn from your list, the order of the item and suggest items based on your previous purchases.",
  "author": "Infinition",
  "authorUrl": "https://github.com/infinition",
  "html": "<div id=\"widget-anchor\"></div>\n<div class=\"widget-card\">\n  <div class=\"widget-header\">\n    <h3 class=\"widget-title\">ğŸ›’ Smart Grocery</h3>\n    <div class=\"header-actions\">\n      <button id=\"btn-sort\" class=\"btn-icon\" title=\"Sort by Dictionary order\">ğŸª„ Sort</button>\n      <button id=\"btn-clear-all\" class=\"btn-icon\" title=\"Clear all items\">ğŸ—‘ï¸ All</button>\n      <button id=\"btn-clear\" class=\"btn-icon\" title=\"Clear checked items\">ğŸ§¹ Done</button>\n      <button id=\"btn-edit-dict\" class=\"btn-icon\" title=\"Manage dictionary\">âš™ï¸ Dict</button>\n    </div>\n  </div>\n\n  <div class=\"input-container\">\n    <div class=\"input-wrapper\">\n      <input type=\"text\" id=\"item-input\" placeholder=\"Add item...\" autocomplete=\"off\" />\n      <div id=\"autocomplete-list\" class=\"autocomplete-dropdown\"></div>\n    </div>\n    <button id=\"btn-add\" class=\"btn-add\">+</button>\n  </div>\n\n  <div id=\"grocery-list\" class=\"grocery-list\"></div>\n\n  <div class=\"footer\">\n    <div class=\"stats\">\n      <div id=\"item-count\">0 items</div>\n      <button id=\"btn-auto-learn\" class=\"btn-toggle\" title=\"Toggle auto-learning on check\">ğŸ§  Auto: OFF</button>\n    </div>\n    <button id=\"btn-learn\" class=\"btn-icon\" title=\"Save current list order to Dictionary\">Learn this order</button>\n  </div>\n\n  <div id=\"dict-modal\" class=\"modal-overlay\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <h3>Manage Dictionary</h3>\n        <button id=\"btn-close-dict\" class=\"btn-icon\">Ã—</button>\n      </div>\n      <div class=\"dict-tip\">Drag handle to reorder</div>\n      <div id=\"dict-list\" class=\"dict-list\"></div>\n    </div>\n  </div>\n\n  <div id=\"toast-msg\" class=\"toast-msg\"></div>\n</div>",
  "css": ":host { display: block; margin: 1.5rem 0; font-family: var(--font-interface); }\n* { box-sizing: border-box; }\n\n.widget-card {\n    background: var(--background-secondary);\n    color: var(--text-normal);\n    border-radius: 24px;\n    padding: 1.5rem;\n    box-shadow: var(--shadow-s);\n    border: 1px solid var(--background-modifier-border);\n    min-width: 320px;\n    position: relative;\n}\n\n.widget-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 1.5rem;\n}\n.widget-title { margin: 0; font-size: 1.1rem; font-weight: 800; color: #38bdf8; text-transform: uppercase; letter-spacing: 1px; }\n\n.header-actions { display: flex; gap: 6px; }\n.btn-icon {\n    background: #334155; border: none; color: #94a3b8;\n    padding: 6px 10px; border-radius: 8px; font-size: 0.7rem;\n    font-weight: 700; cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-icon:hover { background: #475569; color: white; }\n\n.btn-toggle {\n    background: #334155; border: none; color: #94a3b8;\n    padding: 4px 8px; border-radius: 6px; font-size: 0.65rem;\n    font-weight: 700; cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-toggle.active { background: #0ea5e9; color: white; }\n\n.input-container {\n    display: flex; gap: 10px; margin-bottom: 1.5rem; position: relative;\n}\n\n.input-wrapper { flex: 1; position: relative; }\n\ninput[type=\"text\"] {\n    width: 100%;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    color: var(--text-normal);\n    padding: 12px 16px;\n    border-radius: 12px;\n    font-size: 16px;\n    outline: none;\n}\ninput[type=\"text\"]:focus { border-color: var(--interactive-accent); }\n\n.autocomplete-dropdown {\n    position: absolute;\n    top: 100%; left: 0; right: 0;\n    background: var(--background-primary);\n    border: 1px solid var(--background-modifier-border);\n    border-radius: 12px;\n    margin-top: 4px;\n    max-height: 200px;\n    overflow-y: auto;\n    z-index: 1000;\n    box-shadow: var(--shadow-s);\n    display: none;\n}\n.autocomplete-item {\n    padding: 14px 16px;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255,255,255,0.05);\n}\n.autocomplete-item:hover { background: #334155; color: #38bdf8; }\n\n.btn-add {\n    background: #38bdf8; color: #0f172a; border: none;\n    width: 46px; height: 46px; border-radius: 12px;\n    font-size: 1.5rem; font-weight: 800; cursor: pointer;\n    transition: all 0.2s;\n}\n.btn-add:hover { transform: scale(1.05); background: #7dd3fc; }\n\n.grocery-list {\n    display: flex; flex-direction: column; gap: 10px; margin-bottom: 1.5rem;\n    min-height: 50px;\n}\n\n.list-item {\n    display: flex; align-items: center; gap: 12px;\n    padding: 12px 16px; background: rgba(255,255,255,0.03);\n    border-radius: 14px; border: 1px solid rgba(255,255,255,0.05);\n    transition: transform 0.1s, box-shadow 0.1s;\n    position: relative;\n}\n\n.list-item.dragging {\n    opacity: 0.4;\n    background: rgba(56, 189, 248, 0.1);\n    border: 2px dashed #38bdf8;\n}\n\n.list-item.drag-over {\n    border-top: 2px solid #38bdf8;\n}\n\n.drag-handle {\n    color: #475569;\n    font-size: 1.2rem;\n    cursor: grab;\n    padding: 4px;\n    display: flex;\n    align-items: center;\n}\n.drag-handle:active { cursor: grabbing; }\n\n.checkbox {\n    width: 22px; height: 22px; border: 2px solid #38bdf8;\n    border-radius: 6px; flex-shrink: 0;\n    display: flex; align-items: center; justify-content: center;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n.checkbox.checked { background: #38bdf8; }\n.checkbox.checked::after { content: \"âœ“\"; color: #0f172a; font-size: 14px; font-weight: 900; }\n\n.item-text { flex: 1; font-weight: 600; font-size: 0.95rem; pointer-events: none; }\n.list-item.checked .item-text {\n    text-decoration: line-through;\n    opacity: 0.5;\n}\n\n.btn-del { \n    background: none; border: none; color: #ef4444; \n    cursor: pointer; font-size: 1.2rem; padding: 8px;\n    opacity: 0.6; transition: opacity 0.2s;\n}\n.btn-del:hover { opacity: 1; }\n\n.footer {\n    display: flex; justify-content: space-between; align-items: center;\n    border-top: 1px solid #334155; padding-top: 1.25rem;\n}\n\n.stats { display: flex; align-items: center; gap: 10px; }\n\n.modal-overlay {\n    position: absolute; top: 0; left: 0; right: 0; bottom: 0;\n    background: var(--background-modifier-cover);\n    display: none; align-items: center; justify-content: center;\n    z-index: 2000; border-radius: 24px; backdrop-filter: blur(4px);\n}\n.modal-content {\n    background: var(--background-primary);\n    width: 90%; max-height: 80%;\n    border-radius: 16px; display: flex; flex-direction: column; padding: 1rem;\n    border: 1px solid var(--background-modifier-border);\n}\n\n.modal-header {\n    display: flex; justify-content: space-between; align-items: center;\n    margin-bottom: 0.5rem;\n}\n\n.dict-tip {\n    font-size: 0.65rem; color: var(--text-faint); text-align: center; margin-bottom: 1rem;\n    text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px;\n}\n\n.dict-list {\n    overflow-y: auto;\n    display: flex; flex-direction: column; gap: 8px;\n}\n\n.dict-item {\n    display: flex; justify-content: space-between; align-items: center;\n    padding: 10px 12px; background: rgba(255,255,255,0.03);\n    border-radius: 10px; border: 1px solid rgba(255,255,255,0.05);\n    transition: all 0.2s;\n    position: relative;\n}\n.dict-item:hover { background: rgba(255,255,255,0.06); }\n.dict-item.dragging { opacity: 0.4; border: 2px dashed #38bdf8; }\n.dict-item.drag-over { border-top: 2px solid #38bdf8; }\n\n.dict-item .item-text {\n    flex: 1;\n    font-weight: 600;\n    font-size: 0.9rem;\n    margin-left: 8px;\n}\n\n.dict-actions {\n    display: flex;\n    gap: 4px;\n}\n\n.btn-del-dict {\n    background: none; border: none; \n    cursor: pointer; font-size: 1rem; padding: 4px;\n    opacity: 0.6; transition: opacity 0.2s;\n    color: #ef4444;\n}\n.btn-del-dict:hover { opacity: 1; }\n\n.toast-msg {\n    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);\n    background: #0ea5e9; color: white; padding: 8px 16px; border-radius: 100px;\n    font-size: 0.8rem; font-weight: 700; opacity: 0; transition: opacity 0.3s;\n    pointer-events: none; z-index: 3000;\n}",
  "js": "const { root, saveState, getState } = api;\n\nlet state = { items: [], dictionary: [], isDictOpen: false, autoLearn: false };\nlet draggedItem = null;\nlet draggedElement = null;\nlet draggedDictIdx = null;\nlet draggedDictElement = null;\n\nfunction showToast(msg) {\n    const toast = root.querySelector('#toast-msg');\n    if (!toast) return;\n    toast.innerText = msg; toast.style.opacity = '1';\n    setTimeout(() => { toast.style.opacity = '0'; }, 2000);\n}\n\nfunction render() {\n    const list = root.querySelector('#grocery-list');\n    if (!list) return;\n    list.innerHTML = '';\n    \n    state.items.forEach((item, idx) => {\n        const div = document.createElement('div');\n        div.className = 'list-item' + (item.checked ? ' checked' : '');\n        div.draggable = true;\n        div.dataset.idx = idx;\n        \n        div.innerHTML = `\n            <span class=\"drag-handle\">â˜°</span>\n            <div class=\"checkbox ${item.checked ? 'checked' : ''}\"></div>\n            <span class=\"item-text\">${item.name}</span>\n            <button class=\"btn-del\">ğŸ—‘ï¸</button>\n        `;\n        \n        div.querySelector('.checkbox').onclick = (e) => {\n            e.stopPropagation();\n            toggleItem(idx);\n        };\n        \n        div.querySelector('.btn-del').onclick = (e) => {\n            e.stopPropagation();\n            deleteItem(idx);\n        };\n\n        div.ondragstart = (e) => {\n            draggedItem = item;\n            draggedElement = div;\n            div.classList.add('dragging');\n            e.dataTransfer.effectAllowed = 'move';\n            e.dataTransfer.setData('text/plain', idx);\n        };\n\n        div.ondragend = () => {\n            div.classList.remove('dragging');\n            root.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));\n            draggedItem = null;\n            draggedElement = null;\n        };\n\n        div.ondragover = (e) => {\n            e.preventDefault();\n            if (div !== draggedElement) {\n                div.classList.add('drag-over');\n            }\n        };\n\n        div.ondragleave = () => {\n            div.classList.remove('drag-over');\n        };\n\n        div.ondrop = (e) => {\n            e.preventDefault();\n            const fromIdx = parseInt(e.dataTransfer.getData('text/plain'));\n            const toIdx = idx;\n            \n            if (!isNaN(fromIdx) && fromIdx !== toIdx) {\n                const moved = state.items.splice(fromIdx, 1)[0];\n                state.items.splice(toIdx, 0, moved);\n                saveAndRender();\n            }\n        };\n        \n        list.appendChild(div);\n    });\n    \n    root.querySelector('#item-count').innerText = state.items.length + ' items';\n    \n    const autoBtn = root.querySelector('#btn-auto-learn');\n    if (autoBtn) {\n        autoBtn.innerText = `ğŸ§  Auto: ${state.autoLearn ? 'ON' : 'OFF'}`;\n        autoBtn.className = 'btn-toggle' + (state.autoLearn ? ' active' : '');\n    }\n}\n\nfunction renderDictionary() {\n    const list = root.querySelector('#dict-list');\n    if (!list) return;\n    list.innerHTML = '';\n    \n    state.dictionary.forEach((name, idx) => {\n        const div = document.createElement('div');\n        div.className = 'dict-item';\n        div.draggable = true;\n        div.innerHTML = `\n            <span class=\"drag-handle\">â˜°</span>\n            <span class=\"item-text\">${name}</span>\n            <div class=\"dict-actions\">\n                <button class=\"btn-del-dict\" title=\"Remove\">Ã—</button>\n            </div>\n        `;\n        \n        div.querySelector('.btn-del-dict').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            state.dictionary.splice(idx, 1);\n            saveState(state);\n            renderDictionary();\n        });\n\n        div.ondragstart = (e) => {\n            if (e.target.className !== 'drag-handle' && !e.target.closest('.drag-handle')) {\n                if (e.target.closest('.dict-actions')) {\n                    e.preventDefault();\n                    return;\n                }\n            }\n            draggedDictIdx = idx;\n            draggedDictElement = div;\n            div.classList.add('dragging');\n            e.dataTransfer.effectAllowed = 'move';\n            e.dataTransfer.setData('text/dict', idx);\n        };\n\n        div.ondragend = () => {\n            div.classList.remove('dragging');\n            root.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));\n            draggedDictIdx = null;\n            draggedDictElement = null;\n        };\n\n        div.ondragover = (e) => {\n            e.preventDefault();\n            if (div !== draggedDictElement) {\n                div.classList.add('drag-over');\n            }\n        };\n\n        div.ondragleave = () => {\n            div.classList.remove('drag-over');\n        };\n\n        div.ondrop = (e) => {\n            e.preventDefault();\n            const fromIdx = parseInt(e.dataTransfer.getData('text/dict'));\n            const toIdx = idx;\n            \n            if (!isNaN(fromIdx) && fromIdx !== toIdx) {\n                const moved = state.dictionary.splice(fromIdx, 1)[0];\n                state.dictionary.splice(toIdx, 0, moved);\n                saveState(state);\n                renderDictionary();\n            }\n        };\n        \n        list.appendChild(div);\n    });\n}\n\nasync function addItem() {\n    const input = root.querySelector('#item-input');\n    const name = input.value.trim();\n    if (name) {\n        state.items.push({ name: name, checked: false });\n        if (!state.dictionary.includes(name)) state.dictionary.push(name);\n        input.value = '';\n        root.querySelector('#autocomplete-list').style.display = 'none';\n        saveAndRender();\n        setTimeout(() => input.focus(), 50);\n    }\n}\n\nfunction toggleItem(idx) {\n    const item = state.items[idx];\n    item.checked = !item.checked;\n    \n    if (item.checked && state.autoLearn) {\n        const name = item.name;\n        const dIdx = state.dictionary.indexOf(name);\n        if (dIdx !== -1) {\n            state.dictionary.splice(dIdx, 1);\n            state.dictionary.push(name);\n        }\n    }\n    saveAndRender();\n}\n\nfunction deleteItem(idx) {\n    state.items.splice(idx, 1);\n    saveAndRender();\n}\n\nfunction saveAndRender() {\n    render();\n    saveState(state);\n}\n\nfunction handleInput(e) {\n    const val = e.target.value.trim().toLowerCase();\n    const dropdown = root.querySelector('#autocomplete-list');\n    \n    const availableItems = state.dictionary.filter(item => \n        !state.items.some(i => i.name.toLowerCase() === item.toLowerCase())\n    ).sort((a, b) => a.localeCompare(b));\n    \n    const matches = val \n        ? availableItems.filter(item => item.toLowerCase().includes(val)).slice(0, 10) \n        : availableItems;\n    \n    dropdown.innerHTML = '';\n    if (matches.length > 0) {\n        matches.forEach(m => {\n            const div = document.createElement('div');\n            div.className = 'autocomplete-item';\n            div.innerText = m;\n            div.onclick = (ev) => {\n                ev.stopPropagation();\n                root.querySelector('#item-input').value = m;\n                addItem();\n            };\n            dropdown.appendChild(div);\n        });\n        dropdown.style.display = 'block';\n    } else {\n        dropdown.style.display = 'none';\n    }\n}\n\nasync function init() {\n    const saved = await getState();\n    if (saved) state = Object.assign(state, saved);\n    \n    root.querySelector('#btn-add').onclick = addItem;\n    root.querySelector('#btn-sort').onclick = () => {\n        const order = state.dictionary;\n        if (order.length === 0) return;\n        state.items.sort((a, b) => {\n            const idxA = order.indexOf(a.name);\n            const idxB = order.indexOf(b.name);\n            if (idxA !== -1 && idxB !== -1) return idxA - idxB;\n            if (idxA !== -1) return -1;\n            if (idxB !== -1) return 1;\n            return 0;\n        });\n        saveAndRender();\n        showToast('Sorted by Dict! âœ¨');\n    };\n    \n    root.querySelector('#btn-clear').onclick = () => {\n        state.items = state.items.filter(i => !i.checked);\n        saveAndRender();\n    };\n    \n    root.querySelector('#btn-clear-all').onclick = () => {\n        if (confirm('Clear all?')) {\n            state.items = [];\n            saveAndRender();\n        }\n    };\n    \n    root.querySelector('#btn-learn').onclick = () => {\n        const currentNames = state.items.map(i => i.name);\n        if (currentNames.length === 0) {\n            showToast('List is empty! ğŸ›’');\n            return;\n        }\n        \n        // Filter out current items from dictionary to re-insert them at the end (learned order)\n        let otherItems = state.dictionary.filter(name => !currentNames.includes(name));\n        state.dictionary = [...otherItems, ...currentNames];\n        \n        showToast('Order learned! ğŸ§ ');\n        saveAndRender();\n        if (state.isDictOpen) renderDictionary();\n    };\n\n    root.querySelector('#btn-auto-learn').onclick = () => {\n        state.autoLearn = !state.autoLearn;\n        saveAndRender();\n        showToast(`Auto-Learn: ${state.autoLearn ? 'ON' : 'OFF'} ğŸ§ `);\n    };\n    \n    root.querySelector('#btn-edit-dict').onclick = () => { \n        state.isDictOpen = true;\n        saveState(state);\n        renderDictionary();\n        root.querySelector('#dict-modal').style.display = 'flex'; \n    };\n    root.querySelector('#btn-close-dict').onclick = () => { \n        state.isDictOpen = false;\n        saveState(state);\n        root.querySelector('#dict-modal').style.display = 'none'; \n    };\n\n    const input = root.querySelector('#item-input');\n    input.oninput = handleInput;\n    input.onfocus = handleInput;\n    input.onkeydown = (e) => { if (e.key === 'Enter') addItem(); };\n\n    root.onclick = (e) => {\n        if (!root.querySelector('.input-container').contains(e.target)) {\n            root.querySelector('#autocomplete-list').style.display = 'none';\n        }\n    };\n    \n    render();\n    if (state.isDictOpen) {\n        renderDictionary();\n        root.querySelector('#dict-modal').style.display = 'flex';\n    }\n}\n\ninit();",
  "tags": [
    "grocery",
    "list",
    "organization"
  ]
}