export default {
  "id": "deep-focus-mixer",
  "name": "Deep Focus Studio",
  "description": "Mixeur d'ambiance sonore. Placez rain.mp3, thunder.mp3, coffee.mp3, night.mp3 dans votre vault.",
  "author": "Infinition",
  "defaultSizePx": { "width": 320, "height": 480 },
  "html": "<div class=\"mixer-wrapper\" id=\"mixer-root\">\n  <div class=\"mixer-header\">\n    <div class=\"header-title\">\n      <svg viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\"><path d=\"M12 1a9 9 0 0 0-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3V10a9 9 0 0 0-9-9z\"></path></svg>\n      <span>DEEP FOCUS</span>\n    </div>\n    <div class=\"master-controls\">\n      <button id=\"btn-mute\" class=\"icon-btn\" title=\"Mute All\">\n        <svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\"><polygon points=\"11 5 6 9 2 9 2 15 6 15 11 19 11 5\"></polygon><line x1=\"23\" y1=\"9\" x2=\"17\" y2=\"15\"></line><line x1=\"17\" y1=\"9\" x2=\"23\" y2=\"15\"></line></svg>\n      </button>\n    </div>\n  </div>\n\n  <div class=\"tracks-container\">\n    <div class=\"track\">\n      <div class=\"track-icon\"><svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\"><line x1=\"16\" y1=\"13\" x2=\"16\" y2=\"21\"></line><line x1=\"8\" y1=\"13\" x2=\"8\" y2=\"21\"></line><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"23\"></line><path d=\"M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25\"></path></svg></div>\n      <div class=\"slider-wrapper\">\n        <input type=\"range\" min=\"0\" max=\"100\" value=\"0\" class=\"vol-slider\" data-track=\"rain\">\n        <div class=\"visualizer-bar\"></div>\n      </div>\n    </div>\n\n    <div class=\"track\">\n      <div class=\"track-icon\"><svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\"><path d=\"M13 2L3 14h9l-1 8 10-12h-9l1-8z\"></path></svg></div>\n      <div class=\"slider-wrapper\">\n        <input type=\"range\" min=\"0\" max=\"100\" value=\"0\" class=\"vol-slider\" data-track=\"thunder\">\n        <div class=\"visualizer-bar\"></div>\n      </div>\n    </div>\n\n    <div class=\"track\">\n      <div class=\"track-icon\"><svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\"><path d=\"M18 8h1a4 4 0 0 1 0 8h-1\"></path><path d=\"M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z\"></path><line x1=\"6\" y1=\"1\" x2=\"6\" y2=\"4\"></line><line x1=\"10\" y1=\"1\" x2=\"10\" y2=\"4\"></line><line x1=\"14\" y1=\"1\" x2=\"14\" y2=\"4\"></line></svg></div>\n      <div class=\"slider-wrapper\">\n        <input type=\"range\" min=\"0\" max=\"100\" value=\"0\" class=\"vol-slider\" data-track=\"coffee\">\n        <div class=\"visualizer-bar\"></div>\n      </div>\n    </div>\n\n    <div class=\"track\">\n      <div class=\"track-icon\"><svg viewBox=\"0 0 24 24\" width=\"20\" height=\"20\" stroke=\"currentColor\" fill=\"none\" stroke-width=\"2\"><path d=\"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z\"></path></svg></div>\n      <div class=\"slider-wrapper\">\n        <input type=\"range\" min=\"0\" max=\"100\" value=\"0\" class=\"vol-slider\" data-track=\"night\">\n        <div class=\"visualizer-bar\"></div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"mixer-footer\">\n    <div class=\"now-playing-text\" id=\"status-text\">Silence</div>\n  </div>\n\n  <audio id=\"audio-rain\" loop crossorigin=\"anonymous\"></audio>\n  <audio id=\"audio-thunder\" loop crossorigin=\"anonymous\"></audio>\n  <audio id=\"audio-coffee\" loop crossorigin=\"anonymous\"></audio>\n  <audio id=\"audio-night\" loop crossorigin=\"anonymous\"></audio>\n</div>",
  "css": ":host { --mx-bg: #1a1a1a; --mx-surface: #262626; --mx-accent: #f59e0b; --mx-text: #e5e5e5; --mx-muted: #737373; display: flex; flex-direction: column; width: 100%; height: 100%; overflow: hidden; box-sizing: border-box; font-family: var(--font-interface); }\n.mixer-wrapper { flex: 1; display: flex; flex-direction: column; background: var(--mx-bg); border-radius: 16px; overflow: hidden; border: 1px solid #333; }\n.mixer-header { padding: 16px; display: flex; justify-content: space-between; align-items: center; background: var(--mx-surface); border-bottom: 1px solid #333; }\n.header-title { display: flex; align-items: center; gap: 8px; font-weight: 800; color: var(--mx-accent); font-size: 0.8rem; }\n.icon-btn { background: none; border: none; color: var(--mx-muted); cursor: pointer; }\n.icon-btn.active { color: #ef4444; }\n.tracks-container { flex: 1; display: flex; flex-direction: column; padding: 20px; gap: 24px; justify-content: center; }\n.track { display: flex; align-items: center; gap: 16px; }\n.track-icon { width: 32px; color: var(--mx-muted); }\n.track.active .track-icon { color: var(--mx-accent); }\n.slider-wrapper { flex: 1; position: relative; height: 24px; display: flex; align-items: center; }\ninput[type=range] { -webkit-appearance: none; width: 100%; background: transparent; z-index: 2; cursor: pointer; }\ninput[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; background: #333; border-radius: 3px; }\ninput[type=range]::-webkit-slider-thumb { height: 18px; width: 18px; border-radius: 50%; background: #e5e5e5; -webkit-appearance: none; margin-top: -6px; }\n.visualizer-bar { position: absolute; left: 0; top: 9px; height: 6px; background: var(--mx-accent); border-radius: 3px; width: 0%; pointer-events: none; z-index: 1; transition: width 0.1s; }\n.mixer-footer { padding: 10px; background: var(--mx-surface); text-align: center; font-size: 0.7rem; color: var(--mx-muted); }",
  "js": "var root = api.root;\nvar saveState = api.saveState;\nvar getState = api.getState;\nvar app = window.app || api.app;\n\nvar state = {\n  volumes: { rain: 0, thunder: 0, coffee: 0, night: 0 },\n  muted: false\n};\n\nvar TRACK_NAMES = ['rain','thunder','coffee','night'];\n\nfunction qs(sel) { return root.querySelector(sel); }\n\nfunction getTrackFiles() {\n  if (!app || !app.vault) return {};\n  var files = app.vault.getFiles();\n  var map = {};\n  files.forEach(f => {\n    var base = f.name.replace(/\\.[^/.]+$/, '').toLowerCase().trim();\n    if (TRACK_NAMES.includes(base)) map[base] = f;\n  });\n  return map;\n}\n\nfunction ensureAudioSrc(audio, trackName) {\n  if (!audio || audio.src) return;\n  var map = getTrackFiles();\n  var file = map[trackName];\n  if (file) {\n    audio.src = app.vault.getResourcePath(file);\n    audio.load();\n  }\n}\n\nfunction setVolume(trackName, val) {\n  state.volumes[trackName] = parseInt(val);\n  var audio = qs('#audio-' + trackName);\n  var vis = qs('.vol-slider[data-track=\"' + trackName + '\"]').nextElementSibling;\n  var trackEl = qs('.vol-slider[data-track=\"' + trackName + '\"]').closest('.track');\n  \n  if (audio) {\n    if (val > 0) ensureAudioSrc(audio, trackName);\n    audio.volume = state.muted ? 0 : (val / 100);\n    \n    if (val > 0 && audio.src) {\n      audio.play().catch(e => console.log(\"Attente interaction utilisateur\"));\n    } else if (val == 0) {\n      audio.pause();\n    }\n  }\n\n  if(vis) vis.style.width = val + '%';\n  if(trackEl) trackEl.classList.toggle('active', val > 0);\n  \n  updateStatus();\n  saveState(state);\n}\n\nfunction toggleMute() {\n  state.muted = !state.muted;\n  qs('#btn-mute').classList.toggle('active', state.muted);\n  TRACK_NAMES.forEach(key => {\n    var audio = qs('#audio-' + key);\n    if(audio) audio.volume = state.muted ? 0 : (state.volumes[key] / 100);\n  });\n  updateStatus();\n  saveState(state);\n}\n\nfunction updateStatus() {\n  var active = TRACK_NAMES.filter(k => state.volumes[k] > 0);\n  var txt = qs('#status-text');\n  if(state.muted) txt.textContent = \"Muted\";\n  else if(active.length === 0) txt.textContent = \"Silence\";\n  else txt.textContent = \"Mixing \" + active.length + \" tracks\";\n}\n\nasync function init() {\n  var saved = await getState();\n  if (saved) state = { ...state, ...saved };\n\n  root.querySelectorAll('.vol-slider').forEach(input => {\n    var track = input.dataset.track;\n    input.value = state.volumes[track] || 0;\n    input.oninput = (e) => setVolume(track, e.target.value);\n    // Appliquer l'état visuel sans forcer le play (évite erreur autoplay)\n    var val = state.volumes[track];\n    var vis = input.nextElementSibling;\n    if(vis) vis.style.width = val + '%';\n    input.closest('.track').classList.toggle('active', val > 0);\n  });\n\n  qs('#btn-mute').onclick = toggleMute;\n  if(state.muted) qs('#btn-mute').classList.add('active');\n  updateStatus();\n}\n\ninit();",
  "tags": ["audio", "focus", "ambient"]
}