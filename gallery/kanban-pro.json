{
  "id": "kanban-pro",
  "name": "Kanban Pro",
  "description": "Pro-grade Kanban with deep Obsidian integration. Features 2-way sync (updates note properties/tags on move), smart vault scanning, global duplicate prevention, and drag-and-drop support. Includes native hover previews, real-time [[link]] & #tag suggestions, vertical mode for mobile, and auto-resizing cards. A complete task management studio inside your vault.",
  "author": "Infinition",
  "authorUrl": "https://github.com/infinition",
  "createdDate": 1868819178000,
  "lastModifiedDate": 1868819178000,
  "data": {
    "items": [
      {
        "id": "demo-1",
        "text": "Drag a note or a file from your vault here to add it!",
        "state": "todo"
      },
      {
        "id": "demo-2",
        "text": "Type # to add #tags and filter your tasks.",
        "state": "todo"
      },
      {
        "id": "demo-3",
        "text": "Type [[ to link to other notes in your vault.",
        "state": "in-progress"
      },
      {
        "id": "demo-4",
        "text": "Drag a note outside and wait 1 second to delete",
        "state": "in-progress"
      },
      {
        "id": "demo-5",
        "text": "Click on a Note or Hashtag to open or search.",
        "state": "done"
      },
      {
        "id": "demo-6",
        "text": "Change settings by clicking on the wheel icon.",
        "state": "done"
      }
    ],
    "isVertical": false,
    "autoSync": true
  },
  "html": "<div class=\"kanban-wrapper\" id=\"kanban-root\">\n  <div class=\"kanban-header-main\">\n    <div class=\"kanban-title-group\">\n      <svg viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect><line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"21\"></line><line x1=\"15\" y1=\"3\" x2=\"15\" y2=\"21\"></line></svg>\n      <span>KANBAN PRO</span>\n      <div class=\"kanban-actions-menu\">\n         <button class=\"kanban-icon-btn\" id=\"kanban-settings-btn\" title=\"Settings\">\n           <svg viewBox=\"0 0 24 24\" width=\"14\" height=\"14\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path></svg>\n         </button>\n         <div class=\"kanban-dropdown\" id=\"kanban-dropdown\">\n            <div class=\"kanban-dropdown-item\" id=\"toggle-vertical\">Toggle Vertical Mode</div>\n            <div class=\"kanban-dropdown-item\" id=\"toggle-sync\">2-Way Sync: <span id=\"sync-status\">ON</span></div>\n            <div class=\"kanban-dropdown-divider\"></div>\n            <div class=\"kanban-dropdown-item\" id=\"sync-vault\">Import from Vault (Smart Scan)</div>\n         </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"kanban-board-container\">\n    <div class=\"kanban-board\">\n      <div class=\"kanban-column\" data-state=\"todo\">\n        <div class=\"kanban-column-header\">\n          <span class=\"kanban-column-title\">To Do</span>\n          <span class=\"kanban-column-count\">0</span>\n        </div>\n        <div class=\"kanban-column-items\" data-state=\"todo\"></div>\n        <div class=\"kanban-add-btn\">+</div>\n      </div>\n      <div class=\"kanban-column\" data-state=\"in-progress\">\n        <div class=\"kanban-column-header\">\n          <span class=\"kanban-column-title\">In Progress</span>\n          <span class=\"kanban-column-count\">0</span>\n        </div>\n        <div class=\"kanban-column-items\" data-state=\"in-progress\"></div>\n        <div class=\"kanban-add-btn\">+</div>\n      </div>\n      <div class=\"kanban-column\" data-state=\"done\">\n        <div class=\"kanban-column-header\">\n          <span class=\"kanban-column-title\">Done</span>\n          <span class=\"kanban-column-count\">0</span>\n        </div>\n        <div class=\"kanban-column-items\" data-state=\"done\"></div>\n        <div class=\"kanban-add-btn\">+</div>\n      </div>\n    </div>\n  </div>\n</div>",
  "css": ":host {\n    --kanban-column-bg: var(--background-secondary);\n    --kanban-card-bg: var(--background-primary);\n    --kanban-accent: var(--interactive-accent);\n    --kanban-border: var(--background-modifier-border);\n}\n\n.kanban-wrapper {\n    width: 100%;\n    padding: 10px;\n    font-family: var(--font-interface);\n    position: relative;\n    box-sizing: border-box;\n}\n\n.kanban-header-main {\n    display: flex;\n    align-items: center;\n    margin-bottom: 12px;\n    padding-bottom: 8px;\n    border-bottom: 1px solid var(--kanban-border);\n}\n\n.kanban-title-group {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-weight: 700;\n    font-size: 0.75rem;\n    color: var(--text-muted);\n    letter-spacing: 1px;\n    width: 100%;\n}\n\n.kanban-actions-menu {\n    position: relative;\n    margin-left: 4px;\n}\n\n.kanban-icon-btn {\n    background: none;\n    border: none;\n    color: var(--text-muted);\n    cursor: pointer;\n    padding: 2px;\n    border-radius: 4px;\n    display: flex;\n    align-items: center;\n    transition: all 0.2s;\n    opacity: 0.6;\n}\n\n.kanban-icon-btn:hover {\n    background: var(--background-modifier-hover);\n    color: var(--text-normal);\n    opacity: 1;\n}\n\n.kanban-dropdown {\n    position: absolute;\n    top: 100%;\n    left: 0;\n    background: var(--background-primary);\n    border: 1px solid var(--kanban-border);\n    border-radius: 6px;\n    box-shadow: var(--shadow-l);\n    display: none;\n    z-index: 1000;\n    min-width: 200px;\n    padding: 4px;\n    margin-top: 4px;\n}\n\n.kanban-dropdown.is-open {\n    display: block;\n}\n\n.kanban-dropdown-item {\n    padding: 8px 12px;\n    font-size: 0.8rem;\n    cursor: pointer;\n    border-radius: 4px;\n    color: var(--text-normal);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.kanban-dropdown-item:hover {\n    background: var(--background-modifier-hover);\n    color: var(--kanban-accent);\n}\n\n.kanban-dropdown-divider {\n    height: 1px;\n    background: var(--kanban-border);\n    margin: 4px 0;\n}\n\n#sync-status {\n    font-weight: bold;\n    font-size: 0.7rem;\n    padding: 2px 6px;\n    border-radius: 4px;\n}\n\n#sync-status.on { color: var(--text-success); background: rgba(0, 255, 0, 0.1); }\n#sync-status.off { color: var(--text-error); background: rgba(255, 0, 0, 0.1); }\n\n.kanban-board-container {\n    width: 100%;\n}\n\n.kanban-board {\n    display: grid;\n    grid-template-columns: repeat(3, 1fr);\n    gap: 8px;\n    align-items: flex-start;\n    width: 100%;\n}\n\n.kanban-board.is-vertical {\n    grid-template-columns: 1fr;\n}\n\n.kanban-column {\n    background: var(--kanban-column-bg);\n    border-radius: 8px;\n    display: flex;\n    flex-direction: column;\n    border: 1px solid var(--kanban-border);\n    min-width: 0;\n}\n\n.kanban-column-header {\n    padding: 8px 12px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-weight: 600;\n}\n\n.kanban-column-title {\n    font-size: 0.8rem;\n    color: var(--text-normal);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.kanban-column-count {\n    font-size: 0.65rem;\n    color: var(--text-muted);\n    background: var(--kanban-card-bg);\n    padding: 1px 6px;\n    border-radius: 10px;\n    border: 1px solid var(--kanban-border);\n}\n\n.kanban-column-items {\n    padding: 6px;\n    min-height: 80px;\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n}\n\n.kanban-card {\n    background: var(--kanban-card-bg);\n    border: 1px solid var(--kanban-border);\n    border-radius: 6px;\n    padding: 8px;\n    cursor: grab;\n    font-size: 0.8rem;\n    color: var(--text-normal);\n    box-shadow: var(--shadow-s);\n    transition: all 0.15s ease;\n    position: relative;\n    word-break: break-word;\n}\n\n.kanban-card:hover {\n    border-color: var(--kanban-accent);\n    box-shadow: var(--shadow-m);\n}\n\n.kanban-card.kanban-card-dragging {\n    opacity: 0.4;\n    cursor: grabbing;\n    transform: scale(0.95);\n}\n\n.kanban-card.kanban-card-selected {\n    border-color: var(--kanban-accent);\n    background: var(--background-modifier-hover);\n    box-shadow: 0 0 0 2px var(--kanban-accent);\n}\n\n.kanban-card.kanban-card-done {\n    opacity: 0.6;\n}\n\n.kanban-card.kanban-card-done .kanban-card-text {\n    text-decoration: line-through;\n}\n\n.kanban-add-btn {\n    padding: 6px;\n    text-align: center;\n    color: var(--text-muted);\n    cursor: pointer;\n    font-size: 1.2rem;\n    font-weight: bold;\n    border-top: 1px solid var(--kanban-border);\n    transition: all 0.2s;\n    line-height: 1;\n}\n\n.kanban-add-btn:hover {\n    background: var(--background-modifier-hover);\n    color: var(--kanban-accent);\n}\n\n.kanban-drag-over {\n    background: var(--background-modifier-hover);\n    border-radius: 0 0 8px 8px;\n}\n\n.kanban-drop-indicator {\n    height: 3px;\n    background: var(--kanban-accent);\n    margin: 2px 0;\n    border-radius: 2px;\n}\n\n.kanban-card-delete-zone {\n    border: 2px dashed var(--text-error) !important;\n    background: rgba(255, 0, 0, 0.1) !important;\n    transform: scale(0.9) rotate(2deg) !important;\n}\n\n.kanban-edit-input {\n    width: 100%;\n    background: var(--background-primary);\n    border: 1px solid var(--kanban-accent);\n    color: var(--text-normal);\n    padding: 6px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    font-family: inherit;\n    resize: none;\n    outline: none;\n    min-height: 50px;\n}\n\n.internal-link {\n    color: var(--link-color);\n    cursor: pointer;\n    text-decoration: none;\n    font-weight: 500;\n}\n.internal-link:hover { text-decoration: underline; }\n\n.tag {\n    background-color: var(--tag-background);\n    border: var(--tag-border-width) solid var(--tag-border-color);\n    border-radius: var(--tag-radius);\n    color: var(--tag-color);\n    font-size: var(--tag-size);\n    font-weight: var(--tag-weight);\n    padding: 0 4px;\n    text-decoration: none;\n    cursor: pointer;\n}\n.tag:hover { background-color: var(--tag-background-hover); }",
  "js": "const { root, saveState, getState } = api;\nconst app = window.app || api.app;\n\nclass KanbanSuggest {\n    constructor(app, inputEl) {\n        this.app = app; this.inputEl = inputEl; this.suggestions = []; this.selectedIndex = 0; this.menuEl = null;\n        this.onInput = this.onInput.bind(this); this.onKeyDown = this.onKeyDown.bind(this); this.onClickOutside = this.onClickOutside.bind(this);\n        this.inputEl.addEventListener('input', this.onInput); this.inputEl.addEventListener('keydown', this.onKeyDown);\n        document.addEventListener('mousedown', this.onClickOutside); this.injectGlobalStyles();\n    }\n    injectGlobalStyles() {\n        if (document.getElementById('kanban-suggest-styles')) return;\n        const style = document.createElement('style'); style.id = 'kanban-suggest-styles';\n        style.innerHTML = `.kanban-suggest-menu { position: fixed; background: var(--background-primary); border: 1px solid var(--background-modifier-border); border-radius: 6px; box-shadow: var(--shadow-l); z-index: 10000; min-width: 250px; max-height: 300px; overflow-y: auto; padding: 4px; font-family: var(--font-interface); } .kanban-suggest-item { padding: 8px 12px; font-size: 0.85rem; cursor: pointer; border-radius: 4px; color: var(--text-normal); display: flex; flex-direction: column; gap: 2px; } .kanban-suggest-item-path { font-size: 0.7rem; color: var(--text-muted); } .kanban-suggest-item:hover, .kanban-suggest-item.is-selected { background: var(--background-modifier-hover); color: var(--interactive-accent); }`;\n        document.head.appendChild(style);\n    }\n    onInput() {\n        const cursor = this.inputEl.selectionStart; const text = this.inputEl.value.substring(0, cursor);\n        const tagMatch = text.match(/#([^\\s#\\[\\]]*)$/); if (tagMatch) { this.showSuggestions('tag', tagMatch[1].toLowerCase()); return; }\n        const linkMatch = text.match(/\\[\\[([^\\]]*)$/); if (linkMatch) { this.showSuggestions('link', linkMatch[1].toLowerCase()); return; }\n        this.close();\n    }\n    showSuggestions(type, query) {\n        if (!this.app) return;\n        let items = [];\n        if (type === 'tag') {\n            const tags = new Set(); this.app.vault.getMarkdownFiles().forEach(f => { const cache = this.app.metadataCache.getFileCache(f); if (cache?.tags) cache.tags.forEach(t => tags.add(t.tag)); });\n            items = Array.from(tags).filter(t => t.toLowerCase().includes(query)).map(t => ({ name: t, path: '' }));\n        } else {\n            items = this.app.vault.getMarkdownFiles().filter(f => f.basename.toLowerCase().includes(query) || f.path.toLowerCase().includes(query)).map(f => ({ name: f.basename, path: f.path }));\n        }\n        if (items.length === 0) { this.close(); return; }\n        this.suggestions = items.slice(0, 15); this.selectedIndex = 0; this.renderMenu(type);\n    }\n    renderMenu(type) {\n        if (!this.menuEl) { this.menuEl = document.createElement('div'); this.menuEl.className = 'kanban-suggest-menu'; document.body.appendChild(this.menuEl); }\n        this.menuEl.innerHTML = '';\n        this.suggestions.forEach((item, i) => {\n            const div = document.createElement('div'); div.className = `kanban-suggest-item ${i === this.selectedIndex ? 'is-selected' : ''}`;\n            const nameSpan = document.createElement('span'); nameSpan.innerText = item.name; div.appendChild(nameSpan);\n            if (item.path && item.path !== item.name + '.md') { const pathSpan = document.createElement('span'); pathSpan.className = 'kanban-suggest-item-path'; pathSpan.innerText = item.path; div.appendChild(pathSpan); }\n            div.onmousedown = (e) => { e.preventDefault(); this.selectItem(item, type); }; this.menuEl.appendChild(div);\n        });\n        const rect = this.inputEl.getBoundingClientRect(); const menuHeight = Math.min(this.suggestions.length * 40, 300); const spaceBelow = window.innerHeight - rect.bottom;\n        if (spaceBelow < menuHeight && rect.top > menuHeight) this.menuEl.style.top = `${rect.top - menuHeight - 5}px`; else this.menuEl.style.top = `${rect.bottom + 5}px`;\n        this.menuEl.style.left = `${rect.left}px`; this.menuEl.style.display = 'block';\n    }\n    onKeyDown(e) {\n        if (!this.menuEl || this.menuEl.style.display === 'none') return;\n        if (e.key === 'ArrowDown') { e.preventDefault(); this.selectedIndex = (this.selectedIndex + 1) % this.suggestions.length; this.renderMenu(); }\n        else if (e.key === 'ArrowUp') { e.preventDefault(); this.selectedIndex = (this.selectedIndex - 1 + this.suggestions.length) % this.suggestions.length; this.renderMenu(); }\n        else if (e.key === 'Enter' || e.key === 'Tab') { e.preventDefault(); const textBefore = this.inputEl.value.substring(0, this.inputEl.selectionStart); const type = textBefore.includes('#') && !textBefore.includes('[[') ? 'tag' : 'link'; this.selectItem(this.suggestions[this.selectedIndex], type); }\n        else if (e.key === 'Escape') this.close();\n    }\n    selectItem(item, type) {\n        const cursor = this.inputEl.selectionStart; const text = this.inputEl.value; const before = text.substring(0, cursor); const after = text.substring(cursor);\n        let newBefore = ''; if (type === 'tag') newBefore = before.replace(/#([^\\s#\\[\\]]*)$/, item.name.startsWith('#') ? item.name : '#' + item.name); else newBefore = before.replace(/\\[\\[([^\\]]*)$/, '[[' + item.name + ']]');\n        this.inputEl.value = newBefore + after; this.inputEl.selectionStart = this.inputEl.selectionEnd = newBefore.length; this.close(); this.inputEl.focus();\n    }\n    onClickOutside(e) { if (this.menuEl && !this.menuEl.contains(e.target) && e.target !== this.inputEl) this.close(); }\n    close() { if (this.menuEl) this.menuEl.style.display = 'none'; this.selectedIndex = 0; }\n    destroy() { this.inputEl.removeEventListener('input', this.onInput); this.inputEl.removeEventListener('keydown', this.onKeyDown); document.removeEventListener('mousedown', this.onClickOutside); if (this.menuEl) this.menuEl.remove(); }\n}\n\nlet state = { items: [], isVertical: false, autoSync: true };\nlet draggedItem = null; let draggedElement = null; let deleteDelay = 0.75; let dragOutsideStartTime = null;\nlet selectedIds = new Set();\n\nasync function syncNoteStatus(text, newState) {\n    if (!app || !state.autoSync) return;\n    const match = text.match(/\\[\\[([^\\|\\]]+)(?:\\|([^\\]]+))?\\]\\]/);\n    if (!match) return;\n    const noteName = match[1].trim();\n    const file = app.metadataCache.getFirstLinkpathDest(noteName, \"\");\n    if (!file) return;\n    const statusMap = { 'todo': 'Todo', 'in-progress': 'InProgress', 'done': 'done' };\n    const newStatus = statusMap[newState];\n    const keywords = ['todo', 'inprogress', 'wip', 'done', 'fait', 'termin√©'];\n    try {\n        await app.fileManager.processFrontMatter(file, (fm) => {\n            fm['status'] = newStatus;\n            let tags = fm['tags'] || [];\n            if (typeof tags === 'string') tags = tags.split(' ').map(t => t.replace('#', ''));\n            tags = tags.filter(t => !keywords.includes(t.toLowerCase()));\n            tags.push(newStatus);\n            fm['tags'] = [...new Set(tags)];\n        });\n    } catch (e) { console.error(\"Sync error:\", e); }\n}\n\nfunction updateSelectionUI() {\n    root.querySelectorAll('.kanban-card').forEach(card => {\n        if (selectedIds.has(card.dataset.id)) card.classList.add('kanban-card-selected');\n        else card.classList.remove('kanban-card-selected');\n    });\n}\n\nfunction render() {\n    const board = root.querySelector('.kanban-board'); if (!board) return;\n    if (state.isVertical) board.classList.add('is-vertical'); else board.classList.remove('is-vertical');\n    const syncSpan = root.getElementById('sync-status'); if (syncSpan) { syncSpan.innerText = state.autoSync ? 'ON' : 'OFF'; syncSpan.className = state.autoSync ? 'on' : 'off'; }\n    const columns = ['todo', 'in-progress', 'done'];\n    columns.forEach(colState => {\n        const colItems = state.items.filter(item => item.state === colState);\n        const colEl = board.querySelector(`[data-state=\"${colState}\"]`);\n        const listEl = colEl.querySelector('.kanban-column-items');\n        const countEl = colEl.querySelector('.kanban-column-count');\n        listEl.innerHTML = ''; countEl.innerText = colItems.length;\n        colItems.forEach(item => {\n            const card = document.createElement('div'); card.className = 'kanban-card';\n            if (item.state === 'done') card.classList.add('kanban-card-done');\n            if (selectedIds.has(item.id)) card.classList.add('kanban-card-selected');\n            card.dataset.id = item.id; card.draggable = true;\n\n            // NEW RENDERING LOGIC: Forces simple display name for ALL links\n            let renderedText = item.text.replace(/(!?)\\[\\[([^\\]]+)\\]\\]/g, (match, isEmbed, content) => {\n                const parts = content.split('|');\n                const linkPath = parts[0];\n                const alias = parts[1];\n                // Visual Logic: If alias exists, use it. If not, strip folder path for display.\n                const displayText = alias || linkPath.split('/').pop().replace('.md', '');\n                const icon = isEmbed ? 'üñºÔ∏è ' : '';\n                return `<a class=\"internal-link\" data-href=\"${linkPath}\" href=\"${linkPath}\">${icon}${displayText}</a>`;\n            });\n            \n            // Render tags - Fixed regex to avoid JSON string newline issues\n            renderedText = renderedText.replace(/#([^\\s#\\[\\]]+)/g, '<span class=\"tag\">#$1</span>');\n\n            card.innerHTML = `<div class=\"kanban-card-text\">${renderedText}</div>`;\n\n            let hoverTimer = null;\n            let lastHoverKey = '';\n\n            card.addEventListener('pointerover', (e) => {\n                const linkEl = e.target.closest('a.internal-link');\n                if (!linkEl || !app) return;\n\n                const linkText = linkEl.getAttribute('data-href') || linkEl.getAttribute('href') || '';\n                const sourcePath = app.workspace.getActiveFile()?.path || '';\n                const hoverKey = linkText + '|' + sourcePath;\n\n                if (hoverKey === lastHoverKey) return;\n                lastHoverKey = hoverKey;\n\n                if (hoverTimer) clearTimeout(hoverTimer);\n                hoverTimer = setTimeout(() => {\n                    try {\n                        app.workspace.trigger('hover-link', {\n                            event: e,\n                            source: 'preview',\n                            hoverParent: { hoverPopover: null },\n                            targetEl: linkEl,\n                            linktext: linkText,\n                            sourcePath: sourcePath\n                        });\n                    } catch (err) {\n                        console.error('hover-link trigger error:', err);\n                    }\n                }, 70);\n            });\n\n            card.addEventListener('pointerout', (e) => {\n                if (hoverTimer) { clearTimeout(hoverTimer); hoverTimer = null; }\n            });\n\n            card.addEventListener('mousedown', (e) => {\n                if (e.target.closest('a.internal-link') || e.target.closest('.tag')) return;\n                e.stopPropagation(); // Prevent global click handler from clearing selection\n                \n                if (e.ctrlKey || e.metaKey) {\n                    if (selectedIds.has(item.id)) selectedIds.delete(item.id);\n                    else selectedIds.add(item.id);\n                    updateSelectionUI();\n                } else if (!selectedIds.has(item.id)) {\n                    selectedIds.clear();\n                    selectedIds.add(item.id);\n                    updateSelectionUI();\n                }\n            });\n\n            card.addEventListener('click', (e) => {\n                e.stopPropagation(); // Prevent global click handler\n                const link = e.target.closest('a.internal-link');\n                if (link && app) {\n                    const href = link.getAttribute('data-href') || link.getAttribute('href') || '';\n                    app.workspace.openLinkText(href, '', e.ctrlKey || e.metaKey);\n                    return;\n                }\n                const tag = e.target.closest('.tag');\n                if (tag && app) { const query = 'tag:' + tag.innerText.replace('#', ''); app.internalPlugins.getPluginById('global-search').instance.openGlobalSearch(query); return; }\n            });\n\n            card.addEventListener('dragstart', (e) => handleDragStart(e, item, card));\n            card.addEventListener('dragend', (e) => handleDragEnd(e));\n            card.addEventListener('dblclick', (e) => { e.preventDefault(); startEditing(card, item); });\n            listEl.appendChild(card);\n        });\n        setupDropZone(listEl, colState);\n    });\n    root.querySelectorAll('.kanban-add-btn').forEach(btn => { btn.onclick = () => addNewItem(btn.closest('.kanban-column').dataset.state); });\n}\n\nfunction handleDragStart(e, item, el) {\n    if (e.ctrlKey || e.metaKey) {\n        selectedIds.add(item.id);\n        el.classList.add('kanban-card-selected');\n    } else if (!selectedIds.has(item.id)) {\n        selectedIds.clear();\n        selectedIds.add(item.id);\n        // Don't call render() here as it destroys the dragged element\n        root.querySelectorAll('.kanban-card-selected').forEach(c => c.classList.remove('kanban-card-selected'));\n        el.classList.add('kanban-card-selected');\n    }\n    draggedItem = item;\n    draggedElement = el;\n    dragOutsideStartTime = Date.now();\n    // Apply dragging class to all selected cards to show they are all moving\n    root.querySelectorAll('.kanban-card-selected').forEach(c => c.classList.add('kanban-card-dragging'));\n    \n    if (e.dataTransfer) {\n        e.dataTransfer.effectAllowed = 'move';\n        e.dataTransfer.setData('text/plain', Array.from(selectedIds).join(','));\n    }\n}\n\nfunction handleDragEnd(e) {\n    const isDeleteZone = draggedElement?.classList.contains('kanban-card-delete-zone');\n    \n    // Remove dragging class from all cards\n    root.querySelectorAll('.kanban-card-dragging').forEach(c => c.classList.remove('kanban-card-dragging'));\n    \n    // Safety: don't delete if drag was cancelled (coords 0,0) or if not in delete zone\n    if (e.dataTransfer?.dropEffect === 'none' && draggedItem && isDeleteZone && e.clientX !== 0 && e.clientY !== 0) {\n        deleteItems(Array.from(selectedIds));\n        selectedIds.clear();\n    }\n    draggedItem = null; draggedElement = null; dragOutsideStartTime = null;\n    root.querySelectorAll('.kanban-drag-over').forEach(el => el.classList.remove('kanban-drag-over'));\n    root.querySelectorAll('.kanban-drop-indicator').forEach(el => el.remove());\n    root.querySelectorAll('.kanban-card-delete-zone').forEach(el => el.classList.remove('kanban-card-delete-zone'));\n}\n\nfunction deleteItems(ids) {\n    state.items = state.items.filter(i => !ids.includes(i.id));\n    render();\n    save();\n}\n\nfunction deleteItem(item) { deleteItems([item.id]); }\nfunction setupDropZone(el, colState) {\n    el.addEventListener('dragover', (e) => { e.preventDefault(); dragOutsideStartTime = Date.now(); const isExternal = e.dataTransfer?.types.includes('Files') || e.dataTransfer?.types.includes('text/plain'); if (!draggedItem && !isExternal) return; el.classList.add('kanban-drag-over'); const afterElement = getDragAfterElement(el, e.clientY); let indicator = el.querySelector('.kanban-drop-indicator'); if (!indicator) { indicator = document.createElement('div'); indicator.className = 'kanban-drop-indicator'; } if (afterElement) afterElement.before(indicator); else el.appendChild(indicator); });\n    el.addEventListener('dragleave', (e) => { if (!el.contains(e.relatedTarget)) { el.classList.remove('kanban-drag-over'); el.querySelector('.kanban-drop-indicator')?.remove(); } });\n    el.addEventListener('drop', async (e) => {\n        e.preventDefault(); e.stopPropagation();\n        el.classList.remove('kanban-drag-over'); el.querySelector('.kanban-drop-indicator')?.remove();\n        const afterElement = getDragAfterElement(el, e.clientY); const afterId = afterElement?.dataset.id;\n        if (draggedItem) await moveItems(Array.from(selectedIds), colState, afterId);\n        else {\n            const data = e.dataTransfer?.getData('text/plain');\n            if (data) {\n                const lines = data.split('\\n').map(l => l.trim()).filter(l => l !== '');\n                for (const line of lines) {\n                    let text = line;\n                    if (text.startsWith('obsidian://open?')) {\n                        try {\n                            const url = new URL(text);\n                            const filePath = url.searchParams.get('file');\n                            if (filePath) {\n                                const decodedPath = decodeURIComponent(filePath);\n                                if (app) {\n                                    const fileObj = app.vault.getAbstractFileByPath(decodedPath);\n                                    if (fileObj) {\n                                        text = app.fileManager.generateMarkdownLink(fileObj, '');\n                                    } else {\n                                        text = `[[${decodedPath.replace(/\\.md$/, '')}]]`;\n                                    }\n                                } else {\n                                    text = `[[${decodedPath.replace(/\\.md$/, '')}]]`;\n                                }\n                            }\n                        } catch (err) {}\n                    }\n                    \n                    const normalizedText = text.replace(/\\.md\\]\\]$/, ']]');\n                    const existingItem = state.items.find(i => i.text.replace(/\\.md\\]\\]$/, ']]') === normalizedText);\n                    \n                    if (existingItem) {\n                        await moveItem(existingItem, colState, afterId);\n                    } else {\n                        const newItem = { id: crypto.randomUUID(), text, state: colState };\n                        insertAt(newItem, colState, afterId); await syncNoteStatus(text, colState);\n                    }\n                }\n                render(); save();\n            }\n        }\n    });\n}\nfunction getDragAfterElement(container, y) { const cards = [...container.querySelectorAll('.kanban-card:not(.kanban-card-dragging)')]; return cards.reduce((closest, child) => { const box = child.getBoundingClientRect(); const offset = y - box.top - box.height / 2; if (offset < 0 && offset > closest.offset) return { offset: offset, element: child }; else return closest; }, { offset: Number.NEGATIVE_INFINITY }).element; }\n\nasync function moveItems(ids, newState, afterId) {\n    const itemsToMove = state.items.filter(i => ids.includes(i.id));\n    state.items = state.items.filter(i => !ids.includes(i.id));\n    \n    let targetIdx = afterId ? state.items.findIndex(i => i.id === afterId) : state.items.length;\n    if (targetIdx === -1) targetIdx = state.items.length;\n\n    for (let i = 0; i < itemsToMove.length; i++) {\n        const item = itemsToMove[i];\n        item.state = newState;\n        state.items.splice(targetIdx + i, 0, item);\n        await syncNoteStatus(item.text, newState);\n    }\n\n    render();\n    save();\n}\n\nasync function moveItem(item, newState, afterId) { await moveItems([item.id], newState, afterId); }\nfunction insertAt(item, stateName, afterId) { if (afterId) { const newIdx = state.items.findIndex(i => i.id === afterId); state.items.splice(newIdx, 0, item); } else state.items.push(item); }\nfunction addNewItem(colState) { const id = crypto.randomUUID(); const newItem = { id, text: '', state: colState }; state.items.push(newItem); selectedIds.clear(); selectedIds.add(id); render(); const card = root.querySelector(`[data-id=\"${id}\"]`); startEditing(card, newItem, true); }\nfunction startEditing(card, item, isNew = false) { card.draggable = false; const textEl = card.querySelector('.kanban-card-text'); const textarea = document.createElement('textarea'); textarea.className = 'kanban-edit-input'; textarea.value = item.text; textEl.replaceWith(textarea); const suggest = new KanbanSuggest(app, textarea); textarea.focus(); const resize = () => { textarea.style.height = 'auto'; textarea.style.height = textarea.scrollHeight + 'px'; }; resize(); textarea.addEventListener('input', resize); textarea.addEventListener('drop', (e) => { const data = e.dataTransfer?.getData('text/plain'); if (data && data.startsWith('obsidian://open?')) { e.preventDefault(); try { const url = new URL(data); const filePath = url.searchParams.get('file'); if (filePath) { const decodedPath = decodeURIComponent(filePath); let link = ''; if (app) { const fileObj = app.vault.getAbstractFileByPath(decodedPath); link = fileObj ? app.fileManager.generateMarkdownLink(fileObj, '') : `[[${decodedPath.replace(/\\.md$/, '')}]]`; } else { link = `[[${decodedPath.replace(/\\.md$/, '')}]]`; } const start = textarea.selectionStart; const end = textarea.selectionEnd; textarea.value = textarea.value.substring(0, start) + link + textarea.value.substring(end); textarea.selectionStart = textarea.selectionEnd = start + link.length; resize(); } } catch (err) {} } }); const finish = async () => { const val = textarea.value.trim(); suggest.destroy(); if (val === '') { if (isNew) deleteItem(item); else render(); } else { item.text = val; render(); save(); await syncNoteStatus(val, item.state); } }; textarea.addEventListener('blur', finish); textarea.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); textarea.blur(); } else if (e.key === 'Escape') { textarea.removeEventListener('blur', finish); suggest.destroy(); render(); } }); }\nasync function importFromVault() {\n    if (!app) return; const files = app.vault.getMarkdownFiles(); let added = 0; const todoKeywords = ['todo']; const wipKeywords = ['inprogress', 'wip', 'en cours']; const doneKeywords = ['done', 'fait', 'termin√©'];\n    for (const file of files) {\n        const cache = app.metadataCache.getFileCache(file); const fm = cache?.frontmatter || {}; let targetCol = null;\n        const allValues = Object.entries(fm).flatMap(([key, val]) => { const values = Array.isArray(val) ? val : [val]; return [key, ...values].map(v => String(v).toLowerCase()); });\n        if (allValues.some(v => todoKeywords.includes(v))) targetCol = 'todo'; else if (allValues.some(v => wipKeywords.includes(v))) targetCol = 'in-progress'; else if (allValues.some(v => doneKeywords.includes(v))) targetCol = 'done';\n        if (targetCol) { const link = `[[${file.basename}]]`; if (!state.items.some(item => item.text.includes(link))) { state.items.push({ id: crypto.randomUUID(), text: link, state: targetCol }); added++; } }\n    }\n    if (added > 0) { render(); save(); alert(`Smart Import: Added ${added} new notes.`); } else alert(\"No new notes found.\");\n}\nfunction save() { saveState(state); }\nasync function init() {\n    const saved = await getState(); \n    if (saved && saved.items && saved.items.length > 0) {\n        state = saved;\n    } else {\n        state.items = [\n            { id: \"demo-1\", text: \"Drag a note or a file from your vault here to add it!\", state: \"todo\" },\n            { id: \"demo-2\", text: \"Type # to add #tags and filter your tasks.\", state: \"todo\" },\n            { id: \"demo-3\", text: \"Type [[ to link to other notes in your vault.\", state: \"todo\" }\n        ];\n    }\n\n    const settingsBtn = root.getElementById('kanban-settings-btn'); const dropdown = root.getElementById('kanban-dropdown');\n    settingsBtn.onclick = (e) => { e.stopPropagation(); dropdown.classList.toggle('is-open'); };\n    document.addEventListener('click', (e) => {\n        dropdown.classList.remove('is-open');\n        if (!e.target.closest('.kanban-card') && !e.target.closest('.kanban-add-btn') && !e.target.closest('.kanban-settings-btn')) {\n            selectedIds.clear();\n            updateSelectionUI();\n        }\n    });\n    root.getElementById('toggle-vertical').onclick = () => { state.isVertical = !state.isVertical; render(); save(); };\n    root.getElementById('toggle-sync').onclick = () => { state.autoSync = !state.autoSync; render(); save(); };\n    root.getElementById('sync-vault').onclick = () => importFromVault();\n    document.addEventListener('dragover', (e) => {\n        if (!draggedElement || (e.clientX === 0 && e.clientY === 0)) return;\n        const board = root.querySelector('.kanban-board');\n        if (!board) return;\n        const rect = board.getBoundingClientRect();\n        // Buffer of 20px to prevent accidental deletion\n        const isOutside = e.clientX < rect.left - 20 || e.clientX > rect.right + 20 || e.clientY < rect.top - 20 || e.clientY > rect.bottom + 20;\n        const elapsed = (Date.now() - dragOutsideStartTime) / 1000;\n        const selectedCards = root.querySelectorAll('.kanban-card-selected');\n        if (isOutside && (e.ctrlKey || elapsed >= deleteDelay)) {\n            selectedCards.forEach(c => c.classList.add('kanban-card-delete-zone'));\n        } else {\n            selectedCards.forEach(c => c.classList.remove('kanban-card-delete-zone'));\n        }\n    });\n    render();\n}\ninit();",
  "tags": [
    "productivity",
    "tasks",
    "organization",
    "kanban",
    "obsidian-integration"
  ]
}